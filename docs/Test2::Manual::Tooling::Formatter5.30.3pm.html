<!DOCTYPE html>
<html>
<!-- This is an automatically generated file.  Do not edit.
   Automatically generated by Pod::Man 4.11 (Pod::Simple 3.35)
  
   Standard preamble:
   ========================================================================
   Vertical space (when we can't use .PP)
   Begin verbatim text
   End verbatim text
   Set up some character translations and predefined strings.  \*(-- will
   give an unbreakable dash, \*(PI will give pi, \*(L" will give a left
   double quote, and \*(R" will give a right double quote.  \*(C+ will
   give a nicer C++.  Capital omega is used to do unbreakable dashes and
   therefore won't be available.  \*(C` and \*(C' expand to `' in nroff,
   nothing in troff, for use with C<>.
   diablo 10 pitch
    diablo 12 pitch
 -->
<head>

<style>
@media (prefers-color-scheme: dark) {
  body {
    background: #000;
    color: #d0d0d0;
  }

  a, a:visited {
    color: #1899eb;
  }
}
</style>

  <meta charset="utf-8"/>
  <style>
    table.head, table.foot { width: 100%; }
    td.head-rtitle, td.foot-os { text-align: right; }
    td.head-vol { text-align: center; }
    div.Pp { margin: 1ex 0ex; }
    div.Nd, div.Bf, div.Op { display: inline; }
    span.Pa, span.Ad { font-style: italic; }
    span.Ms { font-weight: bold; }
    dl.Bl-diag > dt { font-weight: bold; }
    code.Nm, code.Fl, code.Cm, code.Ic, code.In, code.Fd, code.Fn,
    code.Cd { font-weight: bold; font-family: inherit; }
  </style>
  <title>Test2::Manual::Tooling::Formatter(3)</title>
</head>
<body>
<table class="head">
  <tr>
    <td class="head-ltitle">Test2::Manual::Tooling::Formatter(3)</td>
    <td class="head-vol">User Contributed Perl Documentation</td>
    <td class="head-rtitle">Test2::Manual::Tooling::Formatter(3)</td>
  </tr>
</table>
<div class="manual-text">
<br/>
<section class="Sh">
<h1 class="Sh" id="NAME"><a class="permalink" href="#NAME">NAME</a></h1>
Test2::Manual::Tooling::Formatter - How to write a custom formatter, in our case
  a JSONL formatter.
</section>
<section class="Sh">
<h1 class="Sh" id="DESCRIPTION"><a class="permalink" href="#DESCRIPTION">DESCRIPTION</a></h1>
This tutorial explains a minimal formatter that outputs each event as a json
  string on its own line. A true formatter will probably be significantly more
  complicated, but this will give you the basics needed to get started.
</section>
<section class="Sh">
<h1 class="Sh" id="COMPLETE_CODE_UP_FRONT"><a class="permalink" href="#COMPLETE_CODE_UP_FRONT">COMPLETE
  CODE UP FRONT</a></h1>
<span class="Li"></span>
<pre>
    package Test2::Formatter::MyFormatter;
    use strict;
    use warnings;

    use JSON::MaybeXS qw/encode_json/;

    use base qw/Test2::Formatter/;

    sub new { bless {}, shift }

    sub encoding {};

    sub write {
        my ($self, $e, $num, $f) = @_;
        $f ||= $e-&gt;facet_data;

        print encode_json($f), &quot;\n&quot;;
    }

    1;
</pre>
</section>
<section class="Sh">
<h1 class="Sh" id="LINE_BY_LINE"><a class="permalink" href="#LINE_BY_LINE">LINE
  BY LINE</a></h1>
<dl class="Bl-tag">
  <dt>use base qw/Test2::Formatter/;</dt>
  <dd>All formatters should inherit from Test2::Formatter.</dd>
  <dt>sub new { bless {}, shift }</dt>
  <dd>Formatters need to be instantiable objects, this is a minimal
      <span class="Li">&quot;new()&quot;</span> method.</dd>
  <dt>sub encoding {};</dt>
  <dd>For this example we leave this sub empty. In general you should implement
      this sub to make sure you honor situations where the encoding is set.
      Test2::V0 itself will try to set the encoding to UTF8.</dd>
  <dt>sub write { ... }</dt>
  <dd>The <span class="Li">&quot;write()&quot;</span> method is the most
      important, each event is sent here.</dd>
  <dt>my ($self, $e, $num, $f) = @_;</dt>
  <dd>The <span class="Li">&quot;write()&quot;</span> method receives 3 or 4
      arguments, the fourth is optional.</dd>
</dl>
<div class="Bd-indent">
<dl class="Bl-tag">
  <dt>$self</dt>
  <dd>The formatter itself.</dd>
  <dt>$e</dt>
  <dd>The event being written</dd>
  <dt>$num</dt>
  <dd>The most recent assertion number. If the event being processed is an
      assertion then this will have been bumped by 1 since the last call to
      write. For non assertions this number is set to the most recent
    assertion.</dd>
  <dt>$f</dt>
  <dd>This MAY be a hashref containing all the facet data from the event. More
      often then not this will be undefined. This is only set if the facet data
      was needed by the hub, and it usually is not.</dd>
</dl>
</div>
<div class="Bd-indent"></div>
<dl class="Bl-tag">
  <dt>$f ||= $e-&gt;facet_data;</dt>
  <dd>We want to dump the event facet data. This will set
      <span class="Li">$f</span> to the facet data unless we already have the
      facet data.</dd>
  <dt>print encode_json($f), &quot;\n&quot;;</dt>
  <dd>This line prints the JSON encoded facet data, and a newline.</dd>
</dl>
</section>
<section class="Sh">
<h1 class="Sh" id="SEE_ALSO"><a class="permalink" href="#SEE_ALSO">SEE
  ALSO</a></h1>
Test2::Manual - Primary index of the manual.
</section>
<section class="Sh">
<h1 class="Sh" id="SOURCE"><a class="permalink" href="#SOURCE">SOURCE</a></h1>
The source code repository for Test2-Manual can be found at
  <i>https://github.com/Test-More/Test2-Suite/</i>.
</section>
<section class="Sh">
<h1 class="Sh" id="MAINTAINERS"><a class="permalink" href="#MAINTAINERS">MAINTAINERS</a></h1>
<dl class="Bl-tag">
  <dt>Chad Granum &lt;exodist@cpan.org&gt;</dt>
  <dd></dd>
</dl>
</section>
<section class="Sh">
<h1 class="Sh" id="AUTHORS"><a class="permalink" href="#AUTHORS">AUTHORS</a></h1>
<dl class="Bl-tag">
  <dt>Chad Granum &lt;exodist@cpan.org&gt;</dt>
  <dd></dd>
</dl>
</section>
<section class="Sh">
<h1 class="Sh" id="COPYRIGHT"><a class="permalink" href="#COPYRIGHT">COPYRIGHT</a></h1>
Copyright 2018 Chad Granum &lt;exodist@cpan.org&gt;.
<p class="Pp">This program is free software; you can redistribute it and/or
    modify it under the same terms as Perl itself.</p>
<p class="Pp">See <i>http://dev.perl.org/licenses/</i></p>
</section>
</div>
<table class="foot">
  <tr>
    <td class="foot-date">2020-10-22</td>
    <td class="foot-os">perl v5.30.2</td>
  </tr>
</table>
</body>
</html>
