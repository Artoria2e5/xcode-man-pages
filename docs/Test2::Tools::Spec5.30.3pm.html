<!DOCTYPE html>
<html>
<!-- This is an automatically generated file.  Do not edit.
   Automatically generated by Pod::Man 4.11 (Pod::Simple 3.35)
  
   Standard preamble:
   ========================================================================
   Vertical space (when we can't use .PP)
   Begin verbatim text
   End verbatim text
   Set up some character translations and predefined strings.  \*(-- will
   give an unbreakable dash, \*(PI will give pi, \*(L" will give a left
   double quote, and \*(R" will give a right double quote.  \*(C+ will
   give a nicer C++.  Capital omega is used to do unbreakable dashes and
   therefore won't be available.  \*(C` and \*(C' expand to `' in nroff,
   nothing in troff, for use with C<>.
   diablo 10 pitch
    diablo 12 pitch
 -->
<head>

<style>
@media (prefers-color-scheme: dark) {
  body {
    background: #000;
    color: #d0d0d0;
  }

  a, a:visited {
    color: #1899eb;
  }
}
</style>

  <meta charset="utf-8"/>
  <style>
    table.head, table.foot { width: 100%; }
    td.head-rtitle, td.foot-os { text-align: right; }
    td.head-vol { text-align: center; }
    div.Pp { margin: 1ex 0ex; }
    div.Nd, div.Bf, div.Op { display: inline; }
    span.Pa, span.Ad { font-style: italic; }
    span.Ms { font-weight: bold; }
    dl.Bl-diag > dt { font-weight: bold; }
    code.Nm, code.Fl, code.Cm, code.Ic, code.In, code.Fd, code.Fn,
    code.Cd { font-weight: bold; font-family: inherit; }
  </style>
  <title>Test2::Tools::Spec(3)</title>
</head>
<body>
<table class="head">
  <tr>
    <td class="head-ltitle">Test2::Tools::Spec(3)</td>
    <td class="head-vol">User Contributed Perl Documentation</td>
    <td class="head-rtitle">Test2::Tools::Spec(3)</td>
  </tr>
</table>
<div class="manual-text">
<br/>
<section class="Sh">
<h1 class="Sh" id="NAME"><a class="permalink" href="#NAME">NAME</a></h1>
Test2::Tools::Spec - RSPEC implementation on top of Test2::Workflow
</section>
<section class="Sh">
<h1 class="Sh" id="DESCRIPTION"><a class="permalink" href="#DESCRIPTION">DESCRIPTION</a></h1>
This uses Test2::Workflow to implement an RSPEC variant. This variant supports
  isolation and/or concurrency via forking or threads.
</section>
<section class="Sh">
<h1 class="Sh" id="SYNOPSIS"><a class="permalink" href="#SYNOPSIS">SYNOPSIS</a></h1>
<span class="Li"></span>
<pre>
    use Test2::Bundle::Extended;
    use Test2::Tools::Spec;

    describe foo =&gt; sub {
        before_all  once =&gt; sub { ... };
        before_each many =&gt; sub { ... };

        after_all  once =&gt; sub { ... };
        after_each many =&gt; sub { ... };

        case condition_a =&gt; sub { ... };
        case condition_b =&gt; sub { ... };

        tests foo =&gt; sub { ... };
        tests bar =&gt; sub { ... };
    };

    done_testing;
</pre>
</section>
<section class="Sh">
<h1 class="Sh" id="EXPORTS"><a class="permalink" href="#EXPORTS">EXPORTS</a></h1>
All of these use the same argument pattern. The first argument must always be a
  name for the block. The last argument must always be a code reference.
  Optionally a configuration hash can be inserted between the name and the code
  reference.
<p class="Pp"><span class="Li"></span></p>
<pre>
    FUNCTION &quot;name&quot; =&gt; sub { ... };

    FUNCTION &quot;name&quot; =&gt; {...}, sub { ... };
</pre>
<dl class="Bl-tag">
  <dt>NAME</dt>
  <dd>The first argument to a Test2::Tools::Spec function MUST be a name. The
      name does not need to be unique.</dd>
  <dt>PARAMS</dt>
  <dd>This argument is optional. If present this should be a hashref.
    <p class="Pp">Here are the valid keys for the hashref:</p>
  </dd>
</dl>
<div class="Bd-indent">
<dl class="Bl-tag">
  <dt>flat =&gt; $bool</dt>
  <dd>If this is set to true then the block will not render as a subtest,
      instead the events will be inline with the parent subtest (or main
    test).</dd>
  <dt>async =&gt; $bool</dt>
  <dd>Set this to true to mark a block as being capable of running concurrently
      with other test blocks. This does not mean the block WILL be run
      concurrently, just that it can be.</dd>
  <dt>iso =&gt; $bool</dt>
  <dd>Set this to true if the block MUST be run in isolation. If this is true
      then the block will run in its own forked process.
    <p class="Pp">These tests will be skipped on any platform that does not have
        true forking, or working/enabled threads.</p>
    <p class="Pp">Threads will ONLY be used if the T2_WORKFLOW_USE_THREADS env
        var is set. Thread tests are only run if the T2_DO_THREAD_TESTS env var
        is set.</p>
  </dd>
  <dt>todo =&gt; $reason</dt>
  <dd>Use this to mark an entire block as TODO.</dd>
  <dt>skip =&gt; $reason</dt>
  <dd>Use this to prevent a block from running at all.</dd>
</dl>
</div>
<div class="Bd-indent"></div>
<dl class="Bl-tag">
  <dt>CODEREF</dt>
  <dd>This argument is required. This should be a code reference that will run
      some assertions.</dd>
</dl>
<section class="Ss">
<h2 class="Ss" id="_s-1ESSENTIALS_s0"><a class="permalink" href="#_s-1ESSENTIALS_s0">ESSENTIALS</a></h2>
<dl class="Bl-tag">
  <dt>tests NAME =&gt; sub { ... }</dt>
  <dd></dd>
  <dt>tests NAME =&gt; \%params, sub { ... }</dt>
  <dd></dd>
  <dt>tests($NAME, \%PARAMS, \&amp;CODE)</dt>
  <dd></dd>
  <dt>it NAME =&gt; sub { ... }</dt>
  <dd></dd>
  <dt>it NAME =&gt; \%params, sub { ... }</dt>
  <dd></dd>
  <dt>it($NAME, \%PARAMS, \&amp;CODE)</dt>
  <dd>This defines a test block. Test blocks are essentially subtests. All test
      blocks will be run, and are expected to produce events. Test blocks can
      run multiple times if the <span class="Li">&quot;case()&quot;</span>
      function is also used.
    <p class="Pp"><span class="Li">&quot;it()&quot;</span> is an alias to
        <span class="Li">&quot;tests()&quot;</span>.</p>
    <p class="Pp">These ARE NOT inherited by nested describe blocks.</p>
  </dd>
  <dt>case NAME =&gt; sub { ... }</dt>
  <dd></dd>
  <dt>case NAME =&gt; \%params, sub { ... }</dt>
  <dd></dd>
  <dt>case($NAME, \%PARAMS, \&amp;CODE)</dt>
  <dd>This lets you specify multiple conditions in which the test blocks should
      be run. Every test block within the same group
      (<span class="Li">&quot;describe&quot;</span>) will be run once per case.
    <p class="Pp">These ARE NOT inherited by nested describe blocks, but nested
        describe blocks will be executed once per case.</p>
  </dd>
  <dt>before_each NAME =&gt; sub { ... }</dt>
  <dd></dd>
  <dt>before_each NAME =&gt; \%params, sub { ... }</dt>
  <dd></dd>
  <dt>before_each($NAME, \%PARAMS, \&amp;CODE)</dt>
  <dd>Specify a codeblock that should be run multiple times, once before each
      <span class="Li">&quot;tests()&quot;</span> block is run. These will run
      AFTER <span class="Li">&quot;case()&quot;</span> blocks but before
      <span class="Li">&quot;tests()&quot;</span> blocks.
    <p class="Pp">These ARE inherited by nested describe blocks.</p>
  </dd>
  <dt>before_case NAME =&gt; sub { ... }</dt>
  <dd></dd>
  <dt>before_case NAME =&gt; \%params, sub { ... }</dt>
  <dd></dd>
  <dt>before_case($NAME, \%PARAMS, \&amp;CODE)</dt>
  <dd>Same as <span class="Li">&quot;before_each()&quot;</span>, except these
      blocks run BEFORE <span class="Li">&quot;case()&quot;</span> blocks.
    <p class="Pp">These ARE NOT inherited by nested describe blocks.</p>
  </dd>
  <dt>before_all NAME =&gt; sub { ... }</dt>
  <dd></dd>
  <dt>before_all NAME =&gt; \%params, sub { ... }</dt>
  <dd></dd>
  <dt>before_all($NAME, \%PARAMS, \&amp;CODE)</dt>
  <dd>Specify a codeblock that should be run once, before all the test blocks
      run.
    <p class="Pp">These ARE NOT inherited by nested describe blocks.</p>
  </dd>
  <dt>around_each NAME =&gt; sub { ... }</dt>
  <dd></dd>
  <dt>around_each NAME =&gt; \%params, sub { ... }</dt>
  <dd></dd>
  <dt>around_each($NAME, \%PARAMS, \&amp;CODE)</dt>
  <dd>Specify a codeblock that should wrap around each test block. These blocks
      are run AFTER case blocks, but before test blocks.
    <p class="Pp"><span class="Li"></span></p>
    <pre>
    around_each wrapit =&gt; sub {
        my $cont = shift;

        local %ENV = ( ... );

        $cont-&gt;();

        ...
    };
    </pre>
    <p class="Pp">The first argument to the codeblock will be a callback that
        MUST be called somewhere inside the sub in order for nested items to
        run.</p>
    <p class="Pp">These ARE inherited by nested describe blocks.</p>
  </dd>
  <dt>around_case NAME =&gt; sub { ... }</dt>
  <dd></dd>
  <dt>around_case NAME =&gt; \%params, sub { ... }</dt>
  <dd></dd>
  <dt>around_case($NAME, \%PARAMS, \&amp;CODE)</dt>
  <dd>Same as <span class="Li">&quot;around_each&quot;</span> except these run
      BEFORE case blocks.
    <p class="Pp">These ARE NOT inherited by nested describe blocks.</p>
  </dd>
  <dt>around_all NAME =&gt; sub { ... }</dt>
  <dd></dd>
  <dt>around_all NAME =&gt; \%params, sub { ... }</dt>
  <dd></dd>
  <dt>around_all($NAME, \%PARAMS, \&amp;CODE)</dt>
  <dd>Same as <span class="Li">&quot;around_each&quot;</span> except that it
      only runs once to wrap ALL test blocks.
    <p class="Pp">These ARE NOT inherited by nested describe blocks.</p>
  </dd>
  <dt>after_each NAME =&gt; sub { ... }</dt>
  <dd></dd>
  <dt>after_each NAME =&gt; \%params, sub { ... }</dt>
  <dd></dd>
  <dt>after_each($NAME, \%PARAMS, \&amp;CODE)</dt>
  <dd>Same as <span class="Li">&quot;before_each&quot;</span> except it runs
      right after each test block.
    <p class="Pp">These ARE inherited by nested describe blocks.</p>
  </dd>
  <dt>after_case NAME =&gt; sub { ... }</dt>
  <dd></dd>
  <dt>after_case NAME =&gt; \%params, sub { ... }</dt>
  <dd></dd>
  <dt>after_case($NAME, \%PARAMS, \&amp;CODE)</dt>
  <dd>Same as <span class="Li">&quot;after_each&quot;</span> except it runs
      right after the case block, and before the test block.
    <p class="Pp">These ARE NOT inherited by nested describe blocks.</p>
  </dd>
  <dt>after_all NAME =&gt; sub { ... }</dt>
  <dd></dd>
  <dt>after_all NAME =&gt; \%params, sub { ... }</dt>
  <dd></dd>
  <dt>after_all($NAME, \%PARAMS, \&amp;CODE)</dt>
  <dd>Same as <span class="Li">&quot;before_all&quot;</span> except it runs
      after all test blocks have been run.
    <p class="Pp">These ARE NOT inherited by nested describe blocks.</p>
  </dd>
</dl>
</section>
<section class="Ss">
<h2 class="Ss" id="_s-1SHORTCUTS_s0"><a class="permalink" href="#_s-1SHORTCUTS_s0">SHORTCUTS</a></h2>
These are shortcuts. Each of these is the same as
  <span class="Li">&quot;tests()&quot;</span> except some parameters are added
  for you.
<p class="Pp">These are NOT exported by default/.</p>
<dl class="Bl-tag">
  <dt>mini NAME =&gt; sub { ... }</dt>
  <dd>Same as:
    <p class="Pp"><span class="Li"></span></p>
    <pre>
    tests NAME =&gt; { flat =&gt; 1 }, sub { ... }
    </pre>
  </dd>
  <dt>iso NAME =&gt; sub { ... }</dt>
  <dd>Same as:
    <p class="Pp"><span class="Li"></span></p>
    <pre>
    tests NAME =&gt; { iso =&gt; 1 }, sub { ... }
    </pre>
  </dd>
  <dt>miso NAME =&gt; sub { ... }</dt>
  <dd>Same as:
    <p class="Pp"><span class="Li"></span></p>
    <pre>
    tests NAME =&gt; { mini =&gt; 1, iso =&gt; 1 }, sub { ... }
    </pre>
  </dd>
  <dt>async NAME =&gt; sub { ... }</dt>
  <dd>Same as:
    <p class="Pp"><span class="Li"></span></p>
    <pre>
    tests NAME =&gt; { async =&gt; 1 }, sub { ... }
    </pre>
    <p class="Pp"><b>Note:</b> This conflicts with the
        <span class="Li">&quot;async()&quot;</span> exported from threads. Don't
        import both.</p>
  </dd>
  <dt>masync NAME =&gt; sub { ... }</dt>
  <dd>Same as:
    <p class="Pp"><span class="Li"></span></p>
    <pre>
    tests NAME =&gt; { minit =&gt; 1, async =&gt; 1 }, sub { ... }
    </pre>
  </dd>
</dl>
</section>
<section class="Ss">
<h2 class="Ss" id="_s-1CUSTOM_ATTRIBUTE_DEFAULTS_s0"><a class="permalink" href="#_s-1CUSTOM_ATTRIBUTE_DEFAULTS_s0">CUSTOM
  ATTRIBUTE DEFAULTS</a></h2>
Sometimes you want to apply default attributes to all
  <span class="Li">&quot;tests()&quot;</span> or
  <span class="Li">&quot;case()&quot;</span> blocks. This can be done, and is
  lexical to your describe or package root!
<p class="Pp"><span class="Li"></span></p>
<pre>
    use Test2::Bundle::Extended;
    use Test2::Tools::Spec ':ALL';

    # All 'tests' blocks after this declaration will have C&lt;&lt;iso =&gt; 1&gt;&gt; by default
    spec_defaults tests =&gt; (iso =&gt; 1);

    tests foo =&gt; sub { ... }; # isolated

    tests foo, {iso =&gt; 0}, sub { ... }; # Not isolated

    spec_defaults tests =&gt; (iso =&gt; 0); # Turn it off again
</pre>
<p class="Pp">Defaults are inherited by nested describe blocks. You can also
    override the defaults for the scope of the describe:</p>
<p class="Pp"><span class="Li"></span></p>
<pre>
    spec_defaults tests =&gt; (iso =&gt; 1);

    describe foo =&gt; sub {
        spec_defaults tests =&gt; (async =&gt; 1); # Scoped to this describe and any child describes

        tests bar =&gt; sub { ... }; # both iso and async
    };

    tests baz =&gt; sub { ... }; # Just iso, no async.
</pre>
<p class="Pp">You can apply defaults to any type of blocks:</p>
<p class="Pp"><span class="Li"></span></p>
<pre>
    spec_defaults case =&gt; (iso =&gt; 1); # All cases are 'iso';
</pre>
<p class="Pp">Defaults are not inherited when a builder's return is
  captured.</p>
<p class="Pp"><span class="Li"></span></p>
<pre>
    spec_defaults tests =&gt; (iso =&gt; 1);

    # Note we are not calling this in void context, that is the key here.
    my $d = describe foo =&gt; {
        tests bar =&gt; sub { ... }; # Not iso
    };
</pre>
</section>
</section>
<section class="Sh">
<h1 class="Sh" id="EXECUTION_ORDER"><a class="permalink" href="#EXECUTION_ORDER">EXECUTION
  ORDER</a></h1>
As each function is encountered it executes, just like any other function. The
  <span class="Li">&quot;describe()&quot;</span> function will immediately
  execute the codeblock it is given. All other functions will stash their
  codeblocks to be run later. When
  <span class="Li">&quot;done_testing()&quot;</span> is run the workflow will be
  compiled, at which point all other blocks will run.
<p class="Pp">Here is an overview of the order in which blocks get called once
    compiled (at <span class="Li">&quot;done_testing()&quot;</span>).</p>
<p class="Pp"><span class="Li"></span></p>
<pre>
    before_all
        for-each-case {
            before_case
                case
            after_case

            # AND/OR nested describes
            before_each
                tests
            after_each
        }
    after_all
</pre>
</section>
<section class="Sh">
<h1 class="Sh" id="SOURCE"><a class="permalink" href="#SOURCE">SOURCE</a></h1>
The source code repository for Test2-Workflow can be found at
  <i>https://github.com/Test-More/Test2-Suite/</i>.
</section>
<section class="Sh">
<h1 class="Sh" id="MAINTAINERS"><a class="permalink" href="#MAINTAINERS">MAINTAINERS</a></h1>
<dl class="Bl-tag">
  <dt>Chad Granum &lt;exodist@cpan.org&gt;</dt>
  <dd></dd>
</dl>
</section>
<section class="Sh">
<h1 class="Sh" id="AUTHORS"><a class="permalink" href="#AUTHORS">AUTHORS</a></h1>
<dl class="Bl-tag">
  <dt>Chad Granum &lt;exodist@cpan.org&gt;</dt>
  <dd></dd>
</dl>
</section>
<section class="Sh">
<h1 class="Sh" id="COPYRIGHT"><a class="permalink" href="#COPYRIGHT">COPYRIGHT</a></h1>
Copyright 2018 Chad Granum &lt;exodist7@gmail.com&gt;.
<p class="Pp">This program is free software; you can redistribute it and/or
    modify it under the same terms as Perl itself.</p>
<p class="Pp">See <i>http://dev.perl.org/licenses/</i></p>
</section>
</div>
<table class="foot">
  <tr>
    <td class="foot-date">2020-10-22</td>
    <td class="foot-os">perl v5.30.2</td>
  </tr>
</table>
</body>
</html>
