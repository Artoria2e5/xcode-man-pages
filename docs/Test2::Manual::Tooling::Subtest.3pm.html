<!DOCTYPE html>
<html>
<!-- This is an automatically generated file.  Do not edit.
   Automatically generated by Pod::Man 4.11 (Pod::Simple 3.35)
  
   Standard preamble:
   ========================================================================
   Vertical space (when we can't use .PP)
   Begin verbatim text
   End verbatim text
   Set up some character translations and predefined strings.  \*(-- will
   give an unbreakable dash, \*(PI will give pi, \*(L" will give a left
   double quote, and \*(R" will give a right double quote.  \*(C+ will
   give a nicer C++.  Capital omega is used to do unbreakable dashes and
   therefore won't be available.  \*(C` and \*(C' expand to `' in nroff,
   nothing in troff, for use with C<>.
   diablo 10 pitch
    diablo 12 pitch
 -->
<head>

<style>
@media (prefers-color-scheme: dark) {
  body {
    background: #000;
    color: #d0d0d0;
  }

  a, a:visited {
    color: #1899eb;
  }
}
</style>

  <meta charset="utf-8"/>
  <style>
    table.head, table.foot { width: 100%; }
    td.head-rtitle, td.foot-os { text-align: right; }
    td.head-vol { text-align: center; }
    div.Pp { margin: 1ex 0ex; }
    div.Nd, div.Bf, div.Op { display: inline; }
    span.Pa, span.Ad { font-style: italic; }
    span.Ms { font-weight: bold; }
    dl.Bl-diag > dt { font-weight: bold; }
    code.Nm, code.Fl, code.Cm, code.Ic, code.In, code.Fd, code.Fn,
    code.Cd { font-weight: bold; font-family: inherit; }
  </style>
  <title>Test2::Manual::Tooling::Subtest(3)</title>
</head>
<body>
<table class="head">
  <tr>
    <td class="head-ltitle">Test2::Manual::Tooling::Subtest(3)</td>
    <td class="head-vol">User Contributed Perl Documentation</td>
    <td class="head-rtitle">Test2::Manual::Tooling::Subtest(3)</td>
  </tr>
</table>
<div class="manual-text">
<br/>
<section class="Sh">
<h1 class="Sh" id="NAME"><a class="permalink" href="#NAME">NAME</a></h1>
Test2::Manual::Tooling::Subtest - How to implement a tool that makes use of
  subtests.
</section>
<section class="Sh">
<h1 class="Sh" id="DESCRIPTION"><a class="permalink" href="#DESCRIPTION">DESCRIPTION</a></h1>
Subtests are a nice way of making related events visually, and architecturally
  distinct.
</section>
<section class="Sh">
<h1 class="Sh" id="WHICH_TYPE_OF_SUBTEST_DO_I_NEED?"><a class="permalink" href="#WHICH_TYPE_OF_SUBTEST_DO_I_NEED?">WHICH
  TYPE OF SUBTEST DO I NEED?</a></h1>
There are 2 types of subtest. The first type is subtests with user-supplied
  coderefs, such as the <span class="Li">&quot;subtest()&quot;</span> function
  itself. The second type is subtest that do not have any user supplied
  coderefs.
<p class="Pp">So which type do you need? The answer to that is simple, if you
    are going to let the user define the subtest with their own codeblock, you
    have the first type, otherwise you have the second.</p>
<p class="Pp">In either case, you will still need use the same API function:
    <span class="Li">&quot;Test2::API::run_subtest&quot;</span>.</p>
<section class="Ss">
<h2 class="Ss" id="_s-1SUBTEST_WITH_USER_SUPPLIED_CODEREF_s0"><a class="permalink" href="#_s-1SUBTEST_WITH_USER_SUPPLIED_CODEREF_s0">SUBTEST
  WITH USER SUPPLIED CODEREF</a></h2>
This example will emulate the <span class="Li">&quot;subtest&quot;</span>
  function.
<p class="Pp"><span class="Li"></span></p>
<pre>
    use Test2::API qw/context run_subtest/;

    sub my_subtest {
        my ($name, $code) = @_;

        # Like any other tool, you need to acquire a context, if you do not then
        # things will not report the correct file and line number.
        my $ctx = context();

        my $bool = run_subtest($name, $code);

        $ctx-&gt;release;

        return $bool;
    }
</pre>
<p class="Pp">This looks incredibly simple... and it is.
    <span class="Li">&quot;run_subtest()&quot;</span> does all the hard work for
    you. This will issue an Test2::Event::Subtest event with the results of the
    subtest. The subtest event itself will report to the proper file and line
    number due to the context you acquired (even though it does not <i>look</i>
    like you used the context.</p>
<p class="Pp"><span class="Li">&quot;run_subtest()&quot;</span> can take
    additional arguments:</p>
<p class="Pp"><span class="Li"></span></p>
<pre>
    run_subtest($name, $code, \%params, @args);
</pre>
<dl class="Bl-tag">
  <dt>@args</dt>
  <dd>This allows you to pass arguments into the codeblock that gets run.</dd>
  <dt>\%params</dt>
  <dd>This is a hashref of parameters. Currently there are 3 possible
      parameters:</dd>
</dl>
<div class="Bd-indent">
<dl class="Bl-tag">
  <dt>buffered =&gt; $bool</dt>
  <dd>This will turn the subtest into the new style buffered subtest. This type
      of subtest is recommended, but not default.</dd>
  <dt>inherit_trace =&gt; $bool</dt>
  <dd>This is used for tool-side coderefs.</dd>
  <dt>no_fork =&gt; $bool</dt>
  <dd>react to forking/threading inside the subtest itself. In general you are
      unlikely to need/want this parameter.</dd>
</dl>
</div>
<div class="Bd-indent"></div>
</section>
<section class="Ss">
<h2 class="Ss" id="_s-1SUBTEST_WITH_s0_TOOL-SIDE__s-1CODEREF_s0"><a class="permalink" href="#_s-1SUBTEST_WITH_s0_TOOL-SIDE__s-1CODEREF_s0">SUBTEST
  WITH TOOL-SIDE CODEREF</a></h2>
This is particularly useful if you want to turn a tool that wraps other tools
  into a subtest. For this we will be using the tool we created in
  Test2::Manual::Tooling::Nesting.
<p class="Pp"><span class="Li"></span></p>
<pre>
    use Test2::API qw/context run_subtest/;

    sub check_class {
        my $class = shift;

        my $ctx = context();

        my $code = sub {
            my $obj = $class-&gt;new;
            is($obj-&gt;foo, 'foo', &quot;got foo&quot;);
            is($obj-&gt;bar, 'bar', &quot;got bar&quot;);
        };

        my $bool = run_subtest($class, $code, {buffered =&gt; 1, inherit_trace =&gt; 1});

        $ctx-&gt;release;

        return $bool;
    }
</pre>
<p class="Pp">The <span class="Li">&quot;run_subtest()&quot;</span> function
    does all the heavy lifting for us. All we need to do is give the function a
    name, a coderef to run, and the <span class="Li">&quot;inherit_trace =&gt;
    1&quot;</span> parameter. The <span class="Li">&quot;buffered =&gt;
    1&quot;</span> parameter is optional, but recommended.</p>
<p class="Pp">The <span class="Li">&quot;inherit_trace&quot;</span> parameter
    tells the subtest tool that the contexts acquired inside the nested tools
    should use the same trace as the subtest itself. For user-supplied
    codeblocks you do not use inherit_trace because you want errors to report to
    the user-supplied file+line.</p>
</section>
</section>
<section class="Sh">
<h1 class="Sh" id="SEE_ALSO"><a class="permalink" href="#SEE_ALSO">SEE
  ALSO</a></h1>
Test2::Manual - Primary index of the manual.
</section>
<section class="Sh">
<h1 class="Sh" id="SOURCE"><a class="permalink" href="#SOURCE">SOURCE</a></h1>
The source code repository for Test2-Manual can be found at
  <i>https://github.com/Test-More/Test2-Suite/</i>.
</section>
<section class="Sh">
<h1 class="Sh" id="MAINTAINERS"><a class="permalink" href="#MAINTAINERS">MAINTAINERS</a></h1>
<dl class="Bl-tag">
  <dt>Chad Granum &lt;exodist@cpan.org&gt;</dt>
  <dd></dd>
</dl>
</section>
<section class="Sh">
<h1 class="Sh" id="AUTHORS"><a class="permalink" href="#AUTHORS">AUTHORS</a></h1>
<dl class="Bl-tag">
  <dt>Chad Granum &lt;exodist@cpan.org&gt;</dt>
  <dd></dd>
</dl>
</section>
<section class="Sh">
<h1 class="Sh" id="COPYRIGHT"><a class="permalink" href="#COPYRIGHT">COPYRIGHT</a></h1>
Copyright 2018 Chad Granum &lt;exodist@cpan.org&gt;.
<p class="Pp">This program is free software; you can redistribute it and/or
    modify it under the same terms as Perl itself.</p>
<p class="Pp">See <i>http://dev.perl.org/licenses/</i></p>
</section>
</div>
<table class="foot">
  <tr>
    <td class="foot-date">2020-10-22</td>
    <td class="foot-os">perl v5.30.2</td>
  </tr>
</table>
</body>
</html>
