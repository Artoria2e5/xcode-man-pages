<!DOCTYPE html>
<html>
<!-- This is an automatically generated file.  Do not edit.
   Automatically generated by Pod::Man 2.27 (Pod::Simple 3.28)
  
   Standard preamble:
   ========================================================================
   Vertical space (when we can't use .PP)
   Begin verbatim text
   End verbatim text
   Set up some character translations and predefined strings.  \*(-- will
   give an unbreakable dash, \*(PI will give pi, \*(L" will give a left
   double quote, and \*(R" will give a right double quote.  \*(C+ will
   give a nicer C++.  Capital omega is used to do unbreakable dashes and
   therefore won't be available.  \*(C` and \*(C' expand to `' in nroff,
   nothing in troff, for use with C<>.
   diablo 10 pitch
    diablo 12 pitch
 -->
<head>
  <meta charset="utf-8"/>
  <style>
    table.head, table.foot { width: 100%; }
    td.head-rtitle, td.foot-os { text-align: right; }
    td.head-vol { text-align: center; }
    div.Pp { margin: 1ex 0ex; }
    div.Nd, div.Bf, div.Op { display: inline; }
    span.Pa, span.Ad { font-style: italic; }
    span.Ms { font-weight: bold; }
    dl.Bl-diag > dt { font-weight: bold; }
    code.Nm, code.Fl, code.Cm, code.Ic, code.In, code.Fd, code.Fn,
    code.Cd { font-weight: bold; font-family: inherit; }
  </style>
  <title>DBI::Gofer::Execute(3)</title>
</head>
<body>
<table class="head">
  <tr>
    <td class="head-ltitle">DBI::Gofer::Execute(3)</td>
    <td class="head-vol">User Contributed Perl Documentation</td>
    <td class="head-rtitle">DBI::Gofer::Execute(3)</td>
  </tr>
</table>
<div class="manual-text">
<br/>
<section class="Sh">
<h1 class="Sh" id="NAME"><a class="permalink" href="#NAME">NAME</a></h1>
DBI::Gofer::Execute - Executes Gofer requests and returns Gofer responses
</section>
<section class="Sh">
<h1 class="Sh" id="SYNOPSIS"><a class="permalink" href="#SYNOPSIS">SYNOPSIS</a></h1>
<span class="Li"></span>
<pre>
  $executor = DBI::Gofer::Execute-&gt;new( { ...config... });

  $response = $executor-&gt;execute_request( $request );
</pre>
</section>
<section class="Sh">
<h1 class="Sh" id="DESCRIPTION"><a class="permalink" href="#DESCRIPTION">DESCRIPTION</a></h1>
Accepts a DBI::Gofer::Request object, executes the requested DBI method calls,
  and returns a DBI::Gofer::Response object.
<p class="Pp">Any error, including any internal 'fatal' errors are caught and
    converted into a DBI::Gofer::Response object.</p>
<p class="Pp">This module is usually invoked by a 'server-side' Gofer transport
    module. They usually have names in the
    &quot;<span class="Li">&quot;DBI::Gofer::Transport::*&quot;</span>&quot;
    namespace. Examples include: DBI::Gofer::Transport::stream and
    DBI::Gofer::Transport::mod_perl.</p>
</section>
<section class="Sh">
<h1 class="Sh" id="CONFIGURATION"><a class="permalink" href="#CONFIGURATION">CONFIGURATION</a></h1>
<section class="Ss">
<h2 class="Ss" id="check_request_sub"><a class="permalink" href="#check_request_sub">check_request_sub</a></h2>
If defined, it must be a reference to a subroutine that will 'check' the
  request. It is passed the request object and the executor as its only
  arguments.
<p class="Pp">The subroutine can either return the original request object or
    die with a suitable error message (which will be turned into a Gofer
    response).</p>
<p class="Pp">It can also construct and return a new request that should be
    executed instead of the original request.</p>
</section>
<section class="Ss">
<h2 class="Ss" id="check_response_sub"><a class="permalink" href="#check_response_sub">check_response_sub</a></h2>
If defined, it must be a reference to a subroutine that will 'check' the
  response. It is passed the response object, the executor, and the request
  object. The sub may alter the response object and return undef, or return a
  new response object.
<p class="Pp">This mechanism can be used to, for example, terminate the service
    if specific database errors are seen.</p>
</section>
<section class="Ss">
<h2 class="Ss" id="forced_connect_dsn"><a class="permalink" href="#forced_connect_dsn">forced_connect_dsn</a></h2>
If set, this DSN is always used instead of the one in the request.
</section>
<section class="Ss">
<h2 class="Ss" id="default_connect_dsn"><a class="permalink" href="#default_connect_dsn">default_connect_dsn</a></h2>
If set, this DSN is used if
  <span class="Li">&quot;forced_connect_dsn&quot;</span> is not set and the
  request does not contain a DSN itself.
</section>
<section class="Ss">
<h2 class="Ss" id="forced_connect_attributes"><a class="permalink" href="#forced_connect_attributes">forced_connect_attributes</a></h2>
A reference to a hash of <i>connect()</i> attributes. Individual attributes in
  <span class="Li">&quot;forced_connect_attributes&quot;</span> will take
  precedence over corresponding attributes in the request.
</section>
<section class="Ss">
<h2 class="Ss" id="default_connect_attributes"><a class="permalink" href="#default_connect_attributes">default_connect_attributes</a></h2>
A reference to a hash of <i>connect()</i> attributes. Individual attributes in
  the request take precedence over corresponding attributes in
  <span class="Li">&quot;default_connect_attributes&quot;</span>.
</section>
<section class="Ss">
<h2 class="Ss" id="max_cached_dbh_per_drh"><a class="permalink" href="#max_cached_dbh_per_drh">max_cached_dbh_per_drh</a></h2>
If set, the loaded drivers will be checked to ensure they don't have more than
  this number of cached connections. There is no default value. This limit is
  not enforced for every request.
</section>
<section class="Ss">
<h2 class="Ss" id="max_cached_sth_per_dbh"><a class="permalink" href="#max_cached_sth_per_dbh">max_cached_sth_per_dbh</a></h2>
If set, all the cached statement handles will be cleared once the number of
  cached statement handles rises above this limit. The default is 1000.
</section>
<section class="Ss">
<h2 class="Ss" id="forced_single_resultset"><a class="permalink" href="#forced_single_resultset">forced_single_resultset</a></h2>
If true, then only the first result set will be fetched and returned in the
  response.
</section>
<section class="Ss">
<h2 class="Ss" id="forced_response_attributes"><a class="permalink" href="#forced_response_attributes">forced_response_attributes</a></h2>
A reference to a data structure that can specify extra attributes to be returned
  in responses.
<p class="Pp"><span class="Li"></span></p>
<pre>
  forced_response_attributes =&gt; {
      DriverName =&gt; {
          dbh =&gt; [ qw(dbh_attrib_name) ],
          sth =&gt; [ qw(sth_attrib_name) ],
      },
  },
</pre>
<p class="Pp">This can be useful in cases where the driver has not implemented
    the <i>private_attribute_info()</i> method and DBI::Gofer::Execute's own
    fallback list of private attributes doesn't include the driver or attributes
    you need.</p>
</section>
<section class="Ss">
<h2 class="Ss" id="track_recent"><a class="permalink" href="#track_recent">track_recent</a></h2>
If set, specifies the number of recent requests and responses that should be
  kept by the <i>update_stats()</i> method for diagnostics. See
  DBI::Gofer::Transport::mod_perl.
<p class="Pp">Note that this setting can significantly increase memory use. Use
    with caution.</p>
</section>
<section class="Ss">
<h2 class="Ss" id="forced_gofer_random"><a class="permalink" href="#forced_gofer_random">forced_gofer_random</a></h2>
Enable forced random failures and/or delays for testing. See
  &quot;DBI_GOFER_RANDOM&quot; below.
</section>
</section>
<section class="Sh">
<h1 class="Sh" id="DRIVER-SPECIFIC_ISSUES"><a class="permalink" href="#DRIVER-SPECIFIC_ISSUES">DRIVER-SPECIFIC
  ISSUES</a></h1>
Gofer needs to know about any driver-private attributes that should have their
  values sent back to the client.
<p class="Pp">If the driver doesn't support <i>private_attribute_info()</i>
    method, and very few do, then the module fallsback to using some hard-coded
    details, if available, for the driver being used. Currently hard-coded
    details are available for the mysql, Pg, Sybase, and SQLite drivers.</p>
</section>
<section class="Sh">
<h1 class="Sh" id="TESTING"><a class="permalink" href="#TESTING">TESTING</a></h1>
DBD::Gofer, DBD::Execute and related packages are well tested by executing the
  DBI test suite with DBI_AUTOPROXY configured to route all DBI calls via
  DBD::Gofer.
<p class="Pp">Because Gofer includes timeout and 'retry on error' mechanisms
    there is a need for some way to trigger delays and/or errors. This can be
    done via the <span class="Li">&quot;forced_gofer_random&quot;</span>
    configuration item, or else the DBI_GOFER_RANDOM environment variable.</p>
<section class="Ss">
<h2 class="Ss" id="_s-1DBI_GOFER_RANDOM_s0"><a class="permalink" href="#_s-1DBI_GOFER_RANDOM_s0">DBI_GOFER_RANDOM</a></h2>
The value of the <span class="Li">&quot;forced_gofer_random&quot;</span>
  configuration item (or else the DBI_GOFER_RANDOM environment variable) is
  treated as a series of tokens separated by commas.
<p class="Pp">The tokens can be one of three types:</p>
<dl class="Bl-tag">
  <dt>fail=R%</dt>
  <dd>Set the current failure rate to R where R is a percentage. The value R can
      be floating point, e.g., <span class="Li">&quot;fail=0.05%&quot;</span>.
      Negative values for R have special meaning, see below.</dd>
  <dt>err=N</dt>
  <dd>Sets the current failure err value to N (instead of the DBI's default
      'standard err value' of 2000000000). This is useful when you want to
      simulate a specific error.</dd>
  <dt>delayN=R%</dt>
  <dd>Set the current random delay rate to R where R is a percentage, and set
      the current delay duration to N seconds. The values of R and N can be
      floating point, e.g., <span class="Li">&quot;delay0.5=0.2%&quot;</span>.
      Negative values for R have special meaning, see below.
    <p class="Pp">If R is an odd number (R % 2 == 1) then a message is logged
        via <i>warn()</i> which will be returned to, and echoed at, the
      client.</p>
  </dd>
  <dt>methodname</dt>
  <dd>Applies the current fail, err, and delay values to the named method. If
      neither a fail nor delay have been set yet then a warning is
    generated.</dd>
</dl>
<p class="Pp">For example:</p>
<p class="Pp"><span class="Li"></span></p>
<pre>
  $executor = DBI::Gofer::Execute-&gt;new( {
    forced_gofer_random =&gt; &quot;fail=0.01%,do,delay60=1%,execute&quot;,
  });
</pre>
<p class="Pp">will cause the <i>do()</i> method to fail for 0.01% of calls, and
    the <i>execute()</i> method to fail 0.01% of calls and be delayed by 60
    seconds on 1% of calls.</p>
<p class="Pp">If the percentage value (<span class="Li">&quot;R&quot;</span>) is
    negative then instead of the failures being triggered randomly (via the
    <i>rand()</i> function) they are triggered via a sequence number. In other
    words &quot;<span class="Li">&quot;fail=-20%&quot;</span>&quot; will mean
    every fifth call will fail. Each method has a distinct sequence number.</p>
</section>
</section>
<section class="Sh">
<h1 class="Sh" id="AUTHOR"><a class="permalink" href="#AUTHOR">AUTHOR</a></h1>
Tim Bunce, &lt;http://www.tim.bunce.name&gt;
</section>
<section class="Sh">
<h1 class="Sh" id="LICENCE_AND_COPYRIGHT"><a class="permalink" href="#LICENCE_AND_COPYRIGHT">LICENCE
  AND COPYRIGHT</a></h1>
Copyright (c) 2007, Tim Bunce, Ireland. All rights reserved.
<p class="Pp">This module is free software; you can redistribute it and/or
    modify it under the same terms as Perl itself. See perlartistic.</p>
</section>
</div>
<table class="foot">
  <tr>
    <td class="foot-date">2013-06-24</td>
    <td class="foot-os">perl v5.18.2</td>
  </tr>
</table>
</body>
</html>
