<!DOCTYPE html>
<html>
<!-- This is an automatically generated file.  Do not edit.
   Automatically generated by Pod::Man 2.27 (Pod::Simple 3.28)
  
   Standard preamble:
   ========================================================================
   Vertical space (when we can't use .PP)
   Begin verbatim text
   End verbatim text
   Set up some character translations and predefined strings.  \*(-- will
   give an unbreakable dash, \*(PI will give pi, \*(L" will give a left
   double quote, and \*(R" will give a right double quote.  \*(C+ will
   give a nicer C++.  Capital omega is used to do unbreakable dashes and
   therefore won't be available.  \*(C` and \*(C' expand to `' in nroff,
   nothing in troff, for use with C<>.
   diablo 10 pitch
    diablo 12 pitch
 -->
<head>
  <meta charset="utf-8"/>
  <style>
    table.head, table.foot { width: 100%; }
    td.head-rtitle, td.foot-os { text-align: right; }
    td.head-vol { text-align: center; }
    div.Pp { margin: 1ex 0ex; }
    div.Nd, div.Bf, div.Op { display: inline; }
    span.Pa, span.Ad { font-style: italic; }
    span.Ms { font-weight: bold; }
    dl.Bl-diag > dt { font-weight: bold; }
    code.Nm, code.Fl, code.Cm, code.Ic, code.In, code.Fd, code.Fn,
    code.Cd { font-weight: bold; font-family: inherit; }
  </style>
  <title>install::TempContent::Objects::mod_perl-2.0.9::docs::api::ModPerl::RegistryLoader(3)</title>
</head>
<body>
<table class="head">
  <tr>
    <td class="head-ltitle">install::TempContent::Objects::mod_perl-2.0.9::docs::api::ModPerl::RegistryLoader(3)</td>
    <td class="head-vol">User Contributed Perl Documentation</td>
    <td class="head-rtitle">install::TempContent::Objects::mod_perl-2.0.9::docs::api::ModPerl::RegistryLoader(3)</td>
  </tr>
</table>
<div class="manual-text">
<br/>
<section class="Sh">
<h1 class="Sh" id="NAME"><a class="permalink" href="#NAME">NAME</a></h1>
ModPerl::RegistryLoader - Compile ModPerl::RegistryCooker scripts at server
  startup
</section>
<section class="Sh">
<h1 class="Sh" id="Synopsis"><a class="permalink" href="#Synopsis">Synopsis</a></h1>
<span class="Li"></span>
<pre>
  # in startup.pl
  use ModPerl::RegistryLoader ();
  use File::Spec ();
  
  # explicit uri =&gt; filename mapping
  my $rlbb = ModPerl::RegistryLoader-&gt;new(
      package =&gt; 'ModPerl::RegistryBB',
      debug   =&gt; 1, # default 0
  );

  $rlbb-&gt;handler($uri, $filename);
  
  ###
  # uri =&gt; filename mapping using a helper function
  sub trans {
      my $uri = shift;
      $uri =~ s|^/registry/|cgi-bin/|;
      return File::Spec-&gt;catfile(Apache2::ServerUtil::server_root, $uri);
  }
  my $rl = ModPerl::RegistryLoader-&gt;new(
      package =&gt; 'ModPerl::Registry',
      trans   =&gt; \&amp;trans,
  );
  $rl-&gt;handler($uri);
  
  ###
  $rlbb-&gt;handler($uri, $filename, $virtual_hostname);
</pre>
</section>
<section class="Sh">
<h1 class="Sh" id="Description"><a class="permalink" href="#Description">Description</a></h1>
This modules allows compilation of scripts, running under packages derived from
  <span class="Li">&quot;ModPerl::RegistryCooker&quot;</span>, at server
  startup. The script's handler routine is compiled by the parent server, of
  which children get a copy and thus saves some memory by initially sharing the
  compiled copy with the parent and saving the overhead of script's compilation
  on the first request in every httpd instance.
<p class="Pp">This module is of course useless for those running the
    <span class="Li">&quot;ModPerl::PerlRun&quot;</span> handler, because the
    scripts get recompiled on each request under this handler.</p>
</section>
<section class="Sh">
<h1 class="Sh" id="Methods"><a class="permalink" href="#Methods">Methods</a></h1>
<dl class="Bl-tag">
  <dt><i>new()</i></dt>
  <dd>When creating a new
      <span class="Li">&quot;ModPerl::RegistryLoader&quot;</span> object, one
      has to specify which of the
      <span class="Li">&quot;ModPerl::RegistryCooker&quot;</span> derived
      modules to use. For example if a script is going to run under
      <span class="Li">&quot;ModPerl::RegistryBB&quot;</span> the object is
      initialized as:
    <p class="Pp"><span class="Li"></span></p>
    <pre>
  my $rlbb = ModPerl::RegistryLoader-&gt;new(
      package =&gt; 'ModPerl::RegistryBB',
  );
    </pre>
    <p class="Pp">If the package is not specified
        <span class="Li">&quot;ModPerl::Registry&quot;</span> is assumed:</p>
    <p class="Pp"><span class="Li"></span></p>
    <pre>
  my $rlbb = ModPerl::RegistryLoader-&gt;new();
    </pre>
    <p class="Pp">To turn the debugging on, set the <i>debug</i> attribute to a
        true value:</p>
    <p class="Pp"><span class="Li"></span></p>
    <pre>
  my $rlbb = ModPerl::RegistryLoader-&gt;new(
      package =&gt; 'ModPerl::RegistryBB',
      debug   =&gt; 1,
  );
    </pre>
    <p class="Pp">Instead of specifying explicitly a filename for each uri
        passed to <i>handler()</i>, a special attribute <i>trans</i> can be set
        to a subroutine to perform automatic remapping.</p>
    <p class="Pp"><span class="Li"></span></p>
    <pre>
  my $rlbb = ModPerl::RegistryLoader-&gt;new(
      package =&gt; 'ModPerl::RegistryBB',
      trans   =&gt; \&amp;trans,
  );
    </pre>
    <p class="Pp">See the <i>handler()</i> item for an example of using the
        <i>trans</i> attribute.</p>
  </dd>
  <dt><i>handler()</i></dt>
  <dd><span class="Li"></span>
    <pre>
  $rl-&gt;handler($uri, [$filename, [$virtual_hostname]]);
    </pre>
    <p class="Pp">The <i>handler()</i> method takes argument of
        <span class="Li">&quot;uri&quot;</span> and optionally of
        <span class="Li">&quot;filename&quot;</span> and of
        <span class="Li">&quot;virtual_hostname&quot;</span>.</p>
    <p class="Pp">URI to filename translation normally doesn't happen until HTTP
        request time, so we're forced to roll our own translation. If the
        filename is supplied it's used in translation.</p>
    <p class="Pp">If the filename is omitted and a
        <span class="Li">&quot;trans&quot;</span> subroutine was not set in
        <i>new()</i>, the loader will try using the
        <span class="Li">&quot;uri&quot;</span> relative to the
        <span class="Li">&quot;ServerRoot&quot;</span> configuration directive.
        For example:</p>
    <p class="Pp"><span class="Li"></span></p>
    <pre>
  httpd.conf:
  -----------
  ServerRoot /usr/local/apache
  Alias /registry/ /usr/local/apache/cgi-bin/

  startup.pl:
  -----------
  use ModPerl::RegistryLoader ();
  my $rl = ModPerl::RegistryLoader-&gt;new(
      package =&gt; 'ModPerl::Registry',
  );
  # preload /usr/local/apache/cgi-bin/test.pl
  $rl-&gt;handler(/registry/test.pl);
    </pre>
    <p class="Pp">To make the loader smarter about the URI-&gt;filename
        translation, you may provide the
        <span class="Li">&quot;new()&quot;</span> method with a
        <span class="Li">&quot;trans()&quot;</span> function to translate the
        uri to filename.</p>
    <p class="Pp">The following example will pre-load all files ending with
        <i>.pl</i> in the <i>cgi-bin</i> directory relative to
        <span class="Li">&quot;ServerRoot&quot;</span>.</p>
    <p class="Pp"><span class="Li"></span></p>
    <pre>
  httpd.conf:
  -----------
  ServerRoot /usr/local/apache
  Alias /registry/ /usr/local/apache/cgi-bin/

  startup.pl:
  -----------
  {
      # test the scripts pre-loading by using trans sub
      use ModPerl::RegistryLoader ();
      use File::Spec ();
      use DirHandle ();
      use strict;
  
      my $dir = File::Spec-&gt;catdir(Apache2::ServerUtil::server_root,
                                  &quot;cgi-bin&quot;);
  
      sub trans {
          my $uri = shift; 
          $uri =~ s|^/registry/|cgi-bin/|;
          return File::Spec-&gt;catfile(Apache2::ServerUtil::server_root,
                                     $uri);
      }
  
      my $rl = ModPerl::RegistryLoader-&gt;new(
          package =&gt; &quot;ModPerl::Registry&quot;,
          trans   =&gt; \&amp;trans,
      );
      my $dh = DirHandle-&gt;new($dir) or die $!;
  
      for my $file ($dh-&gt;read) {
          next unless $file =~ /\.pl$/;
          $rl-&gt;handler(&quot;/registry/$file&quot;);
      }
  }
    </pre>
    <p class="Pp">If <span class="Li">$virtual_hostname</span> argument is
        passed it'll be used in the creation of the package name the script will
        be compiled into for those registry handlers that use
        <i></i><i>namespace_from_uri()</i><i></i> method. See also the notes on
        <span class="Li">$ModPerl::RegistryCooker::NameWithVirtualHost</span> in
        the <span class="Li">&quot;ModPerl::RegistryCooker&quot;</span>
        documentation.</p>
    <p class="Pp">Also explained in the
        <span class="Li">&quot;ModPerl::RegistryLoader&quot;</span>
        documentation, this only has an effect at run time if
        <span class="Li">$ModPerl::RegistryCooker::NameWithVirtualHost</span> is
        set to true, otherwise the <span class="Li">$virtual_hostname</span>
        argument is ignored.</p>
  </dd>
</dl>
</section>
<section class="Sh">
<h1 class="Sh" id="Implementation_Notes"><a class="permalink" href="#Implementation_Notes">Implementation
  Notes</a></h1>
<span class="Li">&quot;ModPerl::RegistryLoader&quot;</span> performs a very
  simple job, at run time it loads and sub-classes the module passed via the
  <i>package</i> attribute and overrides some of its functions, to emulate the
  run-time environment. This allows to preload the same script into different
  registry environments.
</section>
<section class="Sh">
<h1 class="Sh" id="Authors"><a class="permalink" href="#Authors">Authors</a></h1>
The original <span class="Li">&quot;Apache2::RegistryLoader&quot;</span>
  implemented by Doug MacEachern.
<p class="Pp">Stas Bekman did the porting to the new registry framework based on
    <span class="Li">&quot;ModPerl::RegistryLoader&quot;</span>.</p>
</section>
<section class="Sh">
<h1 class="Sh" id="SEE_ALSO"><a class="permalink" href="#SEE_ALSO">SEE
  ALSO</a></h1>
<span class="Li">&quot;ModPerl::RegistryCooker&quot;</span>,
  <span class="Li">&quot;ModPerl::Registry&quot;</span>,
  <span class="Li">&quot;ModPerl::RegistryBB&quot;</span>,
  <span class="Li">&quot;ModPerl::PerlRun&quot;</span>, <i>Apache</i>(3),
  <i>mod_perl</i>(3)
</section>
</div>
<table class="foot">
  <tr>
    <td class="foot-date">2015-06-18</td>
    <td class="foot-os">perl v5.18.2</td>
  </tr>
</table>
</body>
</html>
