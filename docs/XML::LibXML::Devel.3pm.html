<!DOCTYPE html>
<html>
<!-- This is an automatically generated file.  Do not edit.
   Automatically generated by Pod::Man 4.10 (Pod::Simple 3.35)
  
   Standard preamble:
   ========================================================================
   Vertical space (when we can't use .PP)
   Begin verbatim text
   End verbatim text
   Set up some character translations and predefined strings.  \*(-- will
   give an unbreakable dash, \*(PI will give pi, \*(L" will give a left
   double quote, and \*(R" will give a right double quote.  \*(C+ will
   give a nicer C++.  Capital omega is used to do unbreakable dashes and
   therefore won't be available.  \*(C` and \*(C' expand to `' in nroff,
   nothing in troff, for use with C<>.
   diablo 10 pitch
    diablo 12 pitch
 -->
<head>

<style>
@media (prefers-color-scheme: dark) {
  body {
    background: #000;
    color: #d0d0d0;
  }

  a, a:visited {
    color: #1899eb;
  }
}
</style>

  <meta charset="utf-8"/>
  <style>
    table.head, table.foot { width: 100%; }
    td.head-rtitle, td.foot-os { text-align: right; }
    td.head-vol { text-align: center; }
    div.Pp { margin: 1ex 0ex; }
    div.Nd, div.Bf, div.Op { display: inline; }
    span.Pa, span.Ad { font-style: italic; }
    span.Ms { font-weight: bold; }
    dl.Bl-diag > dt { font-weight: bold; }
    code.Nm, code.Fl, code.Cm, code.Ic, code.In, code.Fd, code.Fn,
    code.Cd { font-weight: bold; font-family: inherit; }
  </style>
  <title>XML::LibXML::Devel(3)</title>
</head>
<body>
<table class="head">
  <tr>
    <td class="head-ltitle">XML::LibXML::Devel(3)</td>
    <td class="head-vol">User Contributed Perl Documentation</td>
    <td class="head-rtitle">XML::LibXML::Devel(3)</td>
  </tr>
</table>
<div class="manual-text">
<br/>
<section class="Sh">
<h1 class="Sh" id="NAME"><a class="permalink" href="#NAME">NAME</a></h1>
XML::LibXML::Devel - makes functions from LibXML.xs available
</section>
<section class="Sh">
<h1 class="Sh" id="SYNOPSIS"><a class="permalink" href="#SYNOPSIS">SYNOPSIS</a></h1>
<span class="Li"></span>
<pre>
  /**********************************************
   * C functions you want to access
   */
  xmlNode *return_node();
  void receive_node(xmlNode *);

  ###############################################
  # XS Code
  void *
    xs_return_node
    CODE:
        RETVAL = return_node();
    OUTPUT:
        RETVAL

  void
    xs_receive_node
        void *n
    CODE:
        receive_node(n);

  ###############################################
  # Perl code
  use XML::LibXML::Devel;

  sub return_node
  {
    my $raw_node = xs_return_node();
    my $node = XML::LibXML::Devel::node_to_perl($raw_node);
    XML::LibXML::Devel::refcnt_inc($raw_node);
    return $node;
  }

  sub receive_node
  {
    my ($node) = @_;
    my $raw_node = XML::LibXML::Devel::node_from_perl($node);
    xs_receive_node($raw_node);
    XML::LibXML::Devel::refcnt_inc($raw_node);
  }
</pre>
</section>
<section class="Sh">
<h1 class="Sh" id="DESCRIPTION"><a class="permalink" href="#DESCRIPTION">DESCRIPTION</a></h1>
<span class="Li">&quot;XML::LibXML::Devel&quot;</span> makes functions from
  LibXML.xs available that are needed to wrap libxml2 nodes in and out of
  XML::LibXML::Nodes. This gives cleaner dependencies than using LibXML.so
  directly.
<p class="Pp">To XS a library that uses libxml2 nodes the first step is to do
    this so that xmlNodePtr is passed as void *. These raw nodes are then turned
    into libxml nodes by using this <span class="Li">&quot;Devel&quot;</span>
    functions.</p>
<p class="Pp">Be aware that this module is currently rather experimental. The
    function names may change if I XS more functions and introduce a reasonable
    naming convention.</p>
<p class="Pp">Be also aware that this module is a great tool to cause segfaults
    and introduce memory leaks. It does however provide a partial cure by making
    <span class="Li">&quot;xmlMemUsed&quot;</span> available as
    <span class="Li">&quot;mem_used&quot;</span>.</p>
</section>
<section class="Sh">
<h1 class="Sh" id="FUNCTIONS"><a class="permalink" href="#FUNCTIONS">FUNCTIONS</a></h1>
<section class="Ss">
<h2 class="Ss" id="_s-1NODE_MANAGEMENT_s0"><a class="permalink" href="#_s-1NODE_MANAGEMENT_s0">NODE
  MANAGEMENT</a></h2>
<dl class="Bl-tag">
  <dt>node_to_perl</dt>
  <dd><span class="Li"></span>
    <pre>
  node_to_perl($raw_node);
    </pre>
    <p class="Pp">Returns a LibXML::Node object. This has a proxy node with a
        reference counter and an owner attached. The raw node will be deleted as
        soon as the reference counter reaches zero. If the C library is keeping
        a pointer to the raw node, you need to call refcnt_inc immediately. You
        also need to replace xmlFreeNode by a call to refcnt_dec.</p>
  </dd>
  <dt>node_to_perl</dt>
  <dd><span class="Li"></span>
    <pre>
  node_from_perl($node);
    </pre>
    <p class="Pp">Returns a raw node. This is a void * pointer and you can do
        nothing but passing it to functions that treat it as an xmlNodePtr. The
        raw node will be freed as soon as its reference counter reaches zero. If
        the C library is keeping a pointer to the raw node, you need to call
        refcnt_inc immediately. You also need to replace xmlFreeNode by a call
        to refcnt_dec.</p>
  </dd>
  <dt>refcnt_inc</dt>
  <dd><span class="Li"></span>
    <pre>
  refcnt_inc($raw_node);
    </pre>
    <p class="Pp">Increments the raw nodes reference counter. The raw node must
        already be known to perl to have a reference counter.</p>
  </dd>
  <dt>refcnt_dec</dt>
  <dd><span class="Li"></span>
    <pre>
  refcnt_dec($raw_node);
    </pre>
    <p class="Pp">Decrements the raw nodes reference counter and returns the
        value it had before. if the counter becomes zero or less, this method
        will free the proxy node holding the reference counter. If the node is
        part of a subtree, refcnt_dec will fix the reference counts and delete
        the subtree if it is not required any more.</p>
  </dd>
  <dt>refcnt</dt>
  <dd><span class="Li"></span>
    <pre>
  refcnt($raw_node);
    </pre>
    <p class="Pp">Returns the value of the reference counter.</p>
  </dd>
  <dt>fix_owner</dt>
  <dd><span class="Li"></span>
    <pre>
  fix_owner($raw_node, $raw_parent);
    </pre>
    <p class="Pp">This functions fixes the reference counts for an entire
        subtree. it is very important to fix an entire subtree after node
        operations where the documents or the owner node may get changed. this
        method is aware about nodes that already belong to a certain owner
      node.</p>
  </dd>
</dl>
</section>
<section class="Ss">
<h2 class="Ss" id="_s-1MEMORY_DEBUGGING_s0"><a class="permalink" href="#_s-1MEMORY_DEBUGGING_s0">MEMORY
  DEBUGGING</a></h2>
<dl class="Bl-tag">
  <dt>$ENV{DEBUG_MEMORY}</dt>
  <dd><span class="Li"></span>
    <pre>
  BEGIN {$ENV{DEBUG_MEMORY} = 1;};
  use XML::LibXML;
    </pre>
    <p class="Pp">This turns on libxml2 memory debugging. It must be set before
        XML::LibXML is loaded.</p>
  </dd>
  <dt>mem_used</dt>
  <dd><span class="Li"></span>
    <pre>
  mem_used();
    </pre>
    <p class="Pp">Returns the number of bytes currently allocated.</p>
  </dd>
</dl>
</section>
<section class="Ss">
<h2 class="Ss" id="_s-1EXPORT_s0"><a class="permalink" href="#_s-1EXPORT_s0">EXPORT</a></h2>
None by default.
</section>
</section>
<section class="Sh">
<h1 class="Sh" id="SEE_ALSO"><a class="permalink" href="#SEE_ALSO">SEE
  ALSO</a></h1>
This was created to support the needs of Apache2::ModXml2. So this can serve as
  an example.
</section>
<section class="Sh">
<h1 class="Sh" id="AUTHOR"><a class="permalink" href="#AUTHOR">AUTHOR</a></h1>
Joachim Zobel &lt;jz-2011@heute-morgen.de&gt;
</section>
<section class="Sh">
<h1 class="Sh" id="COPYRIGHT_AND_LICENSE"><a class="permalink" href="#COPYRIGHT_AND_LICENSE">COPYRIGHT
  AND LICENSE</a></h1>
Copyright (C) 2011 by Joachim Zobel
<p class="Pp">This library is free software; you can redistribute it and/or
    modify it under the same terms as Perl itself, either Perl version 5.10.1
    or, at your option, any later version of Perl 5 you may have available.</p>
</section>
</div>
<table class="foot">
  <tr>
    <td class="foot-date">2014-02-01</td>
    <td class="foot-os">perl v5.28.2</td>
  </tr>
</table>
</body>
</html>
