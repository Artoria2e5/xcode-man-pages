<!DOCTYPE html>
<html>
<!-- This is an automatically generated file.  Do not edit.
   Automatically generated by Pod::Man 2.27 (Pod::Simple 3.28)
  
   Standard preamble:
   ========================================================================
   Vertical space (when we can't use .PP)
   Begin verbatim text
   End verbatim text
   Set up some character translations and predefined strings.  \*(-- will
   give an unbreakable dash, \*(PI will give pi, \*(L" will give a left
   double quote, and \*(R" will give a right double quote.  \*(C+ will
   give a nicer C++.  Capital omega is used to do unbreakable dashes and
   therefore won't be available.  \*(C` and \*(C' expand to `' in nroff,
   nothing in troff, for use with C<>.
   diablo 10 pitch
    diablo 12 pitch
 -->
<head>
  <meta charset="utf-8"/>
  <style>
    table.head, table.foot { width: 100%; }
    td.head-rtitle, td.foot-os { text-align: right; }
    td.head-vol { text-align: center; }
    div.Pp { margin: 1ex 0ex; }
    div.Nd, div.Bf, div.Op { display: inline; }
    span.Pa, span.Ad { font-style: italic; }
    span.Ms { font-weight: bold; }
    dl.Bl-diag > dt { font-weight: bold; }
    code.Nm, code.Fl, code.Cm, code.Ic, code.In, code.Fd, code.Fn,
    code.Cd { font-weight: bold; font-family: inherit; }
  </style>
  <title>DBIx::Class::Storage::DBI::MSSQL(3)</title>
</head>
<body>
<table class="head">
  <tr>
    <td class="head-ltitle">DBIx::Class::Storage::DBI::MSSQL(3)</td>
    <td class="head-vol">User Contributed Perl Documentation</td>
    <td class="head-rtitle">DBIx::Class::Storage::DBI::MSSQL(3)</td>
  </tr>
</table>
<div class="manual-text">
<br/>
<section class="Sh">
<h1 class="Sh" id="NAME"><a class="permalink" href="#NAME">NAME</a></h1>
DBIx::Class::Storage::DBI::MSSQL - Base Class for Microsoft SQL Server support
  in DBIx::Class
</section>
<section class="Sh">
<h1 class="Sh" id="SYNOPSIS"><a class="permalink" href="#SYNOPSIS">SYNOPSIS</a></h1>
This is the base class for Microsoft SQL Server support, used by
  DBIx::Class::Storage::DBI::ODBC::Microsoft_SQL_Server and
  DBIx::Class::Storage::DBI::Sybase::Microsoft_SQL_Server.
</section>
<section class="Sh">
<h1 class="Sh" id="IMPLEMENTATION_NOTES"><a class="permalink" href="#IMPLEMENTATION_NOTES">IMPLEMENTATION
  NOTES</a></h1>
<section class="Ss">
<h2 class="Ss" id="_s-1IDENTITY_s0_information"><a class="permalink" href="#_s-1IDENTITY_s0_information">IDENTITY
  information</a></h2>
Microsoft SQL Server supports three methods of retrieving the IDENTITY value for
  inserted row: IDENT_CURRENT, @@IDENTITY, and <i>SCOPE_IDENTITY()</i>.
  SCOPE_IDENTITY is used here because it is the safest. However, it must be
  called is the same execute statement, not just the same connection.
<p class="Pp">So, this implementation appends a SELECT <i>SCOPE_IDENTITY()</i>
    statement onto each INSERT to accommodate that requirement.</p>
<p class="Pp"><span class="Li">&quot;SELECT @@IDENTITY&quot;</span> can also be
    used by issuing:</p>
<p class="Pp"><span class="Li"></span></p>
<pre>
  $self-&gt;_identity_method('@@identity');
</pre>
<p class="Pp">it will only be used if <i>SCOPE_IDENTITY()</i> fails.</p>
<p class="Pp">This is more dangerous, as inserting into a table with an on
    insert trigger that inserts into another table with an identity will give
    erroneous results on recent versions of SQL Server.</p>
</section>
<section class="Ss">
<h2 class="Ss" id="identity_insert"><a class="permalink" href="#identity_insert">identity
  insert</a></h2>
Be aware that we have tried to make things as simple as possible for our users.
  For MSSQL that means that when a user tries to create a row, while supplying
  an explicit value for an autoincrementing column, we will try to issue the
  appropriate database call to make this possible, namely
  <span class="Li">&quot;SET IDENTITY_INSERT</span> <span class="Li">$table_name
  ON&quot;</span>. Unfortunately this operation in MSSQL requires the
  <span class="Li">&quot;db_ddladmin&quot;</span> privilege, which is normally
  not included in the standard write-permissions.
</section>
<section class="Ss">
<h2 class="Ss" id="Ordered_Subselects"><a class="permalink" href="#Ordered_Subselects">Ordered
  Subselects</a></h2>
If you attempted the following query (among many others) in Microsoft SQL Server
<p class="Pp"><span class="Li"></span></p>
<pre>
 $rs-&gt;search ({}, {
  prefetch =&gt; 'relation',
  rows =&gt; 2,
  offset =&gt; 3,
 });
</pre>
<p class="Pp">You may be surprised to receive an exception. The reason for this
    is a quirk in the MSSQL engine itself, and sadly doesn't have a sensible
    workaround due to the way DBIC is built. DBIC can do truly wonderful things
    with the aid of subselects, and does so automatically when necessary. The
    list of situations when a subselect is necessary is long and still changes
    often, so it can not be exhaustively enumerated here. The general rule of
    thumb is a joined has_many relationship with limit/group applied to the left
    part of the join.</p>
<p class="Pp">In its &quot;pursuit of standards&quot; Microsft SQL Server goes
    to great lengths to forbid the use of ordered subselects. This breaks a very
    useful group of searches like &quot;Give me things number 4 to 6 (ordered by
    name), and prefetch all their relations, no matter how many&quot;. While
    there is a hack which fools the syntax checker, the optimizer may <b>still
    elect to break the subselect</b>. Testing has determined that while such
    breakage does occur (the test suite contains an explicit test which
    demonstrates the problem), it is relative rare. The benefits of ordered
    subselects are on the other hand too great to be outright disabled for
    MSSQL.</p>
<p class="Pp">Thus compromise between usability and perfection is the
    MSSQL-specific resultset attribute
    <span class="Li">&quot;unsafe_subselect_ok&quot;</span>. It is deliberately
    not possible to set this on the Storage level, as the user should inspect
    (and preferably regression-test) the return of every such ResultSet
    individually. The example above would work if written like:</p>
<p class="Pp"><span class="Li"></span></p>
<pre>
 $rs-&gt;search ({}, {
  unsafe_subselect_ok =&gt; 1,
  prefetch =&gt; 'relation',
  rows =&gt; 2,
  offset =&gt; 3,
 });
</pre>
<p class="Pp">If it is possible to rewrite the <i>search()</i> in a way that
    will avoid the need for this flag - you are urged to do so. If DBIC
    internals insist that an ordered subselect is necessary for an operation,
    and you believe there is a different/better way to get the same result -
    please file a bugreport.</p>
</section>
</section>
<section class="Sh">
<h1 class="Sh" id="AUTHOR"><a class="permalink" href="#AUTHOR">AUTHOR</a></h1>
See &quot;AUTHOR&quot; in DBIx::Class and &quot;CONTRIBUTORS&quot; in
  DBIx::Class.
</section>
<section class="Sh">
<h1 class="Sh" id="LICENSE"><a class="permalink" href="#LICENSE">LICENSE</a></h1>
You may distribute this code under the same terms as Perl itself.
</section>
</div>
<table class="foot">
  <tr>
    <td class="foot-date">2014-01-05</td>
    <td class="foot-os">perl v5.18.4</td>
  </tr>
</table>
</body>
</html>
