<!DOCTYPE html>
<html>
<!-- This is an automatically generated file.  Do not edit.
   Automatically generated by Pod::Man 4.11 (Pod::Simple 3.35)
  
   Standard preamble:
   ========================================================================
   Vertical space (when we can't use .PP)
   Begin verbatim text
   End verbatim text
   Set up some character translations and predefined strings.  \*(-- will
   give an unbreakable dash, \*(PI will give pi, \*(L" will give a left
   double quote, and \*(R" will give a right double quote.  \*(C+ will
   give a nicer C++.  Capital omega is used to do unbreakable dashes and
   therefore won't be available.  \*(C` and \*(C' expand to `' in nroff,
   nothing in troff, for use with C<>.
   diablo 10 pitch
    diablo 12 pitch
 -->
<head>

<style>
@media (prefers-color-scheme: dark) {
  body {
    background: #000;
    color: #d0d0d0;
  }

  a, a:visited {
    color: #1899eb;
  }
}
</style>

  <meta charset="utf-8"/>
  <style>
    table.head, table.foot { width: 100%; }
    td.head-rtitle, td.foot-os { text-align: right; }
    td.head-vol { text-align: center; }
    div.Pp { margin: 1ex 0ex; }
    div.Nd, div.Bf, div.Op { display: inline; }
    span.Pa, span.Ad { font-style: italic; }
    span.Ms { font-weight: bold; }
    dl.Bl-diag > dt { font-weight: bold; }
    code.Nm, code.Fl, code.Cm, code.Ic, code.In, code.Fd, code.Fn,
    code.Cd { font-weight: bold; font-family: inherit; }
  </style>
  <title>Mail::DKIM::ARC::Signer(3)</title>
</head>
<body>
<table class="head">
  <tr>
    <td class="head-ltitle">Mail::DKIM::ARC::Signer(3)</td>
    <td class="head-vol">User Contributed Perl Documentation</td>
    <td class="head-rtitle">Mail::DKIM::ARC::Signer(3)</td>
  </tr>
</table>
<div class="manual-text">
<br/>
<section class="Sh">
<h1 class="Sh" id="NAME"><a class="permalink" href="#NAME">NAME</a></h1>
Mail::DKIM::ARC::Signer - generates a DKIM signature for a message
</section>
<section class="Sh">
<h1 class="Sh" id="SYNOPSIS"><a class="permalink" href="#SYNOPSIS">SYNOPSIS</a></h1>
<span class="Li"></span>
<pre>
  use Mail::DKIM::ARC::Signer;
  use Mail::DKIM::TextWrap;  #recommended

  # create a signer object
  my $signer = Mail::DKIM::ARC::Signer-&gt;new(
                  Algorithm =&gt; 'rsa-sha256',
                  Chain =&gt; 'none',    # or pass|fail|ar
                  Domain =&gt; 'example.org',
                  SrvId =&gt; 'example.org',
                  Selector =&gt; 'selector1',
                  KeyFile =&gt; 'private.key',
                  Headers =&gt; 'x-header:x-header2',
             );

  # read an email from a file handle
  $signer-&gt;load(*STDIN);

  # NOTE: any email being ARC signed must have an Authentication-Results
  # header so that the ARC seal can cover those results copied into
  # an ARC-Authentication-Results header.

  # or read an email and pass it into the signer, one line at a time
  while (&lt;STDIN&gt;)
  {
      # remove local line terminators
      chomp;
      s/\015$//;

      # use SMTP line terminators
      $signer-&gt;PRINT(&quot;$_\015\012&quot;);
  }
  $signer-&gt;CLOSE;

  die 'Failed' $signer-&gt;result_details() unless $signer-&gt;result() eq 'sealed';

  # Get all the signature headers to prepend to the message
  # ARC-Seal, ARC-Message-Signature and ARC-Authentication-Results
  # in that order.
  print $signer-&gt;as_string;
</pre>
</section>
<section class="Sh">
<h1 class="Sh" id="DESCRIPTION"><a class="permalink" href="#DESCRIPTION">DESCRIPTION</a></h1>
This class is the part of Mail::DKIM responsible for generating ARC Seals for a
  given message. You create an object of this class, specifying the parameters
  for the ARC-Message-Signature you wish to create.
<p class="Pp">You also need to pass the 'Chain' value (pass or fail) from
    validation of the previous ARC-Seals on the message.</p>
<p class="Pp">Next, you feed it the entire message using
    &quot;<b>PRINT()</b>&quot;, completing with &quot;<b>CLOSE()</b>&quot;.</p>
<p class="Pp">Finally, use the &quot;<b>as_string()</b>&quot; method to get the
    new ARC headers.</p>
<p class="Pp">Note: you can only seal a message which has already had an
    Authentication-Results header added, either by using
    &quot;<b>PRINT()</b>&quot; to pre-feed it into this module, or by adding a
    message which has already been authenticated by your inbound scanning
    mechanisms.</p>
<p class="Pp">It is not necessary to ARC-Seal a message which already has DKIM
    signatures if you are not modifying the message and hence breaking the
    existing DKIM-Signature or top ARC-Message-Signature on the email.</p>
<section class="Ss">
<h2 class="Ss" id="Pretty_Signatures"><a class="permalink" href="#Pretty_Signatures">Pretty
  Signatures</a></h2>
Mail::DKIM includes a signature-wrapping module (which inserts linebreaks into
  the generated signature so that it looks nicer in the resulting message. To
  enable this module, simply call
<p class="Pp"><span class="Li"></span></p>
<pre>
  use Mail::DKIM::TextWrap;
</pre>
<p class="Pp">in your program before generating the signature.</p>
</section>
</section>
<section class="Sh">
<h1 class="Sh" id="CONSTRUCTOR"><a class="permalink" href="#CONSTRUCTOR">CONSTRUCTOR</a></h1>
<section class="Ss">
<h2 class="Ss" id="_fBnew()_fP"><a class="permalink" href="#_fBnew()_fP"><b>new()</b></a></h2>
Construct an object-oriented signer.
<p class="Pp"><span class="Li"></span></p>
<pre>
  # create a signer using the default policy
  my $signer = Mail::DKIM::ARC::Signer-&gt;new(
                  Algorithm =&gt; 'rsa-sha256',
                  Chain =&gt; 'none',    # or pass|fail|ar
                  Domain =&gt; 'example.org',
                  SrvId =&gt; 'example.org',
                  Selector =&gt; 'selector1',
                  KeyFile =&gt; 'private.key',
                  Headers =&gt; 'x-header:x-header2',
             );
</pre>
<dl class="Bl-tag">
  <dt>Key</dt>
  <dd>rather than using <span class="Li">&quot;KeyFile&quot;</span>, use
      <span class="Li">&quot;Key&quot;</span> to use an already-loaded
      Mail::DKIM::PrivateKey object.</dd>
  <dt>Chain</dt>
  <dd>The cv= value for the Arc-Seal header. &quot;ar&quot; means to copy it
      from an Authentication-Results header, or use none if there isn't
    one.</dd>
  <dt>SrvId</dt>
  <dd>The authserv-id in the Authentication-Results headers, defaults to
    Domain.</dd>
  <dt>Headers</dt>
  <dd>A colon separated list of headers to sign, this is added to the list of
      default headers as shown in in the DKIM specification.
    <p class="Pp">For each specified header all headers of that type which are
        present in the message will be signed, but we will not oversign or sign
        headers which are not present.</p>
    <p class="Pp">If you require greater control over signed headers please use
        the <b>extended_headers()</b> method instead.</p>
    <p class="Pp">The list of headers signed by default is as follows</p>
    <p class="Pp"><span class="Li"></span></p>
    <pre>
    From Sender Reply-To Subject Date
    Message-ID To Cc MIME-Version
    Content-Type Content-Transfer-Encoding Content-ID Content-Description
    Resent-Date Resent-From Resent-Sender Resent-To Resent-cc
    Resent-Message-ID
    In-Reply-To References
    List-Id List-Help List-Unsubscribe List-Subscribe
    List-Post List-Owner List-Archive
    </pre>
  </dd>
</dl>
</section>
</section>
<section class="Sh">
<h1 class="Sh" id="METHODS"><a class="permalink" href="#METHODS">METHODS</a></h1>
<section class="Ss">
<h2 class="Ss" id="_s-1_fBPRINT_s0()_fP"><a class="permalink" href="#_s-1_fBPRINT_s0()_fP"><b>PRINT()</b></a></h2>
Feed part of the message to the signer.
<p class="Pp"><span class="Li"></span></p>
<pre>
  $signer-&gt;PRINT(&quot;a line of the message\015\012&quot;);
</pre>
<p class="Pp">Feeds content of the message being signed into the signer. The API
    is designed this way so that the entire message does NOT need to be read
    into memory at once.</p>
<p class="Pp">Please note that although the <b>PRINT()</b> method expects you to
    use SMTP-style line termination characters, you should NOT use the
    SMTP-style dot-stuffing technique described in RFC 2821 section 4.5.2. Nor
    should you use a &lt;CR&gt;&lt;LF&gt;.&lt;CR&gt;&lt;LF&gt; sequence to
    terminate the message.</p>
</section>
<section class="Ss">
<h2 class="Ss" id="_s-1_fBCLOSE_s0()_fP"><a class="permalink" href="#_s-1_fBCLOSE_s0()_fP"><b>CLOSE()</b></a></h2>
Call this when finished feeding in the message.
<p class="Pp"><span class="Li"></span></p>
<pre>
  $signer-&gt;CLOSE;
</pre>
<p class="Pp">This method finishes the canonicalization process, computes a
    hash, and generates a signature.</p>
</section>
<section class="Ss">
<h2 class="Ss" id="_fBextended_headers()_fP"><a class="permalink" href="#_fBextended_headers()_fP"><b>extended_headers()</b></a></h2>
This method overrides the headers to be signed and allows more control than is
  possible with the Headers property in the constructor.
<p class="Pp">The method expects a HashRef to be passed in.</p>
<p class="Pp">The Keys are the headers to sign, and the values are either the
    number of headers of that type to sign, or the special values '*' and
  '+'.</p>
<p class="Pp">* will sign ALL headers of that type present in the message.</p>
<p class="Pp">+ will sign ALL + 1 headers of that type present in the message to
    prevent additional headers being added.</p>
<p class="Pp">You may override any of the default headers by including them in
    the hashref, and disable them by giving them a 0 value.</p>
<p class="Pp">Keys are case insensitive with the values being added upto the
    highest value.</p>
<p class="Pp"><span class="Li"></span></p>
<pre>
    Headers =&gt; {
        'X-test'  =&gt; '*',
        'x-test'  =&gt; '1',
        'Subject' =&gt; '+',
        'Sender'  =&gt; 0,
    },
</pre>
</section>
<section class="Ss">
<h2 class="Ss" id="_fBadd_signature()_fP"><a class="permalink" href="#_fBadd_signature()_fP"><b>add_signature()</b></a></h2>
Used by signer policy to create a new signature.
<p class="Pp"><span class="Li"></span></p>
<pre>
  $signer-&gt;add_signature(new Mail::DKIM::Signature(...));
</pre>
<p class="Pp">Signer policies can use this method to specify complete parameters
    for the signature to add, including what type of signature. For more
    information, see Mail::DKIM::SignerPolicy.</p>
</section>
<section class="Ss">
<h2 class="Ss" id="_fBalgorithm()_fP"><a class="permalink" href="#_fBalgorithm()_fP"><b>algorithm()</b></a></h2>
Get or set the selected algorithm.
<p class="Pp"><span class="Li"></span></p>
<pre>
  $alg = $signer-&gt;algorithm;

  $signer-&gt;algorithm('rsa-sha256');
</pre>
</section>
<section class="Ss">
<h2 class="Ss" id="_fBdomain()_fP"><a class="permalink" href="#_fBdomain()_fP"><b>domain()</b></a></h2>
Get or set the selected domain.
<p class="Pp"><span class="Li"></span></p>
<pre>
  $alg = $signer-&gt;domain;

  $signer-&gt;domain('example.org');
</pre>
</section>
<section class="Ss">
<h2 class="Ss" id="_fBload()_fP"><a class="permalink" href="#_fBload()_fP"><b>load()</b></a></h2>
Load the entire message from a file handle.
<p class="Pp"><span class="Li"></span></p>
<pre>
  $signer-&gt;load($file_handle);
</pre>
<p class="Pp">Reads a complete message from the designated file handle, feeding
    it into the signer. The message must use &lt;CRLF&gt; line terminators (same
    as the SMTP protocol).</p>
</section>
<section class="Ss">
<h2 class="Ss" id="_fBheaders()_fP"><a class="permalink" href="#_fBheaders()_fP"><b>headers()</b></a></h2>
Determine which headers to put in signature.
<p class="Pp"><span class="Li"></span></p>
<pre>
  my $headers = $signer-&gt;headers;
</pre>
<p class="Pp">This is a string containing the names of the header fields that
    will be signed, separated by colons.</p>
</section>
<section class="Ss">
<h2 class="Ss" id="_fBkey()_fP"><a class="permalink" href="#_fBkey()_fP"><b>key()</b></a></h2>
Get or set the private key object.
<p class="Pp"><span class="Li"></span></p>
<pre>
  my $key = $signer-&gt;key;

  $signer-&gt;key(Mail::DKIM::PrivateKey-&gt;load(File =&gt; 'private.key'));
</pre>
<p class="Pp">The key object can be any object that implements the
    <b>sign_digest()</b> method. (Providing your own object can be useful if
    your actual keys are stored out-of-process.)</p>
<p class="Pp">If you use this method to specify a private key, do not use
    &quot;<b>key_file()</b>&quot;.</p>
</section>
<section class="Ss">
<h2 class="Ss" id="_fBkey_file()_fP"><a class="permalink" href="#_fBkey_file()_fP"><b>key_file()</b></a></h2>
Get or set the filename containing the private key.
<p class="Pp"><span class="Li"></span></p>
<pre>
  my $filename = $signer-&gt;key_file;

  $signer-&gt;key_file('private.key');
</pre>
<p class="Pp">If you use this method to specify a private key file, do not use
    &quot;<b>key()</b>&quot;.</p>
</section>
<section class="Ss">
<h2 class="Ss" id="_fBmessage_originator()_fP"><a class="permalink" href="#_fBmessage_originator()_fP"><b>message_originator()</b></a></h2>
Access the &quot;From&quot; header.
<p class="Pp"><span class="Li"></span></p>
<pre>
  my $address = $signer-&gt;message_originator;
</pre>
<p class="Pp">Returns the &quot;originator address&quot; found in the message,
    as a Mail::Address object. This is typically the (first) name and email
    address found in the From: header. If there is no From: header, then an
    empty Mail::Address object is returned.</p>
<p class="Pp">To get just the email address part, do:</p>
<p class="Pp"><span class="Li"></span></p>
<pre>
  my $email = $signer-&gt;message_originator-&gt;address;
</pre>
<p class="Pp">See also &quot;<b>message_sender()</b>&quot;.</p>
</section>
<section class="Ss">
<h2 class="Ss" id="_fBmessage_sender()_fP"><a class="permalink" href="#_fBmessage_sender()_fP"><b>message_sender()</b></a></h2>
Access the &quot;From&quot; or &quot;Sender&quot; header.
<p class="Pp"><span class="Li"></span></p>
<pre>
  my $address = $dkim-&gt;message_sender;
</pre>
<p class="Pp">Returns the &quot;sender&quot; found in the message, as a
    Mail::Address object. This is typically the (first) name and email address
    found in the Sender: header. If there is no Sender: header, it is the first
    name and email address in the From: header. If neither header is present,
    then an empty Mail::Address object is returned.</p>
<p class="Pp">To get just the email address part, do:</p>
<p class="Pp"><span class="Li"></span></p>
<pre>
  my $email = $dkim-&gt;message_sender-&gt;address;
</pre>
<p class="Pp">The &quot;sender&quot; is the mailbox of the agent responsible for
    the actual transmission of the message. For example, if a secretary were to
    send a message for another person, the &quot;sender&quot; would be the
    secretary and the &quot;originator&quot; would be the actual author.</p>
</section>
<section class="Ss">
<h2 class="Ss" id="_fBselector()_fP"><a class="permalink" href="#_fBselector()_fP"><b>selector()</b></a></h2>
Get or set the current key selector.
<p class="Pp"><span class="Li"></span></p>
<pre>
  $alg = $dkim-&gt;selector;

  $dkim-&gt;selector('alpha');
</pre>
</section>
<section class="Ss">
<h2 class="Ss" id="_fBsignatures()_fP"><a class="permalink" href="#_fBsignatures()_fP"><b>signatures()</b></a></h2>
Access list of generated signature objects.
<p class="Pp"><span class="Li"></span></p>
<pre>
  my @signatures = $dkim-&gt;signatures;
</pre>
<p class="Pp">Returns all generated signatures, as a list.</p>
</section>
<section class="Ss">
<h2 class="Ss" id="_fBas_string()_fP"><a class="permalink" href="#_fBas_string()_fP"><b>as_string()</b></a></h2>
Returns the new ARC headers
<p class="Pp"><span class="Li"></span></p>
<pre>
  my $pre_headers = $signer-&gt;as_string();
</pre>
<p class="Pp">The headers are separated by \015\012 (SMTP line separator)
    including a trailing separator, so can be directly injected in front of the
    raw message.</p>
</section>
<section class="Ss">
<h2 class="Ss" id="_fBas_strings()_fP"><a class="permalink" href="#_fBas_strings()_fP"><b>as_strings()</b></a></h2>
Returns the new ARC headers
<p class="Pp"><span class="Li"></span></p>
<pre>
  my @pre_headers = $signer-&gt;as_string();
</pre>
<p class="Pp">The headers are returned as a list so you can add whatever line
    ending your local MTA prefers.</p>
</section>
</section>
<section class="Sh">
<h1 class="Sh" id="AUTHOR"><a class="permalink" href="#AUTHOR">AUTHOR</a></h1>
Bron Gondwana, &lt;brong@fastmailteam.com&gt;
</section>
<section class="Sh">
<h1 class="Sh" id="COPYRIGHT_AND_LICENSE"><a class="permalink" href="#COPYRIGHT_AND_LICENSE">COPYRIGHT
  AND LICENSE</a></h1>
Copyright (C) 2017 FastMail Pty Ltd
<p class="Pp">This library is free software; you can redistribute it and/or
    modify it under the same terms as Perl itself, either Perl version 5.8.6 or,
    at your option, any later version of Perl 5 you may have available.</p>
</section>
</div>
<table class="foot">
  <tr>
    <td class="foot-date">2019-11-13</td>
    <td class="foot-os">perl v5.30.2</td>
  </tr>
</table>
</body>
</html>
