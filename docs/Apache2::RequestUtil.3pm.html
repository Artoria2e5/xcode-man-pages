<!DOCTYPE html>
<html>
<!-- This is an automatically generated file.  Do not edit.
   Automatically generated by Pod::Man 2.27 (Pod::Simple 3.28)
  
   Standard preamble:
   ========================================================================
   Vertical space (when we can't use .PP)
   Begin verbatim text
   End verbatim text
   Set up some character translations and predefined strings.  \*(-- will
   give an unbreakable dash, \*(PI will give pi, \*(L" will give a left
   double quote, and \*(R" will give a right double quote.  \*(C+ will
   give a nicer C++.  Capital omega is used to do unbreakable dashes and
   therefore won't be available.  \*(C` and \*(C' expand to `' in nroff,
   nothing in troff, for use with C<>.
   diablo 10 pitch
    diablo 12 pitch
 -->
<head>
  <meta charset="utf-8"/>
  <style>
    table.head, table.foot { width: 100%; }
    td.head-rtitle, td.foot-os { text-align: right; }
    td.head-vol { text-align: center; }
    div.Pp { margin: 1ex 0ex; }
    div.Nd, div.Bf, div.Op { display: inline; }
    span.Pa, span.Ad { font-style: italic; }
    span.Ms { font-weight: bold; }
    dl.Bl-diag > dt { font-weight: bold; }
    code.Nm, code.Fl, code.Cm, code.Ic, code.In, code.Fd, code.Fn,
    code.Cd { font-weight: bold; font-family: inherit; }
  </style>
  <title>install::TempContent::Objects::mod_perl-2.0.9::docs::api::Apache2::RequestUtil(3)</title>
</head>
<body>
<table class="head">
  <tr>
    <td class="head-ltitle">install::TempContent::Objects::mod_perl-2.0.9::docs::api::Apache2::RequestUtil(3)</td>
    <td class="head-vol">User Contributed Perl Documentation</td>
    <td class="head-rtitle">install::TempContent::Objects::mod_perl-2.0.9::docs::api::Apache2::RequestUtil(3)</td>
  </tr>
</table>
<div class="manual-text">
<br/>
<section class="Sh">
<h1 class="Sh" id="NAME"><a class="permalink" href="#NAME">NAME</a></h1>
Apache2::RequestUtil - Perl API for Apache request record utils
</section>
<section class="Sh">
<h1 class="Sh" id="Synopsis"><a class="permalink" href="#Synopsis">Synopsis</a></h1>
<span class="Li"></span>
<pre>
  use Apache2::RequestUtil ();
  
  # add httpd config dynamically
  $r-&gt;add_config(['require valid-user']);
  
  # dump the request object as a string
  print $r-&gt;as_string();
  
  # default content_type
  $content_type = $r-&gt;default_type();
  
  # get PerlSetVar/PerlAddVar values
  @values = $r-&gt;dir_config-&gt;get($key);
  
  # get server docroot
  $docroot = $r-&gt;document_root();
  
  # set server docroot
  $r-&gt;document_root($new_root);
  
  # what are the registered perl handlers for a given phase
  my @handlers = @{ $r-&gt;get_handlers('PerlResponseHandler') || [] };
  
  # push a new handler for a given phase
  $r-&gt;push_handlers(PerlCleanupHandler =&gt; \&amp;handler);
  
  # set handlers for a given phase (resetting previous values)
  $r-&gt;set_handlers(PerlCleanupHandler =&gt; []);
  
  # what's the request body limit
  $limit = $r-&gt;get_limit_req_body();
  
  # server and port names
  $server = $r-&gt;get_server_name();
  $port   = $r-&gt;get_server_port();
  
  # what string Apache is going to send for a given status code
  $status_line = Apache2::RequestUtil::get_status_line(404);
  
  # are we in the main request?
  $is_initial = $r-&gt;is_initial_req();
  
  # directory level PerlOptions flags lookup
  $r-&gt;subprocess_env unless $r-&gt;is_perl_option_enabled('SetupEnv');
  
  # current &lt;Location&gt; value
  $location = $r-&gt;location();
  
  # merge a &lt;Location&gt; container in a request object
  $r-&gt;location_merge($location);
  
  # create a new Apache2::RequestRec object
  $r = Apache2::RequestRec-&gt;new($c);
  
  # tell the client not to cache the response
  $r-&gt;no_cache($boolean);
  
  # share perl objects by reference like $r-&gt;notes
  $r-&gt;pnotes($key =&gt; [$obj1, $obj2]);
  
  # get HTML signature
  $sig = $r-&gt;psignature($prefix);
  
  # get the global request object (requires PerlOptions +GlobalRequest)
  $r = Apache2::RequestUtil-&gt;request;
  
  # insert auth credentials into the request as if the client did that
  $r-&gt;set_basic_credentials($username, $password);
  
  # slurp the contents of $r-&gt;filename
  my $content = ${ $r-&gt;slurp_filename() };
  
  # terminate the current child after this request
  $r-&gt;child_terminate();
</pre>
</section>
<section class="Sh">
<h1 class="Sh" id="Description"><a class="permalink" href="#Description">Description</a></h1>
<span class="Li">&quot;Apache2::RequestUtil&quot;</span> provides the Apache
  request object utilities API.
</section>
<section class="Sh">
<h1 class="Sh" id="API"><a class="permalink" href="#API">API</a></h1>
<section class="Ss">
<h2 class="Ss" id="_add_config_"><a class="permalink" href="#_add_config_">&quot;add_config&quot;</a></h2>
Dynamically add Apache configuration at request processing runtime:
<p class="Pp"><span class="Li"></span></p>
<pre>
  $r-&gt;add_config($lines);
  $r-&gt;add_config($lines, $override);
  $r-&gt;add_config($lines, $override, $path);
  $r-&gt;add_config($lines, $override, $path, $override_opts);
</pre>
<p class="Pp">Configuration directives are processed as if given in a
    <span class="Li">&quot;&lt;Location&gt;&quot;</span> block.</p>
<dl class="Bl-tag">
  <dt>obj: $r ( &quot;Apache2::RequestRec object&quot; )</dt>
  <dd></dd>
  <dt>arg1: $lines (ARRAY ref)</dt>
  <dd>An ARRAY reference containing configuration lines per element, without the
      new line terminators.</dd>
  <dt>opt arg2: $override ( &quot;Apache2::Const override constant&quot; )</dt>
  <dd>Which allow-override bits are set
    <p class="Pp">Default value is:
        <span class="Li">&quot;Apache2::Const::OR_AUTHCFG&quot;</span></p>
  </dd>
  <dt>opt arg3: $path ( string )</dt>
  <dd>Set the <span class="Li">&quot;Apache2::CmdParms object&quot;</span>
      <span class="Li">&quot;path&quot;</span> component. This is the path of
      the <span class="Li">&quot;&lt;Location&gt;&quot;</span> block. Some
      directives need this, for example
      <span class="Li">&quot;ProxyPassReverse&quot;</span>.
    <p class="Pp">If an empty string is passed a
        <span class="Li">&quot;NULL&quot;</span> pointer is passed further at
        C-level. This is necessary to make something like this work:</p>
    <p class="Pp"><span class="Li"></span></p>
    <pre>
  $r-&gt;add_config( [
                   '&lt;Directory /&gt;',
                   'AllowOverride Options AuthConfig',
                   '&lt;/Directory&gt;',
                  ], ~0, '' );
    </pre>
    <p class="Pp">Note: <span class="Li">&quot;AllowOverride&quot;</span> is
        valid only in directory context.</p>
    <p class="Pp"><b>Caution:</b> Some directives need a non-empty path
        otherwise they cause segfaults. Thus, use the empty path with
      caution.</p>
    <p class="Pp">Default value is: <span class="Li">&quot;/&quot;</span></p>
  </dd>
  <dt>opt arg4: $override_opts ( &quot;Apache2::Const options constant&quot;
    )</dt>
  <dd>Apache limits the applicable directives in certain situations with
      <span class="Li">&quot;AllowOverride&quot;</span>. With Apache 2.2 comes
      the possibility to enable or disable single options, for example
    <p class="Pp"><span class="Li"></span></p>
    <pre>
  AllowOverride AuthConfig Options=ExecCGI,Indexes
    </pre>
    <p class="Pp">Internally, this directive is parsed into 2 bit fields that
        are represented by the <span class="Li">$override</span> and
        <span class="Li">$override_opts</span> parameters to
        <span class="Li">&quot;add_config&quot;</span>. The above example is
        parsed into an <span class="Li">$override</span> with 2 bits set, one
        for <span class="Li">&quot;AuthConfig&quot;</span> the other for
        <span class="Li">&quot;Options&quot;</span> and an
        <span class="Li">$override_opts</span> with 2 bits set for ExecCGI and
        Indexes.</p>
    <p class="Pp">When applying other directives, for example
        <span class="Li">&quot;AuthType&quot;</span> or
        <span class="Li">&quot;Options&quot;</span> the appropriate bits in
        <span class="Li">$override</span> must be set. For the
        <span class="Li">&quot;Options&quot;</span> directive additionally
        <span class="Li">$override_opts</span> bits must be set.</p>
    <p class="Pp">The <span class="Li">$override</span> and
        <span class="Li">$override_opts</span> parameters to
        <span class="Li">&quot;add_config&quot;</span> are valid while applying
        <span class="Li">$lines</span>.</p>
    <p class="Pp"><span class="Li">$override_opts</span> is new in Apache 2.2.
        The mod_perl implementation for Apache 2.0 lets you pass the parameter
        but ignores it.</p>
    <p class="Pp">Default for <span class="Li">$override_opts</span> is:
        <span class="Li">&quot;Apache2::Const::OPT_UNSET&quot;</span> |
        <span class="Li">&quot;Apache2::Const::OPT_ALL&quot;</span> |
        <span class="Li">&quot;Apache2::Const::OPT_INCNOEXEC&quot;</span> |
        <span class="Li">&quot;Apache2::Const::OPT_SYM_OWNER&quot;</span> |
        <span class="Li">&quot;Apache2::Const::OPT_MULTI&quot;</span></p>
    <p class="Pp">That means, all options are allowed.</p>
  </dd>
  <dt>ret: no return value</dt>
  <dd></dd>
  <dt>since: 2.0.00, $path and $override_opts since 2.0.3</dt>
  <dd></dd>
</dl>
<p class="Pp">See also:
  <span class="Li">&quot;$s-&gt;add_config&quot;</span></p>
<p class="Pp">For example:</p>
<p class="Pp"><span class="Li"></span></p>
<pre>
  use Apache2::RequestUtil ();
  use Apache2::Access ();

  $r-&gt;add_config(['require valid-user']);

  # this regards the current AllowOverride setting
  $r-&gt;add_config(['AuthName secret',
                  'AuthType Basic',
                  'Options ExecCGI'],
                 $r-&gt;allow_override, $path, $r-&gt;allow_override_opts);
</pre>
</section>
<section class="Ss">
<h2 class="Ss" id="_as_string_"><a class="permalink" href="#_as_string_">&quot;as_string&quot;</a></h2>
Dump the request object as a string
<p class="Pp"><span class="Li"></span></p>
<pre>
  $dump = $r-&gt;as_string();
</pre>
<dl class="Bl-tag">
  <dt>obj: $r ( &quot;Apache2::RequestRec object&quot; )</dt>
  <dd></dd>
  <dt>ret: $dump ( string )</dt>
  <dd></dd>
  <dt>since: 2.0.00</dt>
  <dd></dd>
</dl>
<p class="Pp">Dumps various request and response headers (mainly useful for
    debugging)</p>
</section>
<section class="Ss">
<h2 class="Ss" id="_child_terminate_"><a class="permalink" href="#_child_terminate_">&quot;child_terminate&quot;</a></h2>
Terminate the current worker process as soon as the current request is over
<p class="Pp"><span class="Li"></span></p>
<pre>
  $r-&gt;child_terminate();
</pre>
<dl class="Bl-tag">
  <dt>obj: $r ( &quot;Apache2::RequestRec object&quot; )</dt>
  <dd></dd>
  <dt>ret: no return value</dt>
  <dd></dd>
  <dt>since: 2.0.00</dt>
  <dd></dd>
</dl>
<p class="Pp">This method is not supported in threaded MPMs</p>
</section>
<section class="Ss">
<h2 class="Ss" id="_default_type_"><a class="permalink" href="#_default_type_">&quot;default_type&quot;</a></h2>
Retrieve the value of the DefaultType directive for the current request. If not
  set <span class="Li">&quot;text/plain&quot;</span> is returned.
<p class="Pp"><span class="Li"></span></p>
<pre>
  $content_type = $r-&gt;default_type();
</pre>
<dl class="Bl-tag">
  <dt>obj: $r ( &quot;Apache2::RequestRec object&quot; )</dt>
  <dd>The current request</dd>
  <dt>ret: $content_type ( string )</dt>
  <dd>The default type</dd>
  <dt>since: 2.0.00</dt>
  <dd></dd>
  <dt>removed from the &quot;httpd&quot; API in version 2.3.2</dt>
  <dd></dd>
</dl>
</section>
<section class="Ss">
<h2 class="Ss" id="_dir_config_"><a class="permalink" href="#_dir_config_">&quot;dir_config&quot;</a></h2>
<span class="Li">&quot;$r-&gt;dir_config()&quot;</span> provides an interface
  for the per-directory variable specified by the
  <span class="Li">&quot;PerlSetVar&quot;</span> and
  <span class="Li">&quot;PerlAddVar&quot;</span> directives, and also can be
  manipulated via the <span class="Li">&quot;APR::Table&quot;</span> methods.
<p class="Pp"><span class="Li"></span></p>
<pre>
  $table  = $r-&gt;dir_config();
  $value  = $r-&gt;dir_config($key);
  @values = $r-&gt;dir_config-&gt;get($key);
  $r-&gt;dir_config($key, $val);
</pre>
<dl class="Bl-tag">
  <dt>obj: $r ( &quot;Apache2::RequestRec object&quot; )</dt>
  <dd></dd>
  <dt>opt arg2: $key ( string )</dt>
  <dd>Key string</dd>
  <dt>opt arg3: $val ( string )</dt>
  <dd>Value string</dd>
  <dt>ret: ...</dt>
  <dd>Depends on the passed arguments, see further discussion</dd>
  <dt>since: 2.0.00</dt>
  <dd></dd>
</dl>
<p class="Pp">The keys are case-insensitive.</p>
<p class="Pp"><span class="Li"></span></p>
<pre>
  $apr_table = $r-&gt;dir_config();
</pre>
<p class="Pp"><i>dir_config()</i> called in a scalar context without the
    <span class="Li">$key</span> argument returns a <i>HASH</i> reference
    blessed into the <span class="Li">&quot;APR::Table&quot;</span> class. This
    object can be manipulated via the
    <span class="Li">&quot;APR::Table&quot;</span> methods. For available
    methods see the <span class="Li">&quot;APR::Table&quot;</span> manpage.</p>
<p class="Pp"><span class="Li"></span></p>
<pre>
  $value = $r-&gt;dir_config($key);
</pre>
<p class="Pp">If the <span class="Li">$key</span> argument is passed in the
    scalar context only a single value will be returned. Since the table
    preserves the insertion order, if there is more than one value for the same
    key, the oldest value assosiated with the desired key is returned. Calling
    in the scalar context is also much faster, as it'll stop searching the table
    as soon as the first match happens.</p>
<p class="Pp"><span class="Li"></span></p>
<pre>
  @values = $r-&gt;dir_config-&gt;get($key);
</pre>
<p class="Pp">To receive a list of values you must use
    <span class="Li">&quot;get()&quot;</span> method from the
    <span class="Li">&quot;APR::Table&quot;</span> class.</p>
<p class="Pp"><span class="Li"></span></p>
<pre>
  $r-&gt;dir_config($key =&gt; $val);
</pre>
<p class="Pp">If the <span class="Li">$key</span> and the
    <span class="Li">$val</span> arguments are used, the <i>set()</i> operation
    will happen: all existing values associated with the key
    <span class="Li">$key</span> (and the key itself) will be deleted and
    <span class="Li">$value</span> will be placed instead.</p>
<p class="Pp"><span class="Li"></span></p>
<pre>
  $r-&gt;dir_config($key =&gt; undef);
</pre>
<p class="Pp">If <span class="Li">$val</span> is <i>undef</i> the <i>unset()</i>
    operation will happen: all existing values associated with the key
    <span class="Li">$key</span> (and the key itself) will be deleted.</p>
</section>
<section class="Ss">
<h2 class="Ss" id="_document_root_"><a class="permalink" href="#_document_root_">&quot;document_root&quot;</a></h2>
Retrieve the document root for this server
<p class="Pp"><span class="Li"></span></p>
<pre>
  $docroot = $r-&gt;document_root();
  $docroot = $r-&gt;document_root($new_root);
</pre>
<dl class="Bl-tag">
  <dt>obj: $r ( &quot;Apache2::RequestRec object&quot; )</dt>
  <dd>The current request</dd>
  <dt>opt arg1: $new_root</dt>
  <dd>Sets the document root to a new value <b>only for the duration of the</b>
      <b>current request</b>.
    <p class="Pp">Note the limited functionality under threaded MPMs.</p>
  </dd>
  <dt>ret: $docroot ( string )</dt>
  <dd>The document root</dd>
  <dt>since: 2.0.00</dt>
  <dd></dd>
</dl>
</section>
<section class="Ss">
<h2 class="Ss" id="_get_handlers_"><a class="permalink" href="#_get_handlers_">&quot;get_handlers&quot;</a></h2>
Returns a reference to a list of handlers enabled for a given phase.
<p class="Pp"><span class="Li"></span></p>
<pre>
  $handlers_list = $r-&gt;get_handlers($hook_name);
</pre>
<dl class="Bl-tag">
  <dt>obj: $r ( &quot;Apache2::RequestRec object&quot; )</dt>
  <dd></dd>
  <dt>arg1: $hook_name ( string )</dt>
  <dd>a string representing the phase to handle (e.g.
      <span class="Li">&quot;PerlLogHandler&quot;</span>)</dd>
  <dt>ret: $handlers_list (ref to an ARRAY of CODE refs)</dt>
  <dd>a list of handler subroutines CODE references</dd>
  <dt>since: 2.0.00</dt>
  <dd></dd>
</dl>
<p class="Pp">See also:
  <span class="Li">&quot;$s-&gt;add_config&quot;</span></p>
<p class="Pp">For example:</p>
<p class="Pp">A list of handlers configured to run at the response phase:</p>
<p class="Pp"><span class="Li"></span></p>
<pre>
  my @handlers = @{ $r-&gt;get_handlers('PerlResponseHandler') || [] };
</pre>
</section>
<section class="Ss">
<h2 class="Ss" id="_get_limit_req_body_"><a class="permalink" href="#_get_limit_req_body_">&quot;get_limit_req_body&quot;</a></h2>
Return the limit on bytes in request msg body
<p class="Pp"><span class="Li"></span></p>
<pre>
  $limit = $r-&gt;get_limit_req_body();
</pre>
<dl class="Bl-tag">
  <dt>obj: $r ( &quot;Apache2::RequestRec object&quot; )</dt>
  <dd>The current request</dd>
  <dt>ret: $limit (integer)</dt>
  <dd>the maximum number of bytes in the request msg body</dd>
  <dt>since: 2.0.00</dt>
  <dd></dd>
</dl>
</section>
<section class="Ss">
<h2 class="Ss" id="_get_server_name_"><a class="permalink" href="#_get_server_name_">&quot;get_server_name&quot;</a></h2>
Get the current request's server name
<p class="Pp"><span class="Li"></span></p>
<pre>
  $server = $r-&gt;get_server_name();
</pre>
<dl class="Bl-tag">
  <dt>obj: $r ( &quot;Apache2::RequestRec object&quot; )</dt>
  <dd>The current request</dd>
  <dt>ret: $server ( string )</dt>
  <dd>the server name</dd>
  <dt>since: 2.0.00</dt>
  <dd></dd>
</dl>
<p class="Pp">For example, consruct a hostport string:</p>
<p class="Pp"><span class="Li"></span></p>
<pre>
  use Apache2::RequestUtil ();
  my $hostport = join ':', $r-&gt;get_server_name, $r-&gt;get_server_port;
</pre>
</section>
<section class="Ss">
<h2 class="Ss" id="_get_server_port_"><a class="permalink" href="#_get_server_port_">&quot;get_server_port&quot;</a></h2>
Get the current server port
<p class="Pp"><span class="Li"></span></p>
<pre>
  $port = $r-&gt;get_server_port();
</pre>
<dl class="Bl-tag">
  <dt>obj: $r ( &quot;Apache2::RequestRec object&quot; )</dt>
  <dd>The current request</dd>
  <dt>ret: $port ( integer )</dt>
  <dd>The server's port number</dd>
  <dt>since: 2.0.00</dt>
  <dd></dd>
</dl>
<p class="Pp">For example, consruct a hostport string:</p>
<p class="Pp"><span class="Li"></span></p>
<pre>
  use Apache2::RequestUtil ();
  my $hostport = join ':', $r-&gt;get_server_name, $r-&gt;get_server_port;
</pre>
</section>
<section class="Ss">
<h2 class="Ss" id="_get_status_line_"><a class="permalink" href="#_get_status_line_">&quot;get_status_line&quot;</a></h2>
Return the <span class="Li">&quot;Status-Line&quot;</span> for a given status
  code (excluding the HTTP-Version field).
<p class="Pp"><span class="Li"></span></p>
<pre>
  $status_line = Apache2::RequestUtil::get_status_line($status);
</pre>
<dl class="Bl-tag">
  <dt>arg1: $status (integer)</dt>
  <dd>The HTTP status code</dd>
  <dt>ret: $status_line ( string )</dt>
  <dd>The Status-Line
    <p class="Pp">If an invalid or unknown status code is passed,
        <span class="Li">&quot;500 Internal Server</span>
        <span class="Li">Error&quot;</span> will be returned.</p>
  </dd>
  <dt>since: 2.0.00</dt>
  <dd></dd>
</dl>
<p class="Pp">For example:</p>
<p class="Pp"><span class="Li"></span></p>
<pre>
  use Apache2::RequestUtil ();
  print Apache2::RequestUtil::get_status_line(400);
</pre>
<p class="Pp">will print:</p>
<p class="Pp"><span class="Li"></span></p>
<pre>
  400 Bad Request
</pre>
</section>
<section class="Ss">
<h2 class="Ss" id="_is_initial_req_"><a class="permalink" href="#_is_initial_req_">&quot;is_initial_req&quot;</a></h2>
Determine whether the current request is the main request or a sub-request
<p class="Pp"><span class="Li"></span></p>
<pre>
  $is_initial = $r-&gt;is_initial_req();
</pre>
<dl class="Bl-tag">
  <dt>obj: $r ( &quot;Apache2::RequestRec object&quot; )</dt>
  <dd>A request or a sub-request object</dd>
  <dt>ret: $is_initial ( boolean )</dt>
  <dd>If true -- it's the main request, otherwise it's a sub-request</dd>
  <dt>since: 2.0.00</dt>
  <dd></dd>
</dl>
</section>
<section class="Ss">
<h2 class="Ss" id="_is_perl_option_enabled_"><a class="permalink" href="#_is_perl_option_enabled_">&quot;is_perl_option_enabled&quot;</a></h2>
check whether a directory level <span class="Li">&quot;PerlOptions&quot;</span>
  flag is enabled or not.
<p class="Pp"><span class="Li"></span></p>
<pre>
  $result = $r-&gt;is_perl_option_enabled($flag);
</pre>
<dl class="Bl-tag">
  <dt>obj: $r ( &quot;Apache2::RequestRec object&quot; )</dt>
  <dd></dd>
  <dt>arg1: $flag ( string )</dt>
  <dd></dd>
  <dt>ret: $result ( boolean )</dt>
  <dd></dd>
  <dt>since: 2.0.00</dt>
  <dd></dd>
</dl>
<p class="Pp">For example to check whether the
    <span class="Li">&quot;SetupEnv&quot;</span> option is enabled for the
    current request (which can be disabled with
    <span class="Li">&quot;PerlOptions -SetupEnv&quot;</span>) and populate the
    environment variables table if disabled:</p>
<p class="Pp"><span class="Li"></span></p>
<pre>
  $r-&gt;subprocess_env unless $r-&gt;is_perl_option_enabled('SetupEnv');
</pre>
<p class="Pp">See also: PerlOptions and the equivalent function for server level
    PerlOptions flags.</p>
</section>
<section class="Ss">
<h2 class="Ss" id="_location_"><a class="permalink" href="#_location_">&quot;location&quot;</a></h2>
Get the path of the &lt;Location&gt; section from which the current
  <span class="Li">&quot;Perl*Handler&quot;</span> is being called.
<p class="Pp"><span class="Li"></span></p>
<pre>
  $location = $r-&gt;location();
</pre>
<dl class="Bl-tag">
  <dt>obj: $r ( &quot;Apache2::RequestRec object&quot; )</dt>
  <dd></dd>
  <dt>ret: $location ( string )</dt>
  <dd></dd>
  <dt>since: 2.0.00</dt>
  <dd></dd>
</dl>
</section>
<section class="Ss">
<h2 class="Ss" id="_location_merge_"><a class="permalink" href="#_location_merge_">&quot;location_merge&quot;</a></h2>
Merge a given <span class="Li">&quot;&lt;Location&gt;&quot;</span> container
  into the current request object:
<p class="Pp"><span class="Li"></span></p>
<pre>
  $ret = $r-&gt;location_merge($location);
</pre>
<dl class="Bl-tag">
  <dt>obj: $r ( &quot;Apache2::RequestRec object&quot; )</dt>
  <dd></dd>
  <dt>arg1: $location ( string )</dt>
  <dd>The argument in a <span class="Li">&quot;&lt;Location&gt;&quot;</span>
      section. For example to merge a container:
    <p class="Pp"><span class="Li"></span></p>
    <pre>
  &lt;Location /foo&gt;
      ...
  &lt;/Location&gt;
    </pre>
    <p class="Pp">that argument will be <i>/foo</i></p>
  </dd>
  <dt>ret: $ret ( boolean )</dt>
  <dd>a true value if the merge was successful (i.e. the request
      <span class="Li">$location</span> match was found), otherwise false.</dd>
  <dt>since: 2.0.00</dt>
  <dd></dd>
</dl>
<p class="Pp">Useful for insertion of a configuration section into a custom
    <span class="Li">&quot;Apache2::RequestRec&quot;</span> object, created via
    the <span class="Li">&quot;Apache2::RequestRec-&gt;new()&quot;</span>
    method. See for example the Command Server protocol example.</p>
</section>
<section class="Ss">
<h2 class="Ss" id="_new_"><a class="permalink" href="#_new_">&quot;new&quot;</a></h2>
Create a new <span class="Li">&quot;Apache2::RequestRec&quot;</span> object.
<p class="Pp"><span class="Li"></span></p>
<pre>
  $r = Apache2::RequestRec-&gt;new($c);
  $r = Apache2::RequestRec-&gt;new($c, $pool);
</pre>
<dl class="Bl-tag">
  <dt>obj: &quot;Apache2::RequestRec&quot; ( &quot;Apache2::RequestRec class
    name&quot; )</dt>
  <dd></dd>
  <dt>arg1: $c (&quot;Apache2::Connection object&quot;)</dt>
  <dd></dd>
  <dt>opt arg2: $pool</dt>
  <dd>If no <span class="Li">$pool</span> argument is passed,
      <span class="Li">&quot;$c-&gt;pool&quot;</span> is used. That means that
      the created <span class="Li">&quot;Apache2::RequestRec&quot;</span> object
      will be valid as long as the connection object is valid.</dd>
  <dt>ret: $r ( &quot;Apache2::RequestRec object&quot; )</dt>
  <dd></dd>
  <dt>since: 2.0.00</dt>
  <dd></dd>
</dl>
<p class="Pp">It's possible to reuse the HTTP framework features outside the
    familiar HTTP request cycle. It's possible to write your own full or partial
    HTTP implementation without needing a running Apache server. You will need
    the <span class="Li">&quot;Apache2::RequestRec&quot;</span> object in order
    to be able to reuse the rich functionality supplied via this object.</p>
<p class="Pp">See for example the Command Server protocol example which reuses
    HTTP AAA model under non-HTTP protocol.</p>
</section>
<section class="Ss">
<h2 class="Ss" id="_no_cache_"><a class="permalink" href="#_no_cache_">&quot;no_cache&quot;</a></h2>
Add/remove cache control headers:
<p class="Pp"><span class="Li"></span></p>
<pre>
  $prev_no_cache = $r-&gt;no_cache($boolean);
</pre>
<dl class="Bl-tag">
  <dt>obj: $r ( &quot;Apache2::RequestRec object&quot; )</dt>
  <dd></dd>
  <dt>arg1: $boolean ( boolean )</dt>
  <dd>A true value sets the <span class="Li">&quot;no_cache&quot;</span> request
      record member to a true value and inserts:
    <p class="Pp"><span class="Li"></span></p>
    <pre>
  Pragma: no-cache
  Cache-control: no-cache
    </pre>
    <p class="Pp">into the response headers, indicating that the data being
        returned is volatile and the client should not cache it.</p>
    <p class="Pp">A false value unsets the
        <span class="Li">&quot;no_cache&quot;</span> request record member and
        the mentioned headers if they were previously set.</p>
  </dd>
  <dt>ret: $prev_no_cache ( boolean )</dt>
  <dd>Should you care, the <span class="Li">&quot;no_cache&quot;</span> request
      record member value prior to the change is returned.</dd>
  <dt>since: 2.0.00</dt>
  <dd></dd>
</dl>
<p class="Pp">This method should be invoked before any response data has been
    sent out.</p>
</section>
<section class="Ss">
<h2 class="Ss" id="_pnotes_"><a class="permalink" href="#_pnotes_">&quot;pnotes&quot;</a></h2>
Share Perl variables between Perl HTTP handlers
<p class="Pp"><span class="Li"></span></p>
<pre>
  # to share variables by value and not reference, $val should be a lexical.
  $old_val  = $r-&gt;pnotes($key =&gt; $val);
  $val      = $r-&gt;pnotes($key);
  $hash_ref = $r-&gt;pnotes();
</pre>
<p class="Pp"><b>Note:</b> sharing variables really means it. The variable is
    not copied. Only its reference count is incremented. If it is changed after
    being put in pnotes that change also affects the stored value. The following
    example illustrates the effect:</p>
<p class="Pp"><span class="Li"></span></p>
<pre>
  my $v=1;                     my $v=1;
  $r-&gt;pnotes( 'v'=&gt;$v );       $r-&gt;pnotes-&gt;{v}=$v;
  $v++;                        $v++;
  my $x=$r-&gt;pnotes('v');       my $x=$r-&gt;pnotes-&gt;{v};
</pre>
<p class="Pp">In both cases <span class="Li">$x</span> is
    <span class="Li">2</span> not <span class="Li">1</span>. See also
    <span class="Li">&quot;Apache2::SafePnotes&quot;</span> on CPAN.</p>
<p class="Pp">There has been a lot of discussion advocating for pnotes sharing
    variables by value and not reference. Sharing by reference can create
    'spooky action at a distance' effects when the sharing is assumed to share a
    copy of the value. Tim Bunce offers the following summary and suggestion for
    sharing by value.</p>
<p class="Pp">What's wrong with this code:</p>
<p class="Pp"><span class="Li"></span></p>
<pre>
  sub foo {
      my ($r, $status, $why) = @_;
      $r-&gt;pnotes('foo', ($why) ? &quot;$status:$why&quot; : $status);
      return;
  }
</pre>
<p class="Pp">Nothing, except it doesn't work as expected due to this pnotes
    bug: If the same code is called in a sub-request then the pnote of
    <span class="Li">$r</span>-&gt;prev is magically updated at a distance to
    the same value!</p>
<p class="Pp">Try explain why that is to anyone not deeply familar with perl
    internals!</p>
<p class="Pp">The fix is to avoid pnotes taking a ref to the invisible op_targ
    embededed in the code by passing a simple lexical variable as the actual
    argument. That can be done in-line like this:</p>
<p class="Pp"><span class="Li"></span></p>
<pre>
  sub mark_as_internally_redirected {
      my ($r, $status, $why) = @_;
      $r-&gt;pnotes('foo', my $tmp = (($why) ? &quot;$status:$why&quot; : $status));
      return;
  }
</pre>
<dl class="Bl-tag">
  <dt>obj: $r ( &quot;Apache2::RequestRec object&quot; )</dt>
  <dd></dd>
  <dt>opt arg1: $key ( string )</dt>
  <dd>A key value</dd>
  <dt>opt arg2: $val ( SCALAR )</dt>
  <dd>Any scalar value (e.g. a reference to an array)</dd>
  <dt>ret: (3 different possible values)</dt>
  <dd>if both, <span class="Li">$key</span> and <span class="Li">$val</span> are
      passed the previous value for <span class="Li">$key</span> is returned if
      such existed, otherwise <span class="Li">&quot;undef&quot;</span> is
      returned.
    <p class="Pp">if only <span class="Li">$key</span> is passed, the current
        value for the given key is returned.</p>
    <p class="Pp">if no arguments are passed, a hash reference is returned,
        which can then be directly accessed without going through the
        <span class="Li">&quot;pnotes()&quot;</span> interface.</p>
  </dd>
  <dt>since: 2.0.00</dt>
  <dd></dd>
</dl>
<p class="Pp">This method provides functionality similar to
    (<span class="Li">&quot;Apache2::RequestRec::notes&quot;</span>), but values
    can be any Perl variables. That also means that it can be used only between
    Perl modules.</p>
<p class="Pp">The values get reset automatically at the end of each HTTP
    request.</p>
<p class="Pp">Examples:</p>
<p class="Pp">Set a key/value pair:</p>
<p class="Pp"><span class="Li"></span></p>
<pre>
  $r-&gt;pnotes(foo =&gt; [1..5]);
</pre>
<p class="Pp">Get the value:</p>
<p class="Pp"><span class="Li"></span></p>
<pre>
  $val = $r-&gt;pnotes(&quot;foo&quot;);
</pre>
<p class="Pp"><span class="Li">$val</span> now contains an array ref containing
    5 elements (<span class="Li">1..5</span>).</p>
<p class="Pp">Now change the existing value:</p>
<p class="Pp"><span class="Li"></span></p>
<pre>
  $old_val = $r-&gt;pnotes(foo =&gt; ['a'..'c']);
  $val = $r-&gt;pnotes(&quot;foo&quot;);
</pre>
<p class="Pp"><span class="Li">$old_val</span> now contains an array ref with 5
    elements (<span class="Li">1..5</span>) and <span class="Li">$val</span>
    contains an array ref with 3 elements <span class="Li">'a'</span>,
    <span class="Li">'b'</span>, <span class="Li">'c'</span>.</p>
<p class="Pp">Alternatively you can access the hash reference with all pnotes
    values:</p>
<p class="Pp"><span class="Li"></span></p>
<pre>
  $pnotes = $r-&gt;pnotes;
</pre>
<p class="Pp">Now we can read what's in there for the key <i>foo</i>:</p>
<p class="Pp"><span class="Li"></span></p>
<pre>
  $val = $pnotes-&gt;{foo};
</pre>
<p class="Pp">and as before <span class="Li">$val</span> still gives us an array
    ref with 3 elements <span class="Li">'a'</span>,
    <span class="Li">'b'</span>, <span class="Li">'c'</span>.</p>
<p class="Pp">Now we can add elements to it:</p>
<p class="Pp"><span class="Li"></span></p>
<pre>
  push @{ $pnotes{foo} }, 'd'..'f';
</pre>
<p class="Pp">and we can try to retrieve them using the hash and non-hash
  API:</p>
<p class="Pp"><span class="Li"></span></p>
<pre>
  $val1 = $pnotes{foo};
  $val2 = $r-&gt;pnotes(&quot;foo&quot;);
</pre>
<p class="Pp">Both <span class="Li">$val1</span> and
    <span class="Li">$val2</span> contain an array ref with 6 elements (letters
    'a' to 'f').</p>
<p class="Pp">Finally to reset an entry you could just assign
    <span class="Li">&quot;undef&quot;</span> as a value:</p>
<p class="Pp"><span class="Li"></span></p>
<pre>
  $r-&gt;pnotes(foo =&gt; undef);
</pre>
<p class="Pp">but the entry for the key <i>foo</i> still remains with the value
    <span class="Li">&quot;undef&quot;</span>. If you really want to completely
    remove it, use the hash interface:</p>
<p class="Pp"><span class="Li"></span></p>
<pre>
  delete $r-&gt;pnotes-&gt;{foo};
</pre>
</section>
<section class="Ss">
<h2 class="Ss" id="_psignature_"><a class="permalink" href="#_psignature_">&quot;psignature&quot;</a></h2>
Get HTML describing the address and (optionally) admin of the server.
<p class="Pp"><span class="Li"></span></p>
<pre>
  $sig = $r-&gt;psignature($prefix);
</pre>
<dl class="Bl-tag">
  <dt>obj: $r ( &quot;Apache2::RequestRec&quot; )</dt>
  <dd></dd>
  <dt>arg1: $prefix ( string )</dt>
  <dd>Text which is prepended to the return value</dd>
  <dt>ret: $sig ( string )</dt>
  <dd>HTML text describing the server. Note that depending on the value of the
      <span class="Li">&quot;ServerSignature&quot;</span> directive, the
      function may return the address, including the admin information or
      nothing at all.</dd>
  <dt>since: 2.0.00</dt>
  <dd></dd>
</dl>
</section>
<section class="Ss">
<h2 class="Ss" id="_request_"><a class="permalink" href="#_request_">&quot;request&quot;</a></h2>
Get/set the ( <span class="Li">&quot;Apache2::RequestRec</span>
  <span class="Li">object&quot;</span> ) object for the current request.
<p class="Pp"><span class="Li"></span></p>
<pre>
  $r = Apache2::RequestUtil-&gt;request;
       Apache2::RequestUtil-&gt;request($new_r);
</pre>
<dl class="Bl-tag">
  <dt>obj: &quot;Apache2&quot; (class name)</dt>
  <dd>The Apache class name</dd>
  <dt>opt arg1: $new_r ( &quot;Apache2::RequestRec object&quot; )</dt>
  <dd></dd>
  <dt>ret: $r ( &quot;Apache2::RequestRec object&quot; )</dt>
  <dd></dd>
  <dt>since: 2.0.00</dt>
  <dd></dd>
</dl>
<p class="Pp">The get-able part of this method is only available if
    <span class="Li">&quot;PerlOptions</span>
    <span class="Li">+GlobalRequest&quot;</span> is in effect or if
    <span class="Li">&quot;Apache2-&gt;request($new_r)&quot;</span> was called
    earlier. So instead of setting <span class="Li">&quot;PerlOptions</span>
    <span class="Li">+GlobalRequest&quot;</span>, one can set the global request
    from within the handler.</p>
</section>
<section class="Ss">
<h2 class="Ss" id="_push_handlers_"><a class="permalink" href="#_push_handlers_">&quot;push_handlers&quot;</a></h2>
Add one or more handlers to a list of handlers to be called for a given phase.
<p class="Pp"><span class="Li"></span></p>
<pre>
  $ok = $r-&gt;push_handlers($hook_name =&gt; \&amp;handler);
  $ok = $r-&gt;push_handlers($hook_name =&gt; ['Foo::Bar::handler', \&amp;handler2]);
</pre>
<dl class="Bl-tag">
  <dt>obj: $r ( &quot;Apache2::RequestRec object&quot; )</dt>
  <dd></dd>
  <dt>arg1: $hook_name ( string )</dt>
  <dd>the phase to add the handlers to</dd>
  <dt>arg2: $handlers ( CODE ref or SUB name or an ARRAY ref )</dt>
  <dd>a single handler CODE reference or just a name of the subroutine (fully
      qualified unless defined in the current package).
    <p class="Pp">if more than one passed, use a reference to an array of CODE
        refs and/or subroutine names.</p>
  </dd>
  <dt>ret: $ok ( boolean )</dt>
  <dd>returns a true value on success, otherwise a false value</dd>
  <dt>since: 2.0.00</dt>
  <dd>See also: <span class="Li">&quot;$s-&gt;add_config&quot;</span>
    <p class="Pp">Note that to push input/output filters you have to use
        <span class="Li">&quot;Apache2::Filter&quot;</span> methods:
        <span class="Li">&quot;add_input_filter&quot;</span> and
        <span class="Li">&quot;add_output_filter&quot;</span>.</p>
  </dd>
</dl>
<p class="Pp">Examples:</p>
<p class="Pp">A single handler:</p>
<p class="Pp"><span class="Li"></span></p>
<pre>
  $r-&gt;push_handlers(PerlResponseHandler =&gt; \&amp;handler);
</pre>
<p class="Pp">Multiple handlers:</p>
<p class="Pp"><span class="Li"></span></p>
<pre>
  $r-&gt;push_handlers(PerlFixupHandler =&gt; ['Foo::Bar::handler', \&amp;handler2]);
</pre>
<p class="Pp">Anonymous functions:</p>
<p class="Pp"><span class="Li"></span></p>
<pre>
  $r-&gt;push_handlers(PerlLogHandler =&gt; sub { return Apache2::Const::OK });
</pre>
</section>
<section class="Ss">
<h2 class="Ss" id="_set_basic_credentials_"><a class="permalink" href="#_set_basic_credentials_">&quot;set_basic_credentials&quot;</a></h2>
Populate the incoming request headers table
  (<span class="Li">&quot;headers_in&quot;</span>) with authentication headers
  for Basic Authorization as if the client has submitted those in first place:
<p class="Pp"><span class="Li"></span></p>
<pre>
  $r-&gt;set_basic_credentials($username, $password);
</pre>
<dl class="Bl-tag">
  <dt>obj: $r ( &quot;Apache2::RequestRec object&quot; )</dt>
  <dd></dd>
  <dt>arg1: $username ( string )</dt>
  <dd></dd>
  <dt>arg2: $password ( string )</dt>
  <dd></dd>
  <dt>ret: no return value</dt>
  <dd></dd>
  <dt>since: 2.0.00</dt>
  <dd></dd>
</dl>
<p class="Pp">See for example the Command Server protocol example which reuses
    HTTP AAA model under non-HTTP protocol.</p>
</section>
<section class="Ss">
<h2 class="Ss" id="_set_handlers_"><a class="permalink" href="#_set_handlers_">&quot;set_handlers&quot;</a></h2>
Set a list of handlers to be called for a given phase. Any previously set
  handlers are forgotten.
<p class="Pp"><span class="Li"></span></p>
<pre>
  $ok = $r-&gt;set_handlers($hook_name =&gt; \&amp;handler);
  $ok = $r-&gt;set_handlers($hook_name =&gt; ['Foo::Bar::handler', \&amp;handler2]);
  $ok = $r-&gt;set_handlers($hook_name =&gt; []);
  $ok = $r-&gt;set_handlers($hook_name =&gt; undef);
</pre>
<dl class="Bl-tag">
  <dt>obj: $r ( &quot;Apache2::RequestRec object&quot; )</dt>
  <dd></dd>
  <dt>arg1: $hook_name ( string )</dt>
  <dd>the phase to set the handlers in</dd>
  <dt>arg2: $handlers (CODE ref or SUB name or an ARRAY ref)</dt>
  <dd>a reference to a single handler CODE reference or just a name of the
      subroutine (fully qualified unless defined in the current package).
    <p class="Pp">if more than one passed, use a reference to an array of CODE
        refs and/or subroutine names.</p>
    <p class="Pp">if the argument is <span class="Li">&quot;undef&quot;</span>
        or <span class="Li">&quot;[]&quot;</span> the list of handlers is reset
        to zero.</p>
  </dd>
  <dt>ret: $ok ( boolean )</dt>
  <dd>returns a true value on success, otherwise a false value</dd>
  <dt>since: 2.0.00</dt>
  <dd></dd>
</dl>
<p class="Pp">See also:
  <span class="Li">&quot;$s-&gt;add_config&quot;</span></p>
<p class="Pp">Examples:</p>
<p class="Pp">A single handler:</p>
<p class="Pp"><span class="Li"></span></p>
<pre>
  $r-&gt;set_handlers(PerlResponseHandler =&gt; \&amp;handler);
</pre>
<p class="Pp">Multiple handlers:</p>
<p class="Pp"><span class="Li"></span></p>
<pre>
  $r-&gt;set_handlers(PerlFixupHandler =&gt; ['Foo::Bar::handler', \&amp;handler2]);
</pre>
<p class="Pp">Anonymous functions:</p>
<p class="Pp"><span class="Li"></span></p>
<pre>
  $r-&gt;set_handlers(PerlLogHandler =&gt; sub { return Apache2::Const::OK });
</pre>
<p class="Pp">Reset any previously set handlers:</p>
<p class="Pp"><span class="Li"></span></p>
<pre>
  $r-&gt;set_handlers(PerlCleanupHandler =&gt; []);
</pre>
<p class="Pp">or</p>
<p class="Pp"><span class="Li"></span></p>
<pre>
  $r-&gt;set_handlers(PerlCleanupHandler =&gt; undef);
</pre>
</section>
<section class="Ss">
<h2 class="Ss" id="_slurp_filename_"><a class="permalink" href="#_slurp_filename_">&quot;slurp_filename&quot;</a></h2>
Slurp the contents of <span class="Li">&quot;$r-&gt;filename&quot;</span>:
<p class="Pp"><span class="Li"></span></p>
<pre>
  $content_ref = $r-&gt;slurp_filename($tainted);
</pre>
<dl class="Bl-tag">
  <dt>obj: $r ( &quot;Apache2::RequestRec object&quot; )</dt>
  <dd></dd>
  <dt>arg1: $tainted (number)</dt>
  <dd>If the server is run under the tainting mode
      (<span class="Li">&quot;-T&quot;</span>) which we hope you do, by default
      the returned data is tainted. If an optional
      <span class="Li">$tainted</span> flag is set to zero, the data will be
      marked as non-tainted.
    <p class="Pp">Do <b>not</b> set this flag to zero unless you know what you
        are doing, you may create a security hole in your program if you do. For
        more information see the <i>perlsec</i> manpage.</p>
    <p class="Pp">If you wonder why this option is available, it is used
        internally by the <span class="Li">&quot;ModPerl::Registry&quot;</span>
        handler and friends, because the CGI scripts that it reads are
        considered safe (you could just as well
        <span class="Li">&quot;require()&quot;</span> them).</p>
  </dd>
  <dt>ret: $content_ref ( SCALAR ref )</dt>
  <dd>A reference to a string with the contents</dd>
  <dt>excpt: &quot;APR::Error&quot;</dt>
  <dd>Possible error codes could be:
      <span class="Li">&quot;APR::Const::EACCES&quot;</span> (permission
      problems), <span class="Li">&quot;APR::Const::ENOENT&quot;</span> (file
      not found), and others. For checking such error codes, see the
      documentation for, for example,
      <span class="Li">&quot;APR::Status::is_EACCES&quot;</span> and
      <span class="Li">&quot;APR::Status::is_ENOENT&quot;</span>.</dd>
  <dt>since: 2.0.00</dt>
  <dd></dd>
</dl>
<p class="Pp">Note that if you assign to
    <span class="Li">&quot;$r-&gt;filename&quot;</span> you need to update its
    stat record.</p>
</section>
</section>
<section class="Sh">
<h1 class="Sh" id="See_Also"><a class="permalink" href="#See_Also">See
  Also</a></h1>
mod_perl 2.0 documentation.
</section>
<section class="Sh">
<h1 class="Sh" id="Copyright"><a class="permalink" href="#Copyright">Copyright</a></h1>
mod_perl 2.0 and its core modules are copyrighted under The Apache Software
  License, Version 2.0.
</section>
<section class="Sh">
<h1 class="Sh" id="Authors"><a class="permalink" href="#Authors">Authors</a></h1>
The mod_perl development team and numerous contributors.
</section>
</div>
<table class="foot">
  <tr>
    <td class="foot-date">2015-06-18</td>
    <td class="foot-os">perl v5.18.2</td>
  </tr>
</table>
</body>
</html>
