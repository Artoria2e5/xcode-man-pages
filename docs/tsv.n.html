<!DOCTYPE html>
<html>
<!-- This is an automatically generated file.  Do not edit.
   Generated from file '' by tcllib/doctools with format 'nroff'
  
   -*- tcl -*- doctools manpage
   The definitions below are for supplemental macros used in Tcl/Tk
   manual entries.
  
   .AP type name in/out ?indent?
  	Start paragraph describing an argument to a library procedure.
  	type is type of argument (int, etc.), in/out is either "in", "out",
  	or "in/out" to describe whether procedure reads or modifies arg,
  	and indent is equivalent to second arg of .IP (shouldn't ever be
  	needed;  use .AS below instead)
  
   .AS ?type? ?name?
  	Give maximum sizes of arguments for setting tab stops.  Type and
  	name are examples of largest possible arguments that will be passed
  	to .AP later.  If args are omitted, default tab stops are used.
  
   .BS
  	Start box enclosure.  From here until next .BE, everything will be
  	enclosed in one large box.
  
   .BE
  	End of box enclosure.
  
   .CS
  	Begin code excerpt.
  
   .CE
  	End code excerpt.
  
   .VS ?version? ?br?
  	Begin vertical sidebar, for use in marking newly-changed parts
  	of man pages.  The first argument is ignored and used for recording
  	the version when the .VS was added, so that the sidebars can be
  	found and removed when they reach a certain age.  If another argument
  	is present, then a line break is forced before starting the sidebar.
  
   .VE
  	End of vertical sidebar.
  
   .DS
  	Begin an indented unfilled display.
  
   .DE
  	End of indented unfilled display.
  
   .SO
  	Start of list of standard options for a Tk widget.  The
  	options follow on successive lines, in four columns separated
  	by tabs.
  
   .SE
  	End of list of standard options for a Tk widget.
  
   .OP cmdName dbName dbClass
  	Start of description of a specific option.  cmdName gives the
  	option's name as specified in the class command, dbName gives
  	the option's name in the option database, and dbClass gives
  	the option's class in the option database.
  
   .UL arg1 arg2
  	Print arg1 underlined, then print arg2 normally.
  
   RCS: @(#) $Id: tsv.n,v 1.15 2006/10/07 09:19:39 vasiljevic Exp $
  
  	# Set up traps and other miscellaneous stuff for Tcl/Tk man pages.
  	# Start an argument description
  .b
  	# define tabbing values for .AP
  
  	# BS - start boxed text
  	# ^y = starting y location
  	# ^b = 1
  	# BE - end boxed text (draw box now)
  	Draw four-sided box normally, but don't draw top of
  	box if the box started on an earlier page.
  	# VS - start vertical sidebar
  	# ^Y = starting y location
  	# ^v = 1 (for troff;  for nroff this doesn't matter)
  	# VE - end of vertical sidebar
  	# Special macro to handle page bottom:  finish off current
  	# box/sidebar if in box/sidebar mode, then invoked standard
  	# page bottom macro.
  	Draw three-sided box if this is the box's first page,
  	draw two sides but no top otherwise.
  	# DS - begin display
  	# DE - end display
  	# SO - start of list of standard options
  	# SE - end of list of standard options
  	# OP - start of full description for a single option
  	# CS - begin code excerpt
  	# CE - end code excerpt
 -->
<head>
  <meta charset="utf-8"/>
  <style>
    table.head, table.foot { width: 100%; }
    td.head-rtitle, td.foot-os { text-align: right; }
    td.head-vol { text-align: center; }
    div.Pp { margin: 1ex 0ex; }
    div.Nd, div.Bf, div.Op { display: inline; }
    span.Pa, span.Ad { font-style: italic; }
    span.Ms { font-weight: bold; }
    dl.Bl-diag > dt { font-weight: bold; }
    code.Nm, code.Fl, code.Cm, code.Ic, code.In, code.Fd, code.Fn,
    code.Cd { font-weight: bold; font-family: inherit; }
  </style>
  <title>tsv(n)</title>
</head>
<body>
<table class="head">
  <tr>
    <td class="head-ltitle">tsv(n)</td>
    <td class="head-vol"></td>
    <td class="head-rtitle">tsv(n)</td>
  </tr>
</table>
<div class="manual-text">
<p class="Pp"></p>
<pre>

</pre>
<section class="Sh">
<h1 class="Sh" id="NAME"><a class="permalink" href="#NAME">NAME</a></h1>
tsv - Part of the Tcl threading extension allowing script level manipulation of
  data shared between threads.
</section>
<section class="Sh">
<h1 class="Sh" id="SYNOPSIS"><a class="permalink" href="#SYNOPSIS">SYNOPSIS</a></h1>
package require <b>Tcl 8.4</b>
<p class="Pp">package require <b>Thread ?2.6?</b></p>
<p class="Pp"><b>tsv::names</b> ?pattern?</p>
<p class="Pp"><b>tsv::object</b> <i>varname</i> <i>element</i></p>
<p class="Pp"><b>tsv::set</b> <i>varname</i> <i>element</i> ?value?</p>
<p class="Pp"><b>tsv::get</b> <i>varname</i> <i>element</i> ?namedvar?</p>
<p class="Pp"><b>tsv::unset</b> <i>varname</i> ?element?</p>
<p class="Pp"><b>tsv::exists</b> <i>varname</i> <i>element</i></p>
<p class="Pp"><b>tsv::pop</b> <i>varname</i> <i>element</i></p>
<p class="Pp"><b>tsv::move</b> <i>varname</i> <i>oldname</i> <i>newname</i></p>
<p class="Pp"><b>tsv::incr</b> <i>varname</i> <i>element</i> ?count?</p>
<p class="Pp"><b>tsv::append</b> <i>varname</i> <i>element</i> <i>value</i>
    ?value ...?</p>
<p class="Pp"><b>tsv::lock</b> <i>varname</i> <i>arg</i> ?arg ...?</p>
<p class="Pp"><b>tsv::lappend</b> <i>varname</i> <i>element</i> <i>value</i>
    ?value ...?</p>
<p class="Pp"><b>tsv::linsert</b> <i>varname</i> <i>element</i> <i>index</i>
    <i>value</i> ?value ...?</p>
<p class="Pp"><b>tsv::lreplace</b> <i>varname</i> <i>element</i> <i>first</i>
    <i>last</i> ?value ...?</p>
<p class="Pp"><b>tsv::llength</b> <i>varname</i> <i>element</i></p>
<p class="Pp"><b>tsv::lindex</b> <i>varname</i> <i>element</i> ?index?</p>
<p class="Pp"><b>tsv::lrange</b> <i>varname</i> <i>element</i> <i>from</i>
    <i>to</i></p>
<p class="Pp"><b>tsv::lsearch</b> <i>varname</i> <i>element</i> ?options?
    <i>pattern</i></p>
<p class="Pp"><b>tsv::lset</b> <i>varname</i> <i>element</i> <i>index</i> ?index
    ...? <i>value</i></p>
<p class="Pp"><b>tsv::lpop</b> <i>varname</i> <i>element</i> ?index?</p>
<p class="Pp"><b>tsv::lpush</b> <i>varname</i> <i>element</i> ?index?</p>
<p class="Pp"><b>tsv::array set</b> <i>varname</i> <i>list</i></p>
<p class="Pp"><b>tsv::array get</b> <i>varname</i> ?pattern?</p>
<p class="Pp"><b>tsv::array names</b> <i>varname</i> ?pattern?</p>
<p class="Pp"><b>tsv::array size</b> <i>varname</i></p>
<p class="Pp"><b>tsv::array reset</b> <i>varname</i> <i>list</i></p>
<p class="Pp"><b>tsv::array bind</b> <i>varname</i> <i>handle</i></p>
<p class="Pp"><b>tsv::array unbind</b> <i>varname</i></p>
<p class="Pp"><b>tsv::array isbound</b> <i>varname</i></p>
<p class="Pp"><b>tsv::keyldel</b> <i>varname</i> <i>keylist</i> <i>key</i></p>
<p class="Pp"><b>tsv::keylget</b> <i>varname</i> <i>keylist</i> <i>key</i>
    ?retvar?</p>
<p class="Pp"><b>tsv::keylkeys</b> <i>varname</i> <i>keylist</i> ?key?</p>
<p class="Pp"><b>tsv::keylset</b> <i>varname</i> <i>keylist</i> <i>key</i>
    <i>value</i> ?key value..?</p>
<p class="Pp"></p>
<pre>

</pre>
</section>
<section class="Sh">
<h1 class="Sh" id="DESCRIPTION"><a class="permalink" href="#DESCRIPTION">DESCRIPTION</a></h1>
This section describes commands implementing thread shared variables. A thread
  shared variable is very similar to a Tcl array but in contrast to a Tcl array
  it is created in shared memory and can be accessed from many threads at the
  same time. Important feature of thread shared variable is that each access to
  the variable is internaly protected by a mutex so script programmer does not
  have to take care about locking the variable himself.
<p class="Pp">Thread shared variables are not bound to any thread explicitly.
    That means that when a thread which created any of thread shared variables
    exits, the variable and associated memory is not unset/reclaimed. User has
    to explicitly unset the variable to reclaim the memory consumed by the
    variable.</p>
</section>
<section class="Sh">
<h1 class="Sh" id="ELEMENT_COMMANDS"><a class="permalink" href="#ELEMENT_COMMANDS">ELEMENT
  COMMANDS</a></h1>
<dl class="Bl-tag">
  <dt><b>tsv::names</b> ?pattern?</dt>
  <dd>Returns names of shared variables matching optional ?pattern? or all known
      variables if pattern is ommited.</dd>
  <dt><b>tsv::object</b> <i>varname</i> <i>element</i></dt>
  <dd>Creates object accessor command for the <i>element</i> in the shared
      variable <i>varname</i>. Using this command, one can apply most of the
      other shared variable commands as method functions of the element object
      command. The object command is automatically deleted when the element
      which this command is pointing to is unset.
    <pre>
    % tsv::set foo bar &quot;A shared string&quot;
    % set string [tsv::object foo bar]
    % $string append &quot; appended&quot;
    =&gt; A shared string appended
    </pre>
  </dd>
  <dt><b>tsv::set</b> <i>varname</i> <i>element</i> ?value?</dt>
  <dd>Sets the value of the <i>element</i> in the shared variable <i>varname</i>
      to <i>value</i> and returns the value to caller. The <i>value</i> may be
      ommited, in which case the command will return the current value of the
      element. If the element cannot be found, error is triggered.</dd>
  <dt><b>tsv::get</b> <i>varname</i> <i>element</i> ?namedvar?</dt>
  <dd>Retrieves the value of the <i>element</i> from the shared variable
      <i>varname</i>. If the optional argument <i>namedvar</i> is given, the
      value is stored in the named variable. Return value of the command depends
      of the existence of the optional argument <i>namedvar</i>. If the argument
      is ommited and the requested element cannot be found in the shared array,
      the command triggers error. If, however, the optional argument is given on
      the command line, the command returns true (1) if the element is found or
      false (0) if the element is not found.</dd>
  <dt><b>tsv::unset</b> <i>varname</i> ?element?</dt>
  <dd>Unsets the <i>element</i> from the shared variable <i>varname</i>. If the
      optional element is not given, it deletes the variable.</dd>
  <dt><b>tsv::exists</b> <i>varname</i> <i>element</i></dt>
  <dd>Checks wether the <i>element</i> exists in the shared variable
      <i>varname</i> and returns true (1) if it does or false (0) if it
    doesn't.</dd>
  <dt><b>tsv::pop</b> <i>varname</i> <i>element</i></dt>
  <dd>Returns value of the <i>element</i> in the shared variable <i>varname</i>
      and unsets the element, all in one atomic operation.</dd>
  <dt><b>tsv::move</b> <i>varname</i> <i>oldname</i> <i>newname</i></dt>
  <dd>Renames the element <i>oldname</i> to the <i>newname</i> in the shared
      variable <i>varname</i>. This effectively performs an get/unset/set
      sequence of operations but all in one atomic step.</dd>
  <dt><b>tsv::incr</b> <i>varname</i> <i>element</i> ?count?</dt>
  <dd>Similar to standard Tcl <b>incr</b> command but increments the value of
      the <i>element</i> in shared variaboe <i>varname</i> instead of the Tcl
      variable.</dd>
  <dt><b>tsv::append</b> <i>varname</i> <i>element</i> <i>value</i> ?value
    ...?</dt>
  <dd>Similar to standard Tcl <b>append</b> command but appends one or more
      values to the <i>element</i> in shared variable <i>varname</i> instead of
      the Tcl variable.</dd>
  <dt><b>tsv::lock</b> <i>varname</i> <i>arg</i> ?arg ...?</dt>
  <dd>This command concatenates passed arguments and evaluates the resulting
      script under the internal mutex protection. During the script evaluation,
      the entire shared variable is locked. For shared variable commands within
      the script, internal locking is disabled so no deadlock can occur. It is
      also allowed to unset the shared variable from within the script. The
      shared variable is automatically created if it did not exists at the time
      of the first lock operation.
    <pre>
    % tsv::lock foo {
        tsv::lappend foo bar 1
        tsv::lappend foo bar 2
        puts stderr [tsv::set foo bar]
        tsv::unset foo
    }
    </pre>
  </dd>
</dl>
</section>
<section class="Sh">
<h1 class="Sh" id="LIST_COMMANDS"><a class="permalink" href="#LIST_COMMANDS">LIST
  COMMANDS</a></h1>
Those command are similar to the equivalently named Tcl command. The difference
  is that they operate on elements of shared arrays.
<dl class="Bl-tag">
  <dt><b>tsv::lappend</b> <i>varname</i> <i>element</i> <i>value</i> ?value
    ...?</dt>
  <dd>Similar to standard Tcl <b>lappend</b> command but appends one or more
      values to the <i>element</i> in shared variable <i>varname</i> instead of
      the Tcl variable.</dd>
  <dt><b>tsv::linsert</b> <i>varname</i> <i>element</i> <i>index</i>
    <i>value</i> ?value ...?</dt>
  <dd>Similar to standard Tcl <b>linsert</b> command but inserts one or more
      values at the <i>index</i> list position in the <i>element</i> in the
      shared variable <i>varname</i> instead of the Tcl variable.</dd>
  <dt><b>tsv::lreplace</b> <i>varname</i> <i>element</i> <i>first</i>
    <i>last</i> ?value ...?</dt>
  <dd>Similar to standard Tcl <b>lreplace</b> command but replaces one or more
      values between the <i>first</i> and <i>last</i> position in the
      <i>element</i> of the shared variable <i>varname</i> instead of the Tcl
      variable.</dd>
  <dt><b>tsv::llength</b> <i>varname</i> <i>element</i></dt>
  <dd>Similar to standard Tcl <b>llength</b> command but returns length of the
      <i>element</i> in the shared variable <i>varname</i> instead of the Tcl
      variable.</dd>
  <dt><b>tsv::lindex</b> <i>varname</i> <i>element</i> ?index?</dt>
  <dd>Similar to standard Tcl <b>lindex</b> command but returns the value at the
      <i>index</i> list position of the <i>element</i> from the shared variable
      <i>varname</i> instead of the Tcl variable.</dd>
  <dt><b>tsv::lrange</b> <i>varname</i> <i>element</i> <i>from</i>
    <i>to</i></dt>
  <dd>Similar to standard Tcl <b>lrange</b> command but returns values between
      <i>from</i> and <i>to</i> list positions from the <i>element</i> in the
      shared variable <i>varname</i> instead of the Tcl variable.</dd>
  <dt><b>tsv::lsearch</b> <i>varname</i> <i>element</i> ?options?
    <i>pattern</i></dt>
  <dd>Similar to standard Tcl <b>lsearch</b> command but searches the
      <i>element</i> in the shared variable <i>varname</i> instead of the Tcl
      variable.</dd>
  <dt><b>tsv::lset</b> <i>varname</i> <i>element</i> <i>index</i> ?index ...?
    <i>value</i></dt>
  <dd>Similar to standard Tcl <b>lset</b> command but sets the <i>element</i> in
      the shared variable <i>varname</i> instead of the Tcl variable.</dd>
  <dt><b>tsv::lpop</b> <i>varname</i> <i>element</i> ?index?</dt>
  <dd>Similar to the standard Tcl <b>lindex</b> command but in addition to
      returning, it also splices the value out of the <i>element</i> from the
      shared variable <i>varname</i> in one atomic operation. In contrast to the
      Tcl <b>lindex</b> command, this command returns no value to the
    caller.</dd>
  <dt><b>tsv::lpush</b> <i>varname</i> <i>element</i> ?index?</dt>
  <dd>This command performes the opposite of the <b>tsv::lpop</b> command. As
      its counterpart, it returns no value to the caller.</dd>
</dl>
</section>
<section class="Sh">
<h1 class="Sh" id="ARRAY_COMMANDS"><a class="permalink" href="#ARRAY_COMMANDS">ARRAY
  COMMANDS</a></h1>
This command supports most of the options of the standard Tcl <b>array</b>
  command. In addition to those, it allows binding a shared variable to some
  persisten storage databases. Currently the only persistent option supported is
  the famous GNU Gdbm database. This option has to be selected during the
  package compilation time. The implementation provides hooks for defining other
  persistency layers, if needed.
<dl class="Bl-tag">
  <dt><b>tsv::array set</b> <i>varname</i> <i>list</i></dt>
  <dd>Does the same as standard Tcl <b>array set</b>.</dd>
  <dt><b>tsv::array get</b> <i>varname</i> ?pattern?</dt>
  <dd>Does the same as standard Tcl <b>array get</b>.</dd>
  <dt><b>tsv::array names</b> <i>varname</i> ?pattern?</dt>
  <dd>Does the same as standard Tcl <b>array names</b>.</dd>
  <dt><b>tsv::array size</b> <i>varname</i></dt>
  <dd>Does the same as standard Tcl <b>array size</b>.</dd>
  <dt><b>tsv::array reset</b> <i>varname</i> <i>list</i></dt>
  <dd>Does the same as standard Tcl <b>array set</b> but it clears the
      <i>varname</i> and sets new values from the list atomically.</dd>
  <dt><b>tsv::array bind</b> <i>varname</i> <i>handle</i></dt>
  <dd>Binds the <i>varname</i> to the persistent storage <i>handle</i>. The
      format of the <i>handle</i> is &lt;handler&gt;:&lt;address&gt;. For the
      built-in GNU Gdbm persistence layer, the format of the handle is
      &quot;gdbm:&lt;path&gt;&quot; where &lt;path&gt; is the path to the Gdbm
      database file.</dd>
  <dt><b>tsv::array unbind</b> <i>varname</i></dt>
  <dd>Unbinds the shared <i>array</i> from its bound persistent storage.</dd>
  <dt><b>tsv::array isbound</b> <i>varname</i></dt>
  <dd>Returns true (1) if the shared <i>varname</i> is bound to some persistent
      storage or zero (0) if not.</dd>
</dl>
</section>
<section class="Sh">
<h1 class="Sh" id="KEYED_LIST_COMMANDS"><a class="permalink" href="#KEYED_LIST_COMMANDS">KEYED
  LIST COMMANDS</a></h1>
Keyed list commands are borrowed from the TclX package. Keyed lists provide a
  structured data type built upon standard Tcl lists. This is a functionality
  similar to structs in the C programming language.
<p class="Pp">A keyed list is a list in which each element contains a key and
    value pair. These element pairs are stored as lists themselves, where the
    key is the first element of the list, and the value is the second. The
    key-value pairs are referred to as fields. This is an example of a keyed
    list:</p>
<pre>
    {{NAME  {Frank  Zappa}} {JOB {musician and composer}}}
</pre>
Fields may contain subfields; `.' is the separator character. Subfields are
  actually fields where the value is another keyed list. Thus the following list
  has the top level fields ID and NAME, and subfields NAME.FIRST and NAME.LAST:
<pre>
    {ID 106} {NAME {{FIRST Frank} {LAST Zappa}}}
</pre>
There is no limit to the recursive depth of subfields, allowing one to build
  complex data structures. Keyed lists are constructed and accessed via a number
  of commands. All keyed list management commands take the name of the variable
  containing the keyed list as an argument (i.e. passed by reference), rather
  than passing the list directly.
<dl class="Bl-tag">
  <dt><b>tsv::keyldel</b> <i>varname</i> <i>keylist</i> <i>key</i></dt>
  <dd>Delete the field specified by <i>key</i> from the keyed list
      <i>keylist</i> in the shared variable <i>varname</i>. This removes both
      the key and the value from the keyed list.</dd>
  <dt><b>tsv::keylget</b> <i>varname</i> <i>keylist</i> <i>key</i> ?retvar?</dt>
  <dd>Return the value associated with <i>key</i> from the keyed list
      <i>keylist</i> in the shared variable <i>varname</i>. If the optional
      <i>retvar</i> is not specified, then the value will be returned as the
      result of the command. In this case, if key is not found in the list, an
      error will result.
    <p class="Pp">If <i>retvar</i> is specified and <i>key</i> is in the list,
        then the value is returned in the variable <i>retvar</i> and the command
        returns 1 if the key was present within the list. If <i>key</i> isn't in
        the list, the command will return 0, and <i>retvar</i> will be left
        unchanged. If {} is specified for <i>retvar</i>, the value is not
        returned, allowing the Tcl programmer to determine if a <i>key</i> is
        present in a keyed list without setting a variable as a side-effect.</p>
  </dd>
  <dt><b>tsv::keylkeys</b> <i>varname</i> <i>keylist</i> ?key?</dt>
  <dd>Return the a list of the keys in the keyed list <i>keylist</i> in the
      shared variable <i>varname</i>. If <i>key</i> is specified, then it is the
      name of a key field who's subfield keys are to be retrieved.</dd>
  <dt><b>tsv::keylset</b> <i>varname</i> <i>keylist</i> <i>key</i> <i>value</i>
    ?key value..?</dt>
  <dd>Set the value associated with <i>key</i>, in the keyed list <i>keylist</i>
      to <i>value</i>. If the <i>keylist</i> does not exists, it is created. If
      <i>key</i> is not currently in the list, it will be added. If it already
      exists, <i>value</i> replaces the existing value. Multiple keywords and
      values may be specified, if desired.</dd>
</dl>
</section>
<section class="Sh">
<h1 class="Sh" id="DISCUSSION"><a class="permalink" href="#DISCUSSION">DISCUSSION</a></h1>
The current implementation of thread shared variables allows for easy and
  convenient access to data shared between different threads. Internally, the
  data is stored in Tcl objects and all package commands operate on internal
  data representation, thus minimizing shimmering and improving performance.
  Special care has been taken to assure that all object data is properly locked
  and deep-copied when moving objects between threads.
<p class="Pp">Due to the internal design of the Tcl core, there is no provision
    of full integration of shared variables within the Tcl syntax,
    unfortunately. All access to shared data must be performed with the supplied
    package commands. Also, variable traces are not supported. But even so,
    benefits of easy, simple and safe shared data manipulation outweights
    imposed limitations.</p>
</section>
<section class="Sh">
<h1 class="Sh" id="CREDITS"><a class="permalink" href="#CREDITS">CREDITS</a></h1>
Thread shared variables are inspired by the nsv interface found in AOLserver, a
  highly scalable Web server from America Online.
</section>
<section class="Sh">
<h1 class="Sh" id="SEE_ALSO"><a class="permalink" href="#SEE_ALSO">SEE
  ALSO</a></h1>
thread, tpool, ttrace
</section>
<section class="Sh">
<h1 class="Sh" id="KEYWORDS"><a class="permalink" href="#KEYWORDS">KEYWORDS</a></h1>
locking, synchronization, thread shared data, threads
</section>
</div>
<table class="foot">
  <tr>
    <td class="foot-date">2.6</td>
    <td class="foot-os">Tcl Threading</td>
  </tr>
</table>
</body>
</html>
