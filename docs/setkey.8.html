<!-- Creator     : groff version 1.22.4 -->
<!-- CreationDate: Mon Dec 13 11:22:40 2021 -->
<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"
"http://www.w3.org/TR/html4/loose.dtd">
<html>
<head>

<style>
@media (prefers-color-scheme: dark) {
  body {
    background: #000;
    color: #d0d0d0;
  }

  a, a:visited {
    color: #1899eb;
  }
}
</style>

<meta name="generator" content="groff -Thtml, see www.gnu.org">
<meta http-equiv="Content-Type" content="text/html; charset=US-ASCII">
<meta name="Content-Style" content="text/css">
<style type="text/css">
       p       { margin-top: 0; margin-bottom: 0; vertical-align: top }
       pre     { margin-top: 0; margin-bottom: 0; vertical-align: top }
       table   { margin-top: 0; margin-bottom: 0; vertical-align: top }
       h1      { text-align: center }
</style>
<title></title>
</head>
<body>

<hr>


<p>SETKEY(8) BSD System Manager&rsquo;s Manual
SETKEY(8)</p>

<p style="margin-top: 1em"><b>NAME</b></p>

<p style="margin-left:6%;"><b>setkey</b> &mdash; manually
manipulate the IPsec SA/SP database</p>

<p style="margin-top: 1em"><b>SYNOPSIS</b></p>

<p style="margin-left:15%;"><b>setkey</b>
[<b>&minus;knrv</b>] <i>file ...</i> <b><br>
setkey</b> [<b>&minus;knrv</b>] <b>&minus;c <br>
setkey</b> [<b>&minus;krv</b>] <b>&minus;f</b>
<i>filename</i> <b><br>
setkey</b> [<b>&minus;aklPrv</b>] <b>&minus;D <br>
setkey</b> [<b>&minus;Pvp</b>] <b>&minus;F <br>
setkey</b> [<b>&minus;H</b>] <b>&minus;x <br>
setkey</b> [<b>&minus;?V</b>]</p>

<p style="margin-top: 1em"><b>DESCRIPTION</b></p>

<p style="margin-left:6%;"><b>setkey</b> adds, updates,
dumps, or flushes Security Association Database (SAD)
entries as well as Security Policy Database (SPD) entries in
the kernel.</p>

<p style="margin-left:6%; margin-top: 1em"><b>setkey</b>
takes a series of operations from standard input (</p>

<p>if invoked with <b>&minus;c</b> ) or the file named
<i>filename</i> ( <br>
if invoked with <b>&minus;f</b> <i>filename</i> ).</p>

<p style="margin-top: 1em">(no flag)</p>

<p style="margin-left:17%;">Dump the SAD entries or SPD
entries contained in the specified <i>file</i>.</p>

<p style="margin-top: 1em"><b>&minus;</b>?</p>

<p style="margin-left:17%; margin-top: 1em">Print short
help.</p>

<p style="margin-top: 1em"><b>&minus;a</b></p>

<p style="margin-left:17%; margin-top: 1em"><b>setkey</b>
usually does not display dead SAD entries with
<b>&minus;D</b>. If <b>&minus;a</b> is also specified, the
dead SAD entries will be displayed as well. A dead SAD entry
is one that has expired but remains in the system because it
is referenced by some SPD entries.</p>

<p style="margin-top: 1em"><b>&minus;D</b></p>

<p style="margin-left:17%; margin-top: 1em">Dump the SAD
entries. If <b>&minus;P</b> is also specified, the SPD
entries are dumped. If <b>&minus;p</b> is specified, the
ports are displayed.</p>

<p style="margin-top: 1em"><b>&minus;F</b></p>

<p style="margin-left:17%; margin-top: 1em">Flush the SAD
entries. If <b>&minus;P</b> is also specified, the SPD
entries are flushed.</p>

<p style="margin-top: 1em"><b>&minus;H</b></p>

<p style="margin-left:17%; margin-top: 1em">Add hexadecimal
dump in <b>&minus;x</b> mode.</p>

<p style="margin-top: 1em"><b>&minus;h</b></p>

<p style="margin-left:17%; margin-top: 1em">On NetBSD,
synonym for <b>&minus;H</b>. On other systems, synonym for
<b>&minus;</b>?.</p>

<p style="margin-top: 1em"><b>&minus;k</b></p>

<p style="margin-left:17%; margin-top: 1em">Use semantics
used in kernel. Available only in Linux. See also
<b>&minus;r</b>.</p>

<p style="margin-top: 1em"><b>&minus;l</b></p>

<p style="margin-left:17%; margin-top: 1em">Loop forever
with short output on <b>&minus;D</b>.</p>

<p style="margin-top: 1em"><b>&minus;n</b></p>

<p style="margin-left:17%; margin-top: 1em">No action. The
program will check validity of the input, but no changes to
the SPD will be made.</p>

<p style="margin-top: 1em"><b>&minus;r</b></p>

<p style="margin-left:17%; margin-top: 1em">Use semantics
described in IPsec RFCs. This mode is default. For details
see section <i>RFC vs Linux kernel semantics</i>. Available
only in Linux. See also <b>&minus;k</b>.</p>

<p style="margin-top: 1em"><b>&minus;x</b></p>

<p style="margin-left:17%; margin-top: 1em">Loop forever
and dump all the messages transmitted to the PF_KEY socket.
<b>&minus;xx</b> prints the unformatted timestamps.</p>

<p style="margin-top: 1em"><b>&minus;V</b></p>

<p style="margin-left:17%; margin-top: 1em">Print version
string.</p>

<p style="margin-top: 1em"><b>&minus;v</b></p>

<p style="margin-left:17%; margin-top: 1em">Be verbose. The
program will dump messages exchanged on the PF_KEY socket,
including messages sent from other processes to the
kernel.</p>


<p style="margin-left:6%; margin-top: 1em"><b>Configuration
syntax</b> <br>
With <b>&minus;c</b> or <b>&minus;f</b> on the command line,
<b>setkey</b> accepts the following configuration syntax.
Lines starting with hash signs (&lsquo;#&rsquo;) are treated
as comment lines.</p>

<p style="margin-top: 1em">add [<b>&minus;46n</b>] <i>src
dst protocol spi</i> [<i>extensions</i>] <i>algorithm
...</i> ;</p>

<p style="margin-left:17%;">Add an SAD entry. add can fail
for multiple reasons, including when the key length does not
match the specified algorithm.</p>

<p style="margin-top: 1em">get [<b>&minus;46n</b>] <i>src
dst protocol spi</i> ;</p>

<p style="margin-left:17%;">Show an SAD entry.</p>

<p style="margin-top: 1em">delete [<b>&minus;46n</b>]
<i>src dst protocol spi</i> ;</p>

<p style="margin-left:17%;">Remove an SAD entry.</p>

<p style="margin-top: 1em">deleteall [<b>&minus;46n</b>]
<i>src dst protocol</i> ;</p>

<p style="margin-left:17%;">Remove all SAD entries that
match the specification.</p>

<p style="margin-top: 1em">flush [<i>protocol</i>] ;</p>

<p style="margin-left:17%;">Clear all SAD entries matched
by the options. <b>&minus;F</b> on the command line achieves
the same functionality.</p>

<p style="margin-top: 1em">dump [<i>protocol</i>] ;</p>

<p style="margin-left:17%;">Dumps all SAD entries matched
by the options. <b>&minus;D</b> on the command line achieves
the same functionality.</p>

<p style="margin-top: 1em">spdadd [<b>&minus;46n</b>]
<i>src_range dst_range upperspec policy</i> ;</p>

<p style="margin-left:17%;">Add an SPD entry.</p>

<p style="margin-top: 1em">spdadd tagged <i>tag policy</i>
;</p>

<p style="margin-left:17%;">Add an SPD entry based on a PF
tag. <i>tag</i> must be a string surrounded by double
quotes.</p>

<p style="margin-top: 1em">spddelete [<b>&minus;46n</b>]
<i>src_range dst_range upperspec</i> <b>&minus;P</b>
<i>direction</i> ;</p>

<p style="margin-left:17%;">Delete an SPD entry.</p>

<p style="margin-top: 1em">spdflush ;</p>

<p style="margin-left:17%;">Clear all SPD entries.
<b>&minus;FP</b> on the command line achieves the same
functionality.</p>

<p style="margin-top: 1em">spddump ;</p>

<p style="margin-left:17%;">Dumps all SPD entries.
<b>&minus;DP</b> on the command line achieves the same
functionality.</p>

<p style="margin-left:6%; margin-top: 1em">Meta-arguments
are as follows:</p>

<p style="margin-top: 1em"><i>src <br>
dst</i></p>


<p style="margin-left:17%; margin-top: 1em">Source/destination
of the secure communication is specified as an IPv4/v6
address, and an optional port number between square
brackets. <b>setkey</b> can resolve a FQDN into numeric
addresses. If the FQDN resolves into multiple addresses,
<b>setkey</b> will install multiple SAD/SPD entries into the
kernel by trying all possible combinations. <b>&minus;4</b>,
<b>&minus;6</b>, and <b>&minus;n</b> restrict the address
resolution of FQDN in certain ways. <b>&minus;4</b> and
<b>&minus;6</b> restrict results into IPv4/v6 addresses
only, respectively. <b>&minus;n</b> avoids FQDN resolution
and requires addresses to be numeric addresses.</p>

<p style="margin-top: 1em"><i>protocol</i></p>

<p style="margin-left:17%;"><i>protocol</i> is one of
following:</p>

<p>esp</p>

<p style="margin-left:32%; margin-top: 1em">ESP based on
rfc2406</p>

<p>esp-old</p>

<p style="margin-left:32%; margin-top: 1em">ESP based on
rfc1827</p>

<p>ah</p>

<p style="margin-left:32%; margin-top: 1em">AH based on
rfc2402</p>

<p>ah-old</p>

<p style="margin-left:32%; margin-top: 1em">AH based on
rfc1826</p>

<p>ipcomp</p>

<p style="margin-left:32%; margin-top: 1em">IPComp</p>

<p>tcp</p>

<p style="margin-left:32%; margin-top: 1em">TCP-MD5 based
on rfc2385</p>

<p style="margin-top: 1em"><i>spi</i></p>

<p style="margin-left:17%; margin-top: 1em">Security
Parameter Index (SPI) for the SAD and the SPD. <i>spi</i>
must be a decimal number, or a hexadecimal number with a
&ldquo;0x&rdquo; prefix. SPI values between 0 and 255 are
reserved for future use by IANA and cannot be used. TCP-MD5
associations must use 0x1000 and therefore only have
per-host granularity at this time.</p>

<p style="margin-top: 1em"><i>extensions</i></p>

<p style="margin-left:17%;">take some of the following:</p>

<p><b>&minus;m</b> <i>mode</i></p>

<p style="margin-left:32%; margin-top: 1em">Specify a
security protocol mode for use. <i>mode</i> is one of
following: transport, tunnel, or any. The default value is
any.</p>

<p><b>&minus;r</b> <i>size</i></p>

<p style="margin-left:32%; margin-top: 1em">Specify window
size of bytes for replay prevention. <i>size</i> must be
decimal number in 32-bit word. If <i>size</i> is zero or not
specified, replay checks don&rsquo;t take place.</p>

<p><b>&minus;u</b> <i>id</i></p>

<p style="margin-left:32%; margin-top: 1em">Specify the
identifier of the policy entry in the SPD. See
<i>policy</i>.</p>

<p><b>&minus;f</b> <i>pad_option</i></p>

<p style="margin-left:32%;">defines the content of the ESP
padding. <i>pad_option</i> is one of following:</p>

<p>zero-pad</p>

<p style="margin-left:47%; margin-top: 1em">All the
paddings are zero.</p>

<p>random-pad</p>

<p style="margin-left:47%; margin-top: 1em">A series of
randomized values are used.</p>

<p>seq-pad</p>

<p style="margin-left:47%; margin-top: 1em">A series of
sequential increasing numbers started from 1 are used.</p>

<p><b>&minus;f</b> nocyclic-seq</p>

<p style="margin-left:32%;">Don&rsquo;t allow cyclic
sequence numbers.</p>

<p><b>&minus;lh</b> <i>time</i> <b><br>
&minus;ls</b> <i>time</i></p>

<p style="margin-left:32%; margin-top: 1em">Specify
hard/soft life time duration of the SA measured in
seconds.</p>

<p><b>&minus;bh</b> <i>bytes</i> <b><br>
&minus;bs</b> <i>bytes</i></p>

<p style="margin-left:32%; margin-top: 1em">Specify
hard/soft life time duration of the SA measured in bytes
transported.</p>

<p style="margin-top: 1em"><i>algorithm</i> <b><br>
&minus;E</b> <i>ealgo key</i></p>

<p style="margin-left:32%;">Specify an encryption algorithm
<i>ealgo</i> for ESP.</p>

<p><b>&minus;E</b> <i>ealgo key</i> <b>&minus;A</b>
<i>aalgo key</i></p>

<p style="margin-left:32%;">Specify an encryption algorithm
<i>ealgo</i>, as well as a payload authentication algorithm
<i>aalgo</i>, for ESP.</p>

<p><b>&minus;A</b> <i>aalgo key</i></p>

<p style="margin-left:32%;">Specify an authentication
algorithm for AH.</p>

<p><b>&minus;C</b> <i>calgo</i> [<b>&minus;R</b>]</p>

<p style="margin-left:32%;">Specify a compression algorithm
for IPComp. If <b>&minus;R</b> is specified, the <i>spi</i>
field value will be used as the IPComp CPI (compression
parameter index) on wire as-is. If <b>&minus;R</b> is not
specified, the kernel will use well-known CPI on wire, and
<i>spi</i> field will be used only as an index for kernel
internal usage.</p>

<p style="margin-left:17%; margin-top: 1em"><i>key</i> must
be a double-quoted character string, or a series of
hexadecimal digits preceded by &ldquo;0x&rdquo;.</p>

<p style="margin-left:17%; margin-top: 1em">Possible values
for <i>ealgo</i>, <i>aalgo</i>, and <i>calgo</i> are
specified in the <i>Algorithms</i> sections.</p>

<p style="margin-top: 1em"><i>src_range <br>
dst_range</i></p>

<p style="margin-left:17%;">These select the communications
that should be secured by IPsec. They can be an IPv4/v6
address or an IPv4/v6 address range, and may be accompanied
by a TCP/UDP port specification. This takes the following
form:</p>

<p style="margin-left:17%; margin-top: 1em"><i>address <br>
address/prefixlen <br>
address[port] <br>
address/prefixlen[port]</i></p>


<p style="margin-left:17%; margin-top: 1em"><i>prefixlen</i>
and <i>port</i> must be decimal numbers. The square brackets
around <i>port</i> are really necessary, they are not man
page meta-characters. For FQDN resolution, the rules
applicable to <i>src</i> and <i>dst</i> apply here as
well.</p>

<p style="margin-top: 1em"><i>upperspec</i></p>

<p style="margin-left:17%;">Upper-layer protocol to be
used. You can use one of the words in <i>/etc/protocols</i>
as <i>upperspec</i>, or icmp6, ip4, or any. any stands for
&ldquo;any protocol&rdquo;. You can also use the protocol
number. You can specify a type and/or a code of ICMPv6 when
the upper-layer protocol is ICMPv6. The specification can be
placed after icmp6. A type is separated from a code by
single comma. A code must always be specified. When a zero
is specified, the kernel deals with it as a wildcard. Note
that the kernel can not distinguish a wildcard from an
ICPMv6 type of zero. For example, the following means that
the policy doesn&rsquo;t require IPsec for any inbound
Neighbor Solicitation.</p>

<p style="margin-left:24%;">spdadd ::/0 ::/0 icmp6 135,0 -P
in none;</p>

<p style="margin-left:17%; margin-top: 1em"><i>Note</i>:
<i>upperspec</i> does not work against forwarding case at
this moment, as it requires extra reassembly at the
forwarding node (not implemented at this moment). There are
many protocols in <i>/etc/protocols</i>, but all protocols
except of TCP, UDP, and ICMP may not be suitable to use with
IPsec. You have to consider carefully what to use.</p>

<p style="margin-top: 1em"><i>policy</i></p>

<p style="margin-left:17%; margin-top: 1em"><i>policy</i>
is in one of the following three formats:</p>

<p style="margin-top: 1em"><b>&minus;P</b> <i>direction
[priority specification]</i> discard <b><br>
&minus;P</b> <i>direction [priority specification]</i> none
<b><br>
&minus;P</b> <i>direction [priority specification]</i> ipsec
<i><br>
protocol/mode/src-dst/level</i> [...]</p>

<p style="margin-left:17%; margin-top: 1em">You must
specify the direction of its policy as <i>direction</i>.
Either <i>out</i>, <i>in</i>, or <i>fwd</i> can be used.</p>

<p style="margin-left:17%; margin-top: 1em"><i>priority
specification</i> is used to control the placement of the
policy within the SPD. Policy position is determined by a
signed integer where higher priorities indicate the policy
is placed closer to the beginning of the list and lower
priorities indicate the policy is placed closer to the end
of the list. Policies with equal priorities are added at the
end of groups of such policies.</p>

<p style="margin-left:17%; margin-top: 1em">Priority can
only be specified when setkey has been compiled against
kernel headers that support policy priorities (Linux &gt;=
2.6.6). If the kernel does not support priorities, a warning
message will be printed the first time a priority
specification is used. Policy priority takes one of the
following formats:</p>

<p style="margin-top: 1em"><i>{priority,prio}
offset</i></p>

<p style="margin-left:28%;"><i>offset</i> is an integer in
the range from &minus;2147483647 to 214783648.</p>

<p style="margin-top: 1em"><i>{priority,prio} base
{+,&minus;} offset</i></p>

<p style="margin-left:28%;"><i>base</i> is either low
(&minus;1073741824), def (0), or high (1073741824)</p>

<p style="margin-left:28%; margin-top: 1em"><i>offset</i>
is an unsigned integer. It can be up to 1073741824 for
positive offsets, and up to 1073741823 for negative
offsets.</p>

<p style="margin-left:17%; margin-top: 1em">discard means
the packet matching indexes will be discarded. none means
that IPsec operation will not take place onto the packet.
ipsec means that IPsec operation will take place onto the
packet.</p>

<p style="margin-left:17%; margin-top: 1em">The
<i>protocol/mode/src-dst/level</i> part specifies the rule
how to process the packet. Either ah, esp, or ipcomp must be
used as <i>protocol</i>. <i>mode</i> is either transport or
tunnel. If <i>mode</i> is tunnel, you must specify the
end-point addresses of the SA as <i>src</i> and <i>dst</i>
with &lsquo;-&rsquo; between these addresses, which is used
to specify the SA to use. If <i>mode</i> is transport, both
<i>src</i> and <i>dst</i> can be omitted. <i>level</i> is to
be one of the following: default, use, require, or unique.
If the SA is not available in every level, the kernel will
ask the key exchange daemon to establish a suitable SA.
default means the kernel consults the system wide default
for the protocol you specified, e.g. the esp_trans_deflev
sysctl variable, when the kernel processes the packet. use
means that the kernel uses an SA if it&rsquo;s available,
otherwise the kernel keeps normal operation. require means
SA is required whenever the kernel sends a packet matched
with the policy. unique is the same as require; in addition,
it allows the policy to match the unique out-bound SA. You
just specify the policy level unique, racoon(8) will
configure the SA for the policy. If you configure the SA by
manual keying for that policy, you can put a decimal number
as the policy identifier after unique separated by a colon
&lsquo;:&rsquo; like: unique:number in order to bind this
policy to the SA. number must be between 1 and 32767. It
corresponds to <i>extensions</i> <b>&minus;u</b> of the
manual SA configuration. When you want to use SA bundle, you
can define multiple rules. For example, if an IP header was
followed by an AH header followed by an ESP header followed
by an upper layer protocol header, the rule would be:</p>

<p style="margin-left:24%;">esp/transport//require
ah/transport//require;</p>

<p style="margin-left:17%;">The rule order is very
important.</p>

<p style="margin-left:17%; margin-top: 1em">When NAT-T is
enabled in the kernel, policy matching for ESP over UDP
packets may be done on endpoint addresses and port (this
depends on the system. System that do not perform the port
check cannot support multiple endpoints behind the same
NAT). When using ESP over UDP, you can specify port numbers
in the endpoint addresses to get the correct matching. Here
is an example:</p>

<p style="margin-left:17%; margin-top: 1em">spdadd
10.0.11.0/24[any] 10.0.11.33/32[any] any -P out ipsec <br>
esp/tunnel/192.168.0.1[4500]-192.168.1.2[30000]/require
;</p>

<p style="margin-left:17%; margin-top: 1em">These ports
must be left unspecified (which defaults to 0) for anything
other than ESP over UDP. They can be displayed in SPD dump
using <b>setkey &minus;DPp</b>.</p>

<p style="margin-left:17%; margin-top: 1em">Note that
&ldquo;discard&rdquo; and &ldquo;none&rdquo; are not in the
syntax described in ipsec_set_policy(3). There are a few
differences in the syntax. See ipsec_set_policy(3) for
detail.</p>


<p style="margin-left:6%; margin-top: 1em"><b>Algorithms</b>
<br>
The following list shows the supported algorithms.
<b>protocol</b> and <b>algorithm</b> are almost orthogonal.
These authentication algorithms can be used as <i>aalgo</i>
in <b>&minus;A</b> <i>aalgo</i> of the <i>protocol</i>
parameter:</p>

<table width="100%" border="0" rules="none" frame="void"
       cellspacing="0" cellpadding="0">
<tr valign="top" align="left">
<td width="14%"></td>
<td width="10%">


<p>algorithm</p></td>
<td width="11%"></td>
<td width="10%">


<p>keylen (bits)</p></td>
<td width="10%"></td>
<td width="10%"></td>
<td width="35%">
</td></tr>
<tr valign="top" align="left">
<td width="14%"></td>
<td width="10%">


<p>hmac-md5</p></td>
<td width="11%"></td>
<td width="10%">


<p>128</p></td>
<td width="10%">
</td>
<td width="10%">


<p>ah: rfc2403</p></td>
<td width="35%">
</td></tr>
<tr valign="top" align="left">
<td width="14%"></td>
<td width="10%">
</td>
<td width="11%">
</td>
<td width="10%">


<p>128</p></td>
<td width="10%">
</td>
<td width="10%">


<p>ah-old: rfc2085</p></td>
<td width="35%">
</td></tr>
<tr valign="top" align="left">
<td width="14%"></td>
<td width="10%">


<p>hmac-sha1</p></td>
<td width="11%"></td>
<td width="10%">


<p>160</p></td>
<td width="10%">
</td>
<td width="10%">


<p>ah: rfc2404</p></td>
<td width="35%">
</td></tr>
<tr valign="top" align="left">
<td width="14%"></td>
<td width="10%">
</td>
<td width="11%">
</td>
<td width="10%">


<p>160</p></td>
<td width="10%">
</td>
<td width="10%">


<p>ah-old: 128bit ICV (no document)</p></td>
<td width="35%">
</td></tr>
<tr valign="top" align="left">
<td width="14%"></td>
<td width="10%">


<p>keyed-md5</p></td>
<td width="11%"></td>
<td width="10%">


<p>128</p></td>
<td width="10%">
</td>
<td width="10%">


<p>ah: 96bit ICV (no document)</p></td>
<td width="35%">
</td></tr>
<tr valign="top" align="left">
<td width="14%"></td>
<td width="10%">
</td>
<td width="11%">
</td>
<td width="10%">


<p>128</p></td>
<td width="10%">
</td>
<td width="10%">


<p>ah-old: rfc1828</p></td>
<td width="35%">
</td></tr>
<tr valign="top" align="left">
<td width="14%"></td>
<td width="10%">


<p>keyed-sha1</p></td>
<td width="11%"></td>
<td width="10%">


<p>160</p></td>
<td width="10%">
</td>
<td width="10%">


<p>ah: 96bit ICV (no document)</p></td>
<td width="35%">
</td></tr>
<tr valign="top" align="left">
<td width="14%"></td>
<td width="10%">
</td>
<td width="11%">
</td>
<td width="10%">


<p>160</p></td>
<td width="10%">
</td>
<td width="10%">


<p>ah-old: 128bit ICV (no document)</p></td>
<td width="35%">
</td></tr>
<tr valign="top" align="left">
<td width="14%"></td>
<td width="10%">


<p>null</p></td>
<td width="11%">
</td>
<td width="10%">


<p>0 to 2048</p></td>
<td width="10%"></td>
<td width="10%">


<p>for debugging</p></td>
<td width="35%">
</td></tr>
<tr valign="top" align="left">
<td width="14%"></td>
<td width="10%">


<p>hmac-sha256</p></td>
<td width="11%"></td>
<td width="10%">


<p>256</p></td>
<td width="10%">
</td>
<td width="10%">


<p>ah: 96bit ICV</p></td>
<td width="35%">
</td></tr>
<tr valign="top" align="left">
<td width="14%"></td>
<td width="10%">
</td>
<td width="11%">
</td>
<td width="10%">
</td>
<td width="10%">
</td>
<td width="10%">


<p>(draft-ietf-ipsec-ciph-sha-256-00)</p></td>
<td width="35%">
</td></tr>
<tr valign="top" align="left">
<td width="14%"></td>
<td width="10%">
</td>
<td width="11%">
</td>
<td width="10%">


<p>256</p></td>
<td width="10%">
</td>
<td width="10%">


<p>ah-old: 128bit ICV (no document)</p></td>
<td width="35%">
</td></tr>
<tr valign="top" align="left">
<td width="14%"></td>
<td width="10%">


<p>hmac-sha384</p></td>
<td width="11%"></td>
<td width="10%">


<p>384</p></td>
<td width="10%">
</td>
<td width="10%">


<p>ah: 96bit ICV (no document)</p></td>
<td width="35%">
</td></tr>
<tr valign="top" align="left">
<td width="14%"></td>
<td width="10%">
</td>
<td width="11%">
</td>
<td width="10%">


<p>384</p></td>
<td width="10%">
</td>
<td width="10%">


<p>ah-old: 128bit ICV (no document)</p></td>
<td width="35%">
</td></tr>
<tr valign="top" align="left">
<td width="14%"></td>
<td width="10%">


<p>hmac-sha512</p></td>
<td width="11%"></td>
<td width="10%">


<p>512</p></td>
<td width="10%">
</td>
<td width="10%">


<p>ah: 96bit ICV (no document)</p></td>
<td width="35%">
</td></tr>
<tr valign="top" align="left">
<td width="14%"></td>
<td width="10%">
</td>
<td width="11%">
</td>
<td width="10%">


<p>512</p></td>
<td width="10%">
</td>
<td width="10%">


<p>ah-old: 128bit ICV (no document)</p></td>
<td width="35%">
</td></tr>
<tr valign="top" align="left">
<td width="14%"></td>
<td width="10%">


<p>hmac-ripemd160</p></td>
<td width="11%"></td>
<td width="10%">


<p>160</p></td>
<td width="10%">
</td>
<td width="10%">


<p>ah: 96bit ICV (RFC2857)</p></td>
<td width="35%">
</td></tr>
<tr valign="top" align="left">
<td width="14%"></td>
<td width="10%">
</td>
<td width="11%">
</td>
<td width="10%">
</td>
<td width="10%">
</td>
<td width="10%">


<p>ah-old: 128bit ICV (no document)</p></td>
<td width="35%">
</td></tr>
<tr valign="top" align="left">
<td width="14%"></td>
<td width="10%">


<p>aes-xcbc-mac</p></td>
<td width="11%"></td>
<td width="10%">


<p>128</p></td>
<td width="10%">
</td>
<td width="10%">


<p>ah: 96bit ICV (RFC3566)</p></td>
<td width="35%">
</td></tr>
<tr valign="top" align="left">
<td width="14%"></td>
<td width="10%">
</td>
<td width="11%">
</td>
<td width="10%">


<p>128</p></td>
<td width="10%">
</td>
<td width="10%">


<p>ah-old: 128bit ICV (no document)</p></td>
<td width="35%">
</td></tr>
<tr valign="top" align="left">
<td width="14%"></td>
<td width="10%">


<p>tcp-md5</p></td>
<td width="11%">
</td>
<td width="10%">


<p>8 to 640</p></td>
<td width="10%"></td>
<td width="10%">


<p>tcp: rfc2385</p></td>
<td width="35%">
</td></tr>
</table>

<p style="margin-left:6%; margin-top: 1em">These encryption
algorithms can be used as <i>ealgo</i> in <b>&minus;E</b>
<i>ealgo</i> of the <i>protocol</i> parameter:</p>

<table width="100%" border="0" rules="none" frame="void"
       cellspacing="0" cellpadding="0">
<tr valign="top" align="left">
<td width="14%"></td>
<td width="10%">


<p>algorithm</p></td>
<td width="11%"></td>
<td width="10%">


<p>keylen (bits)</p></td>
<td width="10%"></td>
<td width="10%"></td>
<td width="35%">
</td></tr>
<tr valign="top" align="left">
<td width="14%"></td>
<td width="10%">


<p>des-cbc</p></td>
<td width="11%">
</td>
<td width="10%">


<p>64</p></td>
<td width="10%">
</td>
<td width="10%">


<p>esp-old: rfc1829, esp: rfc2405</p></td>
<td width="35%">
</td></tr>
<tr valign="top" align="left">
<td width="14%"></td>
<td width="10%">


<p>3des-cbc</p></td>
<td width="11%"></td>
<td width="10%">


<p>192</p></td>
<td width="10%">
</td>
<td width="10%">


<p>rfc2451</p></td>
<td width="35%">
</td></tr>
<tr valign="top" align="left">
<td width="14%"></td>
<td width="10%">


<p>null</p></td>
<td width="11%">
</td>
<td width="10%">


<p>0 to 2048</p></td>
<td width="10%"></td>
<td width="10%">


<p>rfc2410</p></td>
<td width="35%">
</td></tr>
<tr valign="top" align="left">
<td width="14%"></td>
<td width="10%">


<p>blowfish-cbc</p></td>
<td width="11%"></td>
<td width="10%">


<p>40 to 448</p></td>
<td width="10%"></td>
<td width="10%">


<p>rfc2451</p></td>
<td width="35%">
</td></tr>
<tr valign="top" align="left">
<td width="14%"></td>
<td width="10%">


<p>cast128-cbc</p></td>
<td width="11%"></td>
<td width="10%">


<p>40 to 128</p></td>
<td width="10%"></td>
<td width="10%">


<p>rfc2451</p></td>
<td width="35%">
</td></tr>
<tr valign="top" align="left">
<td width="14%"></td>
<td width="10%">


<p>des-deriv</p></td>
<td width="11%"></td>
<td width="10%">


<p>64</p></td>
<td width="10%">
</td>
<td width="10%">


<p>ipsec-ciph-des-derived-01</p></td>
<td width="35%">
</td></tr>
<tr valign="top" align="left">
<td width="14%"></td>
<td width="10%">


<p>3des-deriv</p></td>
<td width="11%"></td>
<td width="10%">


<p>192</p></td>
<td width="10%">
</td>
<td width="10%">


<p>no document</p></td>
<td width="35%">
</td></tr>
<tr valign="top" align="left">
<td width="14%"></td>
<td width="10%">


<p>rijndael-cbc</p></td>
<td width="11%"></td>
<td width="10%">


<p>128/192/256</p></td>
<td width="10%"></td>
<td width="10%">


<p>rfc3602</p></td>
<td width="35%">
</td></tr>
<tr valign="top" align="left">
<td width="14%"></td>
<td width="10%">


<p>twofish-cbc</p></td>
<td width="11%"></td>
<td width="10%">


<p>0 to 256</p></td>
<td width="10%"></td>
<td width="10%">


<p>draft-ietf-ipsec-ciph-aes-cbc-01</p></td>
<td width="35%">
</td></tr>
<tr valign="top" align="left">
<td width="14%"></td>
<td width="10%">


<p>aes-ctr</p></td>
<td width="11%">
</td>
<td width="10%">


<p>160/224/288</p></td>
<td width="10%"></td>
<td width="10%">


<p>draft-ietf-ipsec-ciph-aes-ctr-03</p></td>
<td width="35%">
</td></tr>
</table>

<p style="margin-left:6%; margin-top: 1em">Note that the
first 128 bits of a key for aes-ctr will be used as AES key,
and the remaining 32 bits will be used as nonce.</p>

<p style="margin-left:6%; margin-top: 1em">These
compression algorithms can be used as <i>calgo</i> in
<b>&minus;C</b> <i>calgo</i> of the <i>protocol</i>
parameter:</p>

<p style="margin-left:14%; margin-top: 1em">algorithm</p>

<table width="100%" border="0" rules="none" frame="void"
       cellspacing="0" cellpadding="0">
<tr valign="top" align="left">
<td width="14%"></td>
<td width="10%">


<p>deflate</p></td>
<td width="11%">
</td>
<td width="10%">


<p>rfc2394</p></td>
<td width="55%">
</td></tr>
</table>

<p style="margin-left:6%; margin-top: 1em"><b>RFC vs Linux
kernel semantics</b> <br>
The Linux kernel uses the <i>fwd</i> policy instead of the
<i>in</i> policy for packets what are forwarded through that
particular box.</p>

<p style="margin-left:6%; margin-top: 1em">In <i>kernel</i>
mode, <b>setkey</b> manages and shows policies and SAs
exactly as they are stored in the kernel.</p>

<p style="margin-left:6%; margin-top: 1em">In <i>RFC</i>
mode, <b>setkey</b></p>

<p style="margin-left:6%; margin-top: 1em">creates
<i>fwd</i> policies for every <i>in</i> policy inserted</p>

<p style="margin-left:6%; margin-top: 1em">(not implemented
yet) filters out all <i>fwd</i> policies</p>

<p style="margin-top: 1em"><b>RETURN VALUES</b></p>

<p style="margin-left:6%;">The command exits with 0 on
success, and non-zero on errors.</p>

<p style="margin-top: 1em"><b>EXAMPLES</b></p>

<p style="margin-left:6%;">add 3ffe:501:4819::1
3ffe:501:481d::1 esp 123457</p>

<table width="100%" border="0" rules="none" frame="void"
       cellspacing="0" cellpadding="0">
<tr valign="top" align="left">
<td width="17%"></td>
<td width="10%">


<p>-E des-cbc 0x3ffe05014819ffff ;</p></td>
<td width="73%">
</td></tr>
</table>

<p style="margin-left:6%; margin-top: 1em">add -6
myhost.example.com yourhost.example.com ah 123456</p>

<table width="100%" border="0" rules="none" frame="void"
       cellspacing="0" cellpadding="0">
<tr valign="top" align="left">
<td width="17%"></td>
<td width="83%">


<p>-A hmac-sha1 &quot;AH SA configuration!&quot; ;</p></td></tr>
</table>

<p style="margin-left:6%; margin-top: 1em">add 10.0.11.41
10.0.11.33 esp 0x10001</p>

<table width="100%" border="0" rules="none" frame="void"
       cellspacing="0" cellpadding="0">
<tr valign="top" align="left">
<td width="17%"></td>
<td width="83%">


<p>-E des-cbc 0x3ffe05014819ffff</p></td></tr>
<tr valign="top" align="left">
<td width="17%"></td>
<td width="83%">


<p>-A hmac-md5 &quot;authentication!!&quot; ;</p></td></tr>
</table>

<p style="margin-left:6%; margin-top: 1em">get
3ffe:501:4819::1 3ffe:501:481d::1 ah 123456 ;</p>

<p style="margin-left:6%; margin-top: 1em">flush ;</p>

<p style="margin-left:6%; margin-top: 1em">dump esp ;</p>

<p style="margin-left:6%; margin-top: 1em">spdadd
10.0.11.41/32[21] 10.0.11.33/32[any] any</p>

<table width="100%" border="0" rules="none" frame="void"
       cellspacing="0" cellpadding="0">
<tr valign="top" align="left">
<td width="17%"></td>
<td width="83%">


<p>-P out ipsec esp/tunnel/192.168.0.1-192.168.1.2/require
;</p> </td></tr>
</table>

<p style="margin-left:6%; margin-top: 1em">add 10.1.10.34
10.1.10.36 tcp 0x1000 -A tcp-md5 &quot;TCP-MD5 BGP
secret&quot; ;</p>

<p style="margin-top: 1em"><b>SEE ALSO</b></p>

<p style="margin-left:6%;">ipsec_set_policy(3), racoon(8),
sysctl(8)</p>

<p style="margin-top: 1em"><i>Changed manual key
configuration for IPsec</i></p>

<p style="margin-left:6%;">,</p>

<p>October 1999 , <br>
http://www.kame.net/newsletter/19991007/ .</p>

<p style="margin-top: 1em"><b>HISTORY</b></p>

<p style="margin-left:6%;">The <b>setkey</b> command first
appeared in the WIDE Hydrangea IPv6 protocol stack kit. The
command was completely re-designed in June 1998.</p>

<p style="margin-top: 1em"><b>BUGS</b></p>

<p style="margin-left:6%;"><b>setkey</b> should report and
handle syntax errors better.</p>

<p style="margin-left:6%; margin-top: 1em">For IPsec
gateway configuration, <i>src_range</i> and <i>dst_range</i>
with TCP/UDP port numbers does not work, as the gateway does
not reassemble packets (it cannot inspect upper-layer
headers).</p>

<p style="margin-left:6%; margin-top: 1em">BSD
March&nbsp;19, 2004 BSD</p>
<hr>
</body>
</html>
