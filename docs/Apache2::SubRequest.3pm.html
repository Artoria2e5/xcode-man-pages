<!DOCTYPE html>
<html>
<!-- This is an automatically generated file.  Do not edit.
   Automatically generated by Pod::Man 2.27 (Pod::Simple 3.28)
  
   Standard preamble:
   ========================================================================
   Vertical space (when we can't use .PP)
   Begin verbatim text
   End verbatim text
   Set up some character translations and predefined strings.  \*(-- will
   give an unbreakable dash, \*(PI will give pi, \*(L" will give a left
   double quote, and \*(R" will give a right double quote.  \*(C+ will
   give a nicer C++.  Capital omega is used to do unbreakable dashes and
   therefore won't be available.  \*(C` and \*(C' expand to `' in nroff,
   nothing in troff, for use with C<>.
   diablo 10 pitch
    diablo 12 pitch
 -->
<head>
  <meta charset="utf-8"/>
  <style>
    table.head, table.foot { width: 100%; }
    td.head-rtitle, td.foot-os { text-align: right; }
    td.head-vol { text-align: center; }
    div.Pp { margin: 1ex 0ex; }
    div.Nd, div.Bf, div.Op { display: inline; }
    span.Pa, span.Ad { font-style: italic; }
    span.Ms { font-weight: bold; }
    dl.Bl-diag > dt { font-weight: bold; }
    code.Nm, code.Fl, code.Cm, code.Ic, code.In, code.Fd, code.Fn,
    code.Cd { font-weight: bold; font-family: inherit; }
  </style>
  <title>install::TempContent::Objects::mod_perl-2.0.9::docs::api::Apache2::SubRequest(3)</title>
</head>
<body>
<table class="head">
  <tr>
    <td class="head-ltitle">install::TempContent::Objects::mod_perl-2.0.9::docs::api::Apache2::SubRequest(3)</td>
    <td class="head-vol">User Contributed Perl Documentation</td>
    <td class="head-rtitle">install::TempContent::Objects::mod_perl-2.0.9::docs::api::Apache2::SubRequest(3)</td>
  </tr>
</table>
<div class="manual-text">
<br/>
<section class="Sh">
<h1 class="Sh" id="NAME"><a class="permalink" href="#NAME">NAME</a></h1>
Apache2::SubRequest - Perl API for Apache subrequests
</section>
<section class="Sh">
<h1 class="Sh" id="Synopsis"><a class="permalink" href="#Synopsis">Synopsis</a></h1>
<span class="Li"></span>
<pre>
  use Apache2::SubRequest ();
  
  # run internal redirects at once
  $r-&gt;internal_redirect($new_uri);
  $r-&gt;internal_redirect_handler($new_uri);
  
  # create internal redirect objects
  $subr = $r-&gt;lookup_uri(&quot;/foo&quot;);
  $subr = $r-&gt;lookup_method_uri(&quot;GET&quot;, &quot;/tmp/bar&quot;)
  $subr = $r-&gt;lookup_file(&quot;/tmp/bar&quot;);
  # optionally manipulate the output through main request filters
  $subr = $r-&gt;lookup_uri(&quot;/foo&quot;, $r-&gt;output_filters);
  # now run them
  my $rc = $subr-&gt;run;
</pre>
</section>
<section class="Sh">
<h1 class="Sh" id="Description"><a class="permalink" href="#Description">Description</a></h1>
<span class="Li">&quot;Apache2::SubRequest&quot;</span> contains API for
  creating and running of Apache sub-requests.
<p class="Pp"><span class="Li">&quot;Apache2::SubRequest&quot;</span> is a
    sub-class of <span class="Li">&quot;Apache2::RequestRec</span>
    <span class="Li">object&quot;</span>.</p>
</section>
<section class="Sh">
<h1 class="Sh" id="API"><a class="permalink" href="#API">API</a></h1>
<span class="Li">&quot;Apache2::SubRequest&quot;</span> provides the following
  functions and/or methods:
<section class="Ss">
<h2 class="Ss" id="_DESTROY_"><a class="permalink" href="#_DESTROY_">&quot;DESTROY&quot;</a></h2>
Free the memory associated with a sub request:
<p class="Pp"><span class="Li"></span></p>
<pre>
  undef $subr; # but normally don't do that
</pre>
<dl class="Bl-tag">
  <dt>obj: $subr ( &quot;Apache2::SubRequest object&quot; )</dt>
  <dd>The sub request to finish</dd>
  <dt>ret: no return value</dt>
  <dd></dd>
  <dt>since: 2.0.00</dt>
  <dd></dd>
</dl>
<p class="Pp"><span class="Li">&quot;DESTROY&quot;</span> is called
    automatically when <span class="Li">$subr</span> goes out of scope.</p>
<p class="Pp">If you want to free the memory earlier than that (for example if
    you run several subrequests), you can
    <span class="Li">&quot;undef&quot;</span> the object as:</p>
<p class="Pp"><span class="Li"></span></p>
<pre>
  undef $subr;
</pre>
<p class="Pp">but never call <span class="Li">&quot;DESTROY&quot;</span>
    explicitly, since it'll result in
    <span class="Li">&quot;ap_destroy_sub_req&quot;</span> being called more
    than once, resulting in multiple brain injuries and certain hair loss.</p>
</section>
<section class="Ss">
<h2 class="Ss" id="_internal_redirect_"><a class="permalink" href="#_internal_redirect_">&quot;internal_redirect&quot;</a></h2>
Redirect the current request to some other uri internally
<p class="Pp"><span class="Li"></span></p>
<pre>
  $r-&gt;internal_redirect($new_uri);
</pre>
<dl class="Bl-tag">
  <dt>obj: $r ( &quot;Apache2::RequestRec object&quot; )</dt>
  <dd>The current request</dd>
  <dt>arg1: $new_uri ( string )</dt>
  <dd>The URI to replace the current request with</dd>
  <dt>ret: no return value</dt>
  <dd></dd>
  <dt>since: 2.0.00</dt>
  <dd></dd>
</dl>
<p class="Pp">In case that you want some other request to be served as the
    top-level request instead of what the client requested directly, call this
    method from a handler, and then immediately return
    <span class="Li">&quot;Apache2::Const::OK&quot;</span>. The client will be
    unaware the a different request was served to her behind the scenes.</p>
</section>
<section class="Ss">
<h2 class="Ss" id="_internal_redirect_handler_"><a class="permalink" href="#_internal_redirect_handler_">&quot;internal_redirect_handler&quot;</a></h2>
Identical to <span class="Li">&quot;internal_redirect&quot;</span>, plus
  automatically sets <span class="Li">&quot;$r-&gt;content_type&quot;</span> is
  of the sub-request to be the same as of the main request, if
  <span class="Li">&quot;$r-&gt;handler&quot;</span> is true.
<p class="Pp"><span class="Li"></span></p>
<pre>
  $r-&gt;internal_redirect_handler($new_uri);
</pre>
<dl class="Bl-tag">
  <dt>obj: $r ( &quot;Apache2::RequestRec object&quot; )</dt>
  <dd>The current request</dd>
  <dt>arg1: $new_uri ( string )</dt>
  <dd>The URI to replace the current request with.</dd>
  <dt>ret: no return value</dt>
  <dd></dd>
  <dt>since: 2.0.00</dt>
  <dd></dd>
</dl>
<p class="Pp">This function is designed for things like actions or CGI scripts,
    when using <span class="Li">&quot;AddHandler&quot;</span>, and you want to
    preserve the content type across an internal redirect.</p>
</section>
<section class="Ss">
<h2 class="Ss" id="_lookup_file_"><a class="permalink" href="#_lookup_file_">&quot;lookup_file&quot;</a></h2>
Create a subrequest for the given file. This sub request can be inspected to
  find information about the requested file
<p class="Pp"><span class="Li"></span></p>
<pre>
  $ret = $r-&gt;lookup_file($new_file);
  $ret = $r-&gt;lookup_file($new_file, $next_filter);
</pre>
<dl class="Bl-tag">
  <dt>obj: $r ( &quot;Apache2::RequestRec object&quot; )</dt>
  <dd>The current request</dd>
  <dt>arg1: $new_file ( string )</dt>
  <dd>The file to lookup</dd>
  <dt>opt arg2: $next_filter ( &quot;Apache2::Filter&quot; )</dt>
  <dd>See <span class="Li">&quot;$r-&gt;lookup_uri&quot;</span> for
    details.</dd>
  <dt>ret: $ret ( &quot;Apache2::SubRequest object&quot; )</dt>
  <dd>The sub request record.</dd>
  <dt>since: 2.0.00</dt>
  <dd></dd>
</dl>
<p class="Pp">See <span class="Li">&quot;$r-&gt;lookup_uri&quot;</span> for
    further discussion.</p>
</section>
<section class="Ss">
<h2 class="Ss" id="_lookup_method_uri_"><a class="permalink" href="#_lookup_method_uri_">&quot;lookup_method_uri&quot;</a></h2>
Create a sub request for the given URI using a specific method. This sub request
  can be inspected to find information about the requested URI
<p class="Pp"><span class="Li"></span></p>
<pre>
  $ret = $r-&gt;lookup_method_uri($method, $new_uri);
  $ret = $r-&gt;lookup_method_uri($method, $new_uri, $next_filter);
</pre>
<dl class="Bl-tag">
  <dt>obj: $r ( &quot;Apache2::RequestRec object&quot; )</dt>
  <dd>The current request</dd>
  <dt>arg1: $method ( string )</dt>
  <dd>The method to use in the new sub request (e.g.
      <span class="Li">&quot;GET&quot;</span>)</dd>
  <dt>arg2: $new_uri ( string )</dt>
  <dd>The URI to lookup</dd>
  <dt>opt arg3: $next_filter ( &quot;Apache2::Filter object&quot; )</dt>
  <dd>See <span class="Li">&quot;$r-&gt;lookup_uri&quot;</span> for
    details.</dd>
  <dt>ret: $ret ( &quot;Apache2::SubRequest object&quot; )</dt>
  <dd>The sub request record.</dd>
  <dt>since: 2.0.00</dt>
  <dd></dd>
</dl>
<p class="Pp">See <span class="Li">&quot;$r-&gt;lookup_uri&quot;</span> for
    further discussion.</p>
</section>
<section class="Ss">
<h2 class="Ss" id="_lookup_uri_"><a class="permalink" href="#_lookup_uri_">&quot;lookup_uri&quot;</a></h2>
Create a sub request from the given URI. This sub request can be inspected to
  find information about the requested URI.
<p class="Pp"><span class="Li"></span></p>
<pre>
  $ret = $r-&gt;lookup_uri($new_uri);
  $ret = $r-&gt;lookup_uri($new_uri, $next_filter);
</pre>
<dl class="Bl-tag">
  <dt>obj: $r ( &quot;Apache2::RequestRec object&quot; )</dt>
  <dd>The current request</dd>
  <dt>arg1: $new_uri ( string )</dt>
  <dd>The URI to lookup</dd>
  <dt>opt arg2: $next_filter ( &quot;Apache2::Filter object&quot; )</dt>
  <dd>The first filter the subrequest should pass the data through. If not
      specified it defaults to the first connection output filter for the main
      request <span class="Li">&quot;$r-&gt;proto_output_filters&quot;</span>.
      So if the subrequest sends any output it will be filtered only once. If
      for example you desire to apply the main request's output filters to the
      sub-request output as well pass
      <span class="Li">&quot;$r-&gt;output_filters&quot;</span> as an
    argument.</dd>
  <dt>ret: $ret ( &quot;Apache2::SubRequest object&quot; )</dt>
  <dd>The sub request record</dd>
  <dt>since: 2.0.00</dt>
  <dd></dd>
</dl>
<p class="Pp">Here is an example of a simple subrequest which serves uri
    <i>/new_uri</i>:</p>
<p class="Pp"><span class="Li"></span></p>
<pre>
  sub handler {
      my $r = shift;
  
      my $subr = $r-&gt;lookup_uri(&quot;/new_uri&quot;);
      $subr-&gt;run;
  
      return Apache2::Const::OK;
  }
</pre>
<p class="Pp">If let's say you have three request output filters registered to
    run for the main request:</p>
<p class="Pp"><span class="Li"></span></p>
<pre>
  PerlOutputFilterHandler MyApache2::SubReqExample::filterA
  PerlOutputFilterHandler MyApache2::SubReqExample::filterB
  PerlOutputFilterHandler MyApache2::SubReqExample::filterC
</pre>
<p class="Pp">and you wish to run them all, the code needs to become:</p>
<p class="Pp"><span class="Li"></span></p>
<pre>
      my $subr = $r-&gt;lookup_uri(&quot;/new_uri&quot;, $r-&gt;output_filters);
</pre>
<p class="Pp">and if you wish to run them all, but the first one
    (<span class="Li">&quot;filterA&quot;</span>), the code needs to be adjusted
    to be:</p>
<p class="Pp"><span class="Li"></span></p>
<pre>
      my $subr = $r-&gt;lookup_uri(&quot;/new_uri&quot;, $r-&gt;output_filters-&gt;next);
</pre>
</section>
<section class="Ss">
<h2 class="Ss" id="_run_"><a class="permalink" href="#_run_">&quot;run&quot;</a></h2>
Run a sub-request
<p class="Pp"><span class="Li"></span></p>
<pre>
  $rc = $subr-&gt;run();
</pre>
<dl class="Bl-tag">
  <dt>obj: $subr ( &quot;Apache2::RequestRec object&quot; )</dt>
  <dd>The sub-request (e.g. returned by
      <span class="Li">&quot;lookup_uri&quot;</span>)</dd>
  <dt>ret: $rc ( integer )</dt>
  <dd>The return code of the handler
      (<span class="Li">&quot;Apache2::Const::OK&quot;</span>,
      <span class="Li">&quot;Apache2::Const::DECLINED&quot;</span>, etc.)</dd>
  <dt>since: 2.0.00</dt>
  <dd></dd>
</dl>
</section>
</section>
<section class="Sh">
<h1 class="Sh" id="Unsupported_API"><a class="permalink" href="#Unsupported_API">Unsupported
  API</a></h1>
<span class="Li">&quot;Apache2::SubRequest&quot;</span> also provides
  auto-generated Perl interface for a few other methods which aren't tested at
  the moment and therefore their API is a subject to change. These methods will
  be finalized later as a need arises. If you want to rely on any of the
  following methods please contact the the mod_perl development mailing list so
  we can help each other take the steps necessary to shift the method to an
  officially supported API.
<section class="Ss">
<h2 class="Ss" id="_internal_fast_redirect_"><a class="permalink" href="#_internal_fast_redirect_">&quot;internal_fast_redirect&quot;</a></h2>
META: Autogenerated - needs to be reviewed/completed
<p class="Pp">Redirect the current request to a sub_req, merging the pools</p>
<p class="Pp"><span class="Li"></span></p>
<pre>
  $r-&gt;internal_fast_redirect($sub_req);
</pre>
<dl class="Bl-tag">
  <dt>obj: $r ( &quot;Apache2::RequestRec object&quot; )</dt>
  <dd>The current request</dd>
  <dt>arg1: $sub_req ( string )</dt>
  <dd>A subrequest created from this request</dd>
  <dt>ret: no return value</dt>
  <dd></dd>
  <dt>since: 2.0.00</dt>
  <dd></dd>
</dl>
<p class="Pp">META: httpd-2.0/modules/http/http_request.c declares this function
    as:</p>
<p class="Pp"><span class="Li"></span></p>
<pre>
  /* XXX: Is this function is so bogus and fragile that we deep-6 it? */
</pre>
<p class="Pp">do we really want to expose it to mod_perl users?</p>
</section>
<section class="Ss">
<h2 class="Ss" id="_lookup_dirent_"><a class="permalink" href="#_lookup_dirent_">&quot;lookup_dirent&quot;</a></h2>
META: Autogenerated - needs to be reviewed/completed
<p class="Pp">Create a sub request for the given apr_dir_read result. This sub
    request can be inspected to find information about the requested file</p>
<p class="Pp"><span class="Li"></span></p>
<pre>
  $lr = $r-&gt;lookup_dirent($finfo);
  $lr = $r-&gt;lookup_dirent($finfo, $subtype);
  $lr = $r-&gt;lookup_dirent($finfo, $subtype, $next_filter);
</pre>
<dl class="Bl-tag">
  <dt>obj: $r ( &quot;Apache2::RequestRec object&quot; )</dt>
  <dd>The current request</dd>
  <dt>arg1: $finfo ( &quot;APR::Finfo object&quot; )</dt>
  <dd>The apr_dir_read result to lookup</dd>
  <dt>arg2: $subtype ( integer )</dt>
  <dd>What type of subrequest to perform, one of;
    <p class="Pp"><span class="Li"></span></p>
    <pre>
  Apache2::SUBREQ_NO_ARGS     ignore r-&gt;args and r-&gt;path_info
  Apache2::SUBREQ_MERGE_ARGS  merge  r-&gt;args and r-&gt;path_info
    </pre>
  </dd>
  <dt>arg3: $next_filter ( integer )</dt>
  <dd>The first filter the sub_request should use. If this is NULL, it defaults
      to the first filter for the main request</dd>
  <dt>ret: $lr ( &quot;Apache2::RequestRec object&quot; )</dt>
  <dd>The new request record</dd>
  <dt>since: 2.0.00</dt>
  <dd></dd>
</dl>
<p class="Pp">META: where do we take the apr_dir_read result from?</p>
</section>
</section>
<section class="Sh">
<h1 class="Sh" id="See_Also"><a class="permalink" href="#See_Also">See
  Also</a></h1>
mod_perl 2.0 documentation.
</section>
<section class="Sh">
<h1 class="Sh" id="Copyright"><a class="permalink" href="#Copyright">Copyright</a></h1>
mod_perl 2.0 and its core modules are copyrighted under The Apache Software
  License, Version 2.0.
</section>
<section class="Sh">
<h1 class="Sh" id="Authors"><a class="permalink" href="#Authors">Authors</a></h1>
The mod_perl development team and numerous contributors.
</section>
</div>
<table class="foot">
  <tr>
    <td class="foot-date">2015-06-18</td>
    <td class="foot-os">perl v5.18.2</td>
  </tr>
</table>
</body>
</html>
